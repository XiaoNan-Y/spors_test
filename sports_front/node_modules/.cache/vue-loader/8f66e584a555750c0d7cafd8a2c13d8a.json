{"remainingRequest":"C:\\Users\\HP\\Desktop\\sports_test\\sports_front\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\HP\\Desktop\\sports_test\\sports_front\\src\\views\\student\\Exemption.vue?vue&type=style&index=0&id=2347abab&scoped=true&lang=css","dependencies":[{"path":"C:\\Users\\HP\\Desktop\\sports_test\\sports_front\\src\\views\\student\\Exemption.vue","mtime":1742476525389},{"path":"C:\\Users\\HP\\Desktop\\sports_test\\sports_front\\node_modules\\css-loader\\dist\\cjs.js","mtime":1741946995932},{"path":"C:\\Users\\HP\\Desktop\\sports_test\\sports_front\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1741947007541},{"path":"C:\\Users\\HP\\Desktop\\sports_test\\sports_front\\node_modules\\postcss-loader\\src\\index.js","mtime":1741947003089},{"path":"C:\\Users\\HP\\Desktop\\sports_test\\sports_front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1741946992817},{"path":"C:\\Users\\HP\\Desktop\\sports_test\\sports_front\\node_modules\\vue-loader\\lib\\index.js","mtime":1741947007540}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5leGVtcHRpb24gewogIHBhZGRpbmc6IDIwcHg7Cn0KCi5hbGVydC1pbmZvIHsKICBtYXJnaW4tYm90dG9tOiAyMHB4Owp9Cgoub3BlcmF0aW9uLWJhciB7CiAgbWFyZ2luLWJvdHRvbTogMjBweDsKfQoKLnBhZ2luYXRpb24tY29udGFpbmVyIHsKICBtYXJnaW4tdG9wOiAyMHB4OwogIHRleHQtYWxpZ246IHJpZ2h0Owp9Cg=="},{"version":3,"sources":["Exemption.vue"],"names":[],"mappings":";AAyWA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"Exemption.vue","sourceRoot":"src/views/student","sourcesContent":["<template>\n  <div class=\"exemption\">\n    <!-- 提示信息 -->\n    <el-alert\n      title=\"如果您因特殊原因需要申请免测或重测，请在此提交申请。我们会尽快处理您的申请。\"\n      type=\"info\"\n      :closable=\"false\"\n      show-icon\n      class=\"alert-info\"\n    >\n    </el-alert>\n\n    <!-- 提交申请按钮 -->\n    <div class=\"operation-bar\">\n      <el-button type=\"primary\" @click=\"showSubmitDialog\">提交申请</el-button>\n    </div>\n\n    <!-- 申请列表 -->\n    <el-table\n      v-loading=\"loading\"\n      :data=\"tableData\"\n      border\n      stripe\n      style=\"width: 100%\"\n    >\n      <el-table-column prop=\"applyTime\" label=\"申请时间\" width=\"180\" align=\"center\">\n        <template slot-scope=\"scope\">\n          {{ formatDateTime(scope.row.applyTime) }}\n        </template>\n      </el-table-column>\n      <el-table-column prop=\"sportsItemName\" label=\"申请项目\" align=\"center\"></el-table-column>\n      <el-table-column prop=\"type\" label=\"申请类型\" width=\"100\" align=\"center\">\n        <template slot-scope=\"scope\">\n          {{ scope.row.type === 'EXEMPTION' ? '免测' : '重测' }}\n        </template>\n      </el-table-column>\n      <el-table-column prop=\"reason\" label=\"申请原因\" show-overflow-tooltip></el-table-column>\n      <el-table-column prop=\"status\" label=\"状态\" width=\"120\" align=\"center\">\n        <template slot-scope=\"scope\">\n          <el-tag :type=\"getStatusType(scope.row.status)\">{{ getStatusText(scope.row.status) }}</el-tag>\n        </template>\n      </el-table-column>\n      <el-table-column label=\"审核意见\" show-overflow-tooltip>\n        <template slot-scope=\"scope\">\n          <div v-if=\"scope.row.teacherReviewComment\">\n            <div>教师意见：{{ scope.row.teacherReviewComment }}</div>\n          </div>\n          <div v-if=\"scope.row.adminReviewComment\">\n            <div>管理员意见：{{ scope.row.adminReviewComment }}</div>\n          </div>\n          <span v-if=\"!scope.row.teacherReviewComment && !scope.row.adminReviewComment\">-</span>\n        </template>\n      </el-table-column>\n      <el-table-column label=\"操作\" width=\"120\" align=\"center\">\n        <template slot-scope=\"scope\">\n          <el-button\n            size=\"mini\"\n            type=\"text\"\n            @click=\"handleDetail(scope.row)\"\n          >查看</el-button>\n          <el-button\n            size=\"mini\"\n            type=\"text\"\n            @click=\"handleDelete(scope.row)\"\n            v-if=\"scope.row.status.includes('PENDING')\"\n          >撤回</el-button>\n        </template>\n      </el-table-column>\n    </el-table>\n\n    <!-- 分页 -->\n    <div class=\"pagination-container\">\n      <el-pagination\n        @size-change=\"handleSizeChange\"\n        @current-change=\"handleCurrentChange\"\n        :current-page=\"queryParams.pageNum\"\n        :page-sizes=\"[10, 20, 50, 100]\"\n        :page-size=\"queryParams.pageSize\"\n        layout=\"total, sizes, prev, pager, next, jumper\"\n        :total=\"total\"\n      >\n      </el-pagination>\n    </div>\n\n    <!-- 提交申请对话框 -->\n    <el-dialog title=\"提交申请\" :visible.sync=\"submitDialog.visible\" width=\"500px\">\n      <el-form :model=\"submitForm\" :rules=\"submitRules\" ref=\"submitForm\" label-width=\"100px\">\n        <el-form-item label=\"申请类型\" prop=\"type\">\n          <el-radio-group v-model=\"submitForm.type\">\n            <el-radio label=\"EXEMPTION\">免测申请</el-radio>\n            <el-radio label=\"RETEST\">重测申请</el-radio>\n          </el-radio-group>\n        </el-form-item>\n        <el-form-item label=\"测试项目\" prop=\"sportsItemId\">\n          <el-select v-model=\"submitForm.sportsItemId\" placeholder=\"请选择测试项目\">\n            <el-option\n              v-for=\"item in sportsItems\"\n              :key=\"item.id\"\n              :label=\"item.name\"\n              :value=\"item.id\"\n            >\n            </el-option>\n          </el-select>\n        </el-form-item>\n        <el-form-item label=\"申请原因\" prop=\"reason\">\n          <el-input\n            type=\"textarea\"\n            v-model=\"submitForm.reason\"\n            :rows=\"4\"\n            placeholder=\"请详细说明申请原因\"\n          ></el-input>\n        </el-form-item>\n      </el-form>\n      <div slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"submitDialog.visible = false\">取 消</el-button>\n        <el-button type=\"primary\" @click=\"submitApplication\">确 定</el-button>\n      </div>\n    </el-dialog>\n\n    <!-- 详情对话框 -->\n    <el-dialog title=\"申请详情\" :visible.sync=\"detailDialog.visible\" width=\"500px\">\n      <el-descriptions :column=\"1\" border>\n        <el-descriptions-item label=\"申请时间\">{{ formatDateTime(currentRecord?.applyTime) }}</el-descriptions-item>\n        <el-descriptions-item label=\"测试项目\">{{ currentRecord?.sportsItemName }}</el-descriptions-item>\n        <el-descriptions-item label=\"申请类型\">{{ currentRecord?.type === 'EXEMPTION' ? '免测' : '重测' }}</el-descriptions-item>\n        <el-descriptions-item label=\"申请原因\">{{ currentRecord?.reason }}</el-descriptions-item>\n        <el-descriptions-item label=\"当前状态\">{{ getStatusText(currentRecord?.status) }}</el-descriptions-item>\n        <el-descriptions-item label=\"教师审核意见\">{{ currentRecord?.teacherReviewComment || '-' }}</el-descriptions-item>\n        <el-descriptions-item label=\"管理员审核意见\">{{ currentRecord?.adminReviewComment || '-' }}</el-descriptions-item>\n      </el-descriptions>\n      <div slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"detailDialog.visible = false\">关 闭</el-button>\n      </div>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: 'Exemption',\n  data() {\n    return {\n      // 查询参数\n      queryParams: {\n        pageNum: 1,\n        pageSize: 10\n      },\n      // 加载状态\n      loading: false,\n      // 表格数据\n      tableData: [],\n      // 总记录数\n      total: 0,\n      // 提交对话框\n      submitDialog: {\n        visible: false\n      },\n      // 提交表单\n      submitForm: {\n        type: '',\n        sportsItemId: '',\n        reason: ''\n      },\n      // 表单校验规则\n      submitRules: {\n        type: [\n          { required: true, message: '请选择申请类型', trigger: 'change' }\n        ],\n        sportsItemId: [\n          { required: true, message: '请选择测试项目', trigger: 'change' }\n        ],\n        reason: [\n          { required: true, message: '请填写申请原因', trigger: 'blur' },\n          { min: 10, message: '申请原因不能少于10个字符', trigger: 'blur' }\n        ]\n      },\n      // 体育项目列表\n      sportsItems: [],\n      // 详情对话框\n      detailDialog: {\n        visible: false\n      },\n      // 当前记录\n      currentRecord: null\n    }\n  },\n  created() {\n    this.getList()\n    this.getSportsItems()\n  },\n  methods: {\n    // 获取列表数据\n    async getList() {\n      try {\n        this.loading = true;\n        console.log('Fetching exemptions with params:', {\n          page: Math.max(0, this.queryParams.pageNum - 1),\n          size: this.queryParams.pageSize\n        });\n        \n        const res = await this.$http.get('/api/student/exemptions', {\n          params: {\n            page: Math.max(0, this.queryParams.pageNum - 1), // 确保页码不小于0\n            size: this.queryParams.pageSize\n          }\n        });\n        \n        console.log('Response:', res.data);\n        \n        if (res.data.code === 200) {\n          const data = res.data.data;\n          this.tableData = data.content || [];\n          this.total = data.totalElements || 0;\n          \n          console.log('Loaded data:', this.tableData);\n          \n          // 如果当前页没有数据且不是第一页，则请求上一页\n          if (this.tableData.length === 0 && this.queryParams.pageNum > 1) {\n            this.queryParams.pageNum--;\n            await this.getList();\n          }\n        } else {\n          this.$message.error(res.data.message || '获取列表失败');\n        }\n      } catch (error) {\n        console.error('获取列表失败:', error);\n        if (error.response) {\n          console.error('Error response:', error.response.data);\n        }\n        this.$message.error(error.response?.data?.message || '获取列表失败');\n      } finally {\n        this.loading = false;\n      }\n    },\n    // 获取体育项目列表\n    async getSportsItems() {\n      try {\n        const res = await this.$http.get('/api/sports-items')\n        if (res.data.code === 200) {\n          this.sportsItems = res.data.data\n        }\n      } catch (error) {\n        console.error('获取体育项目列表失败:', error)\n        this.$message.error('获取体育项目列表失败')\n      }\n    },\n    // 显示提交对话框\n    showSubmitDialog() {\n      this.submitForm = {\n        type: '',\n        sportsItemId: '',\n        reason: ''\n      }\n      this.submitDialog.visible = true\n    },\n    // 提交申请\n    submitApplication() {\n      this.$refs.submitForm.validate(async (valid) => {\n        if (valid) {\n          try {\n            const res = await this.$http.post('/api/student/exemptions', this.submitForm)\n            if (res.data.code === 200) {\n              this.$message.success('申请提交成功')\n              this.submitDialog.visible = false\n              this.getList()\n            }\n          } catch (error) {\n            console.error('提交申请失败:', error)\n            this.$message.error('提交申请失败')\n          }\n        }\n      })\n    },\n    // 查看详情\n    handleDetail(row) {\n      this.currentRecord = row\n      this.detailDialog.visible = true\n    },\n    // 撤回申请\n    handleDelete(row) {\n      this.$confirm('确认撤回该申请吗？', '提示', {\n        type: 'warning'\n      }).then(async () => {\n        try {\n          const res = await this.$http.delete(`/api/student/exemptions/${row.id}`)\n          if (res.data.code === 200) {\n            this.$message.success('撤回成功')\n            this.getList()\n          }\n        } catch (error) {\n          console.error('撤回申请失败:', error)\n          this.$message.error('撤回申请失败')\n        }\n      }).catch(() => {})\n    },\n    // 分页大小改变\n    handleSizeChange(val) {\n      this.queryParams.pageSize = val\n      this.getList()\n    },\n    // 页码改变\n    handleCurrentChange(val) {\n      this.queryParams.pageNum = val\n      this.getList()\n    },\n    // 格式化时间\n    formatDateTime(dateTime) {\n      if (!dateTime) return '-'\n      return new Date(dateTime).toLocaleString('zh-CN', {\n        year: 'numeric',\n        month: '2-digit',\n        day: '2-digit',\n        hour: '2-digit',\n        minute: '2-digit',\n        second: '2-digit',\n        hour12: false\n      })\n    },\n    // 获取状态类型\n    getStatusType(status) {\n      switch (status) {\n        case 'PENDING_TEACHER':\n        case 'PENDING_ADMIN':\n        case 'PENDING':\n          return 'warning'\n        case 'APPROVED':\n          return 'success'\n        case 'REJECTED_TEACHER':\n        case 'REJECTED_ADMIN':\n        case 'REJECTED':\n          return 'danger'\n        default:\n          return 'info'\n      }\n    },\n    // 获取状态文本\n    getStatusText(status) {\n      switch (status) {\n        case 'PENDING_TEACHER':\n          return '待教师审核'\n        case 'PENDING_ADMIN':\n          return '待管理员审核'\n        case 'PENDING':\n          return '待审核'\n        case 'APPROVED':\n          return '已通过'\n        case 'REJECTED_TEACHER':\n          return '教师已驳回'\n        case 'REJECTED_ADMIN':\n          return '管理员已驳回'\n        case 'REJECTED':\n          return '已驳回'\n        default:\n          return status\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n.exemption {\n  padding: 20px;\n}\n\n.alert-info {\n  margin-bottom: 20px;\n}\n\n.operation-bar {\n  margin-bottom: 20px;\n}\n\n.pagination-container {\n  margin-top: 20px;\n  text-align: right;\n}\n</style> "]}]}