{"remainingRequest":"C:\\Users\\HP\\Desktop\\sports_test\\sports_front\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\HP\\Desktop\\sports_test\\sports_front\\src\\views\\admin\\DataReview.vue?vue&type=style&index=0&id=7f4f499c&scoped=true&lang=css","dependencies":[{"path":"C:\\Users\\HP\\Desktop\\sports_test\\sports_front\\src\\views\\admin\\DataReview.vue","mtime":1742348100839},{"path":"C:\\Users\\HP\\Desktop\\sports_test\\sports_front\\node_modules\\css-loader\\dist\\cjs.js","mtime":1741946995932},{"path":"C:\\Users\\HP\\Desktop\\sports_test\\sports_front\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1741947007541},{"path":"C:\\Users\\HP\\Desktop\\sports_test\\sports_front\\node_modules\\postcss-loader\\src\\index.js","mtime":1741947003089},{"path":"C:\\Users\\HP\\Desktop\\sports_test\\sports_front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1741946992817},{"path":"C:\\Users\\HP\\Desktop\\sports_test\\sports_front\\node_modules\\vue-loader\\lib\\index.js","mtime":1741947007540}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5kYXRhLXJldmlldyB7CiAgcGFkZGluZzogMjBweDsKfQoKLmhlYWRlciB7CiAgZGlzcGxheTogZmxleDsKICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBtYXJnaW4tYm90dG9tOiAyMHB4Owp9CgouZmlsdGVycyB7CiAgbWFyZ2luLWJvdHRvbTogMjBweDsKfQoKLnBhZ2luYXRpb24tY29udGFpbmVyIHsKICBtYXJnaW4tdG9wOiAyMHB4OwogIHRleHQtYWxpZ246IHJpZ2h0Owp9Cg=="},{"version":3,"sources":["DataReview.vue"],"names":[],"mappings":";AA4mBA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"DataReview.vue","sourceRoot":"src/views/admin","sourcesContent":["<template>\n  <div class=\"data-review\">\n    <div class=\"header\">\n      <h2>数据录入与审核</h2>\n      <div class=\"actions\">\n        <el-button type=\"primary\" @click=\"showAddDialog\">\n          <i class=\"el-icon-plus\"></i> 录入成绩\n        </el-button>\n        <el-button type=\"success\" @click=\"exportData\">\n          <i class=\"el-icon-download\"></i> 导出数据\n        </el-button>\n      </div>\n    </div>\n\n    <div class=\"filters\">\n      <el-form :inline=\"true\" class=\"filter-form\">\n        <el-form-item label=\"测试项目\">\n          <el-select v-model=\"filters.sportsItemId\" placeholder=\"选择测试项目\" clearable>\n            <el-option\n              v-for=\"item in sportsItems\"\n              :key=\"item.id\"\n              :label=\"item.name\"\n              :value=\"item.id\"\n            />\n          </el-select>\n        </el-form-item>\n        <el-form-item label=\"状态\">\n          <el-select v-model=\"filters.status\" placeholder=\"选择状态\" clearable>\n            <el-option label=\"待审核\" value=\"PENDING\" />\n            <el-option label=\"已通过\" value=\"APPROVED\" />\n            <el-option label=\"已驳回\" value=\"REJECTED\" />\n          </el-select>\n        </el-form-item>\n        <el-form-item label=\"关键词\">\n          <el-input\n            v-model=\"filters.keyword\"\n            placeholder=\"学号/姓名\"\n            clearable\n            @keyup.enter.native=\"handleSearch\"\n          />\n        </el-form-item>\n        <el-form-item>\n          <el-button type=\"primary\" @click=\"handleSearch\">查询</el-button>\n          <el-button @click=\"resetFilters\">重置</el-button>\n        </el-form-item>\n      </el-form>\n    </div>\n\n    <el-table\n      v-loading=\"loading\"\n      :data=\"records\"\n      border\n      style=\"width: 100%\"\n    >\n      <el-table-column label=\"序号\" type=\"index\" width=\"50\" align=\"center\" />\n      <el-table-column prop=\"studentNumber\" label=\"学号\" width=\"120\" />\n      <el-table-column prop=\"studentName\" label=\"姓名\" width=\"120\" />\n      <el-table-column prop=\"className\" label=\"班级\" width=\"120\" />\n      <el-table-column label=\"测试项目\" width=\"120\">\n        <template slot-scope=\"scope\">\n          {{ scope.row.sportsItem ? scope.row.sportsItem.name : '' }}\n        </template>\n      </el-table-column>\n      <el-table-column prop=\"score\" label=\"成绩\" width=\"100\" />\n      <el-table-column prop=\"status\" label=\"状态\" width=\"100\">\n        <template slot-scope=\"scope\">\n          <el-tag :type=\"getStatusType(scope.row.status)\">\n            {{ getStatusText(scope.row.status) }}\n          </el-tag>\n        </template>\n      </el-table-column>\n      <el-table-column prop=\"reviewComment\" label=\"审核意见\" />\n      <el-table-column prop=\"createdAt\" label=\"创建时间\" width=\"180\">\n        <template slot-scope=\"scope\">\n          {{ formatDateTime(scope.row.createdAt) }}\n        </template>\n      </el-table-column>\n      <el-table-column label=\"操作\" width=\"200\" fixed=\"right\">\n        <template slot-scope=\"scope\">\n          <el-button\n            size=\"mini\"\n            type=\"primary\"\n            @click=\"handleEdit(scope.row)\"\n          >编辑</el-button>\n          <el-button\n            size=\"mini\"\n            type=\"success\"\n            @click=\"handleReview(scope.row)\"\n            v-if=\"scope.row.status === 'PENDING'\"\n          >审核</el-button>\n        </template>\n      </el-table-column>\n    </el-table>\n\n    <!-- 分页 -->\n    <div class=\"pagination-container\">\n      <el-pagination\n        @size-change=\"handleSizeChange\"\n        @current-change=\"handleCurrentChange\"\n        :current-page.sync=\"currentPage\"\n        :page-sizes=\"[10, 20, 50, 100]\"\n        :page-size=\"pageSize\"\n        layout=\"total, sizes, prev, pager, next, jumper\"\n        :total=\"total\">\n      </el-pagination>\n    </div>\n\n    <!-- 录入成绩对话框 -->\n    <el-dialog \n      title=\"录入成绩\" \n      :visible.sync=\"addDialog.visible\" \n      width=\"400px\"\n      @closed=\"handleDialogClosed\"\n    >\n      <el-form :model=\"form\" :rules=\"rules\" ref=\"recordForm\" label-width=\"80px\">\n        <!-- 学生选择 -->\n        <el-form-item label=\"学生\" prop=\"studentId\">\n          <el-select \n            v-model=\"form.studentId\" \n            placeholder=\"请选择学生\" \n            filterable\n            remote\n            :remote-method=\"searchStudents\"\n            :loading=\"studentLoading\"\n            style=\"width: 100%\"\n          >\n            <el-option\n              v-for=\"student in students\"\n              :key=\"student.id\"\n              :label=\"student.realName\"\n              :value=\"student.id\"\n            >\n              <span>{{ student.realName }}</span>\n              <span style=\"float: right; color: #8492a6; font-size: 13px\">\n                {{ student.username }}\n              </span>\n            </el-option>\n          </el-select>\n        </el-form-item>\n\n        <!-- 测试项目选择 -->\n        <el-form-item label=\"测试项目\" prop=\"sportsItemId\">\n          <el-select \n            v-model=\"form.sportsItemId\" \n            placeholder=\"请选择项目\"\n            @change=\"handleSportsItemChange\"\n            style=\"width: 100%\"\n          >\n            <el-option\n              v-for=\"item in sportsItems\"\n              :key=\"item.id\"\n              :label=\"item.name\"\n              :value=\"item.id\"\n            >\n              <span>{{ item.name }}</span>\n              <span style=\"float: right; color: #8492a6; font-size: 13px\">\n                {{ item.unit }}\n              </span>\n            </el-option>\n          </el-select>\n        </el-form-item>\n\n        <!-- 成绩输入 -->\n        <el-form-item label=\"成绩\" prop=\"score\">\n          <div style=\"display: flex; align-items: center;\">\n            <el-input-number \n              v-model=\"form.score\" \n              :precision=\"2\"\n              :step=\"0.1\"\n              :min=\"0\"\n              controls-position=\"right\"\n              style=\"width: 160px;\"\n            ></el-input-number>\n            <span style=\"margin-left: 10px; color: #606266;\">{{ selectedItemUnit }}</span>\n          </div>\n        </el-form-item>\n\n        <!-- 班级选择 -->\n        <el-form-item label=\"班级\" prop=\"className\">\n          <el-select v-model=\"form.className\" placeholder=\"请选择班级\" style=\"width: 100%\">\n            <el-option\n              v-for=\"className in classList\"\n              :key=\"className\"\n              :label=\"className\"\n              :value=\"className\"\n            ></el-option>\n          </el-select>\n        </el-form-item>\n      </el-form>\n\n      <!-- 对话框底部按钮 -->\n      <div slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"addDialog.visible = false\">取 消</el-button>\n        <el-button type=\"primary\" @click=\"submitForm\">确 定</el-button>\n      </div>\n    </el-dialog>\n\n    <!-- 审核对话框 -->\n    <el-dialog \n      title=\"成绩审核\" \n      :visible.sync=\"reviewDialog.visible\" \n      width=\"500px\"\n    >\n      <div class=\"review-info\" v-if=\"currentRecord\">\n        <el-descriptions :column=\"2\" border>\n          <el-descriptions-item label=\"学生\">{{ currentRecord.student ? currentRecord.student.realName : '-' }} ({{ currentRecord.studentNumber || '-' }})</el-descriptions-item>\n          <el-descriptions-item label=\"测试项目\">{{ currentRecord.sportsItem ? currentRecord.sportsItem.name : '-' }}</el-descriptions-item>\n          <el-descriptions-item label=\"测试成绩\">{{ currentRecord.score || '-' }} {{ currentRecord.sportsItem ? currentRecord.sportsItem.unit : '' }}</el-descriptions-item>\n          <el-descriptions-item label=\"班级\">{{ currentRecord.className || '-' }}</el-descriptions-item>\n          <el-descriptions-item label=\"录入教师\">{{ currentRecord.teacher ? currentRecord.teacher.realName : '-' }}</el-descriptions-item>\n          <el-descriptions-item label=\"录入时间\">{{ formatDateTime(currentRecord.createdAt) }}</el-descriptions-item>\n        </el-descriptions>\n      </div>\n      <el-form :model=\"reviewForm\" ref=\"reviewForm\" :rules=\"reviewRules\" class=\"review-form\">\n        <el-form-item label=\"审核结果\" prop=\"status\">\n          <el-radio-group v-model=\"reviewForm.status\">\n            <el-radio label=\"APPROVED\">通过</el-radio>\n            <el-radio label=\"REJECTED\">驳回</el-radio>\n          </el-radio-group>\n        </el-form-item>\n        <el-form-item label=\"审核意见\" prop=\"comment\">\n          <el-input \n            type=\"textarea\" \n            v-model=\"reviewForm.comment\"\n            :rows=\"3\"\n            placeholder=\"请输入审核意见\">\n          </el-input>\n        </el-form-item>\n      </el-form>\n      <div slot=\"footer\">\n        <el-button @click=\"reviewDialog.visible = false\">取消</el-button>\n        <el-button type=\"primary\" @click=\"submitReview\">确定</el-button>\n      </div>\n    </el-dialog>\n\n    <!-- 详情对话框 -->\n    <el-dialog \n      title=\"成绩详情\" \n      :visible.sync=\"detailDialog.visible\" \n      width=\"600px\"\n    >\n      <div v-if=\"currentRecord\" class=\"detail-container\">\n        <el-descriptions :column=\"2\" border>\n          <el-descriptions-item label=\"学生姓名\">\n            {{ currentRecord.student ? currentRecord.student.realName : '-' }} ({{ currentRecord.studentNumber || '-' }})\n          </el-descriptions-item>\n          <el-descriptions-item label=\"学号\">\n            {{ currentRecord.student ? currentRecord.student.username : '-' }}\n          </el-descriptions-item>\n          <el-descriptions-item label=\"班级\">\n            {{ currentRecord.className || '-' }}\n          </el-descriptions-item>\n          <el-descriptions-item label=\"测试项目\">\n            {{ currentRecord.sportsItem ? currentRecord.sportsItem.name : '-' }}\n          </el-descriptions-item>\n          <el-descriptions-item label=\"测试成绩\">\n            {{ currentRecord.score || '-' }} {{ currentRecord.sportsItem ? currentRecord.sportsItem.unit : '' }}\n          </el-descriptions-item>\n          <el-descriptions-item label=\"记录教师\">\n            {{ currentRecord.teacher ? currentRecord.teacher.realName : '-' }}\n          </el-descriptions-item>\n          <el-descriptions-item label=\"审核状态\">\n            <el-tag :type=\"getStatusType(currentRecord.status)\">\n              {{ getStatusText(currentRecord.status) }}\n            </el-tag>\n          </el-descriptions-item>\n          <el-descriptions-item label=\"审核时间\">\n            {{ formatDateTime(currentRecord.reviewTime) || '-' }}\n          </el-descriptions-item>\n          <el-descriptions-item label=\"审核意见\" :span=\"2\">\n            {{ currentRecord.reviewComment || '-' }}\n          </el-descriptions-item>\n        </el-descriptions>\n\n        <!-- 如果需要显示历史成绩，可以添加一个表格 -->\n        <div class=\"history-records\" v-if=\"historyRecords.length > 0\">\n          <h3>历史成绩记录</h3>\n          <el-table :data=\"historyRecords\" size=\"small\" border stripe>\n            <el-table-column label=\"测试时间\" align=\"center\">\n              <template slot-scope=\"scope\">\n                {{ formatDateTime(scope.row.testTime) }}\n              </template>\n            </el-table-column>\n            <el-table-column label=\"成绩\" align=\"center\">\n              <template slot-scope=\"scope\">\n                {{ scope.row.score || '-' }} {{ scope.row.sportsItem ? scope.row.sportsItem.unit : '' }}\n              </template>\n            </el-table-column>\n            <el-table-column label=\"状态\" align=\"center\">\n              <template slot-scope=\"scope\">\n                <el-tag :type=\"getStatusType(scope.row.status)\">\n                  {{ getStatusText(scope.row.status) }}\n                </el-tag>\n              </template>\n            </el-table-column>\n          </el-table>\n        </div>\n      </div>\n    </el-dialog>\n\n    <!-- 修改对话框 -->\n    <el-dialog \n      title=\"修改审核状态\" \n      :visible.sync=\"modifyDialog.visible\" \n      width=\"400px\"\n    >\n      <div class=\"review-info\">\n        <p>学生：{{ currentRecord ? currentRecord.student ? currentRecord.student.realName : '-' : '-' }} ({{ currentRecord ? currentRecord.studentNumber : '-' }})</p>\n        <p>项目：{{ currentRecord ? currentRecord.sportsItem ? currentRecord.sportsItem.name : '-' : '-' }}</p>\n        <p>成绩：{{ currentRecord ? currentRecord.score : '-' }} {{ currentRecord ? currentRecord.sportsItem ? currentRecord.sportsItem.unit : '' : '' }}</p>\n      </div>\n      <el-form :model=\"modifyForm\" :rules=\"modifyRules\" ref=\"modifyForm\" label-width=\"80px\">\n        <el-form-item label=\"审核状态\" prop=\"status\">\n          <el-select v-model=\"modifyForm.status\" placeholder=\"请选择审核状态\">\n            <el-option label=\"待审核\" value=\"PENDING\"></el-option>\n            <el-option label=\"通过\" value=\"APPROVED\"></el-option>\n            <el-option label=\"驳回\" value=\"REJECTED\"></el-option>\n          </el-select>\n        </el-form-item>\n        <el-form-item label=\"审核意见\" prop=\"comment\">\n          <el-input\n            type=\"textarea\"\n            v-model=\"modifyForm.comment\"\n            :rows=\"3\"\n            placeholder=\"请输入审核意见\"\n          ></el-input>\n        </el-form-item>\n      </el-form>\n      <div slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"modifyDialog.visible = false\">取 消</el-button>\n        <el-button type=\"primary\" @click=\"submitModify\">确 定</el-button>\n      </div>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport { \n  getTestRecords, \n  addTestRecord, \n  reviewTestRecord,\n  getHistoryRecords,\n  exportRecords,\n  downloadTemplate,\n  modifyReview\n} from '@/api/testRecord'\n\nexport default {\n  name: 'DataReview',\n  data() {\n    return {\n      loading: false,\n      records: [],\n      total: 0,\n      currentPage: 1,\n      pageSize: 10,\n      filters: {\n        sportsItemId: undefined,\n        status: undefined,\n        keyword: ''\n      },\n      sportsItems: [],\n      classList: [],\n      addDialog: {\n        visible: false\n      },\n      form: {\n        studentId: null,\n        sportsItemId: null,\n        score: null,\n        className: null\n      },\n      rules: {\n        studentId: [\n          { required: true, message: '请选择学生', trigger: 'change' }\n        ],\n        sportsItemId: [\n          { required: true, message: '请选择测试项目', trigger: 'change' }\n        ],\n        score: [\n          { required: true, message: '请输入测试成绩', trigger: 'blur' },\n          { type: 'number', message: '成绩必须为数字', trigger: 'blur' }\n        ],\n        className: [\n          { required: true, message: '请选择班级', trigger: 'change' }\n        ]\n      },\n      teachers: [],\n      selectedItemUnit: '',\n      students: [],\n      reviewDialog: {\n        visible: false\n      },\n      currentRecord: null,\n      reviewForm: {\n        id: null,\n        status: '',\n        comment: ''\n      },\n      reviewRules: {\n        status: [{ required: true, message: '请选择审核结果', trigger: 'change' }],\n        comment: [{ required: true, message: '请输入审核意见', trigger: 'blur' }]\n      },\n      studentLoading: false,\n      detailDialog: {\n        visible: false\n      },\n      historyRecords: [],\n      modifyDialog: {\n        visible: false\n      },\n      modifyForm: {\n        id: null,\n        status: '',\n        comment: ''\n      },\n      modifyRules: {\n        status: [{ required: true, message: '请选择审核状态', trigger: 'change' }],\n        comment: [{ required: true, message: '请输入审核意见', trigger: 'blur' }]\n      },\n    }\n  },\n  created() {\n    this.init()\n  },\n  methods: {\n    async init() {\n      await Promise.all([\n        this.getSportsItems(),\n        this.fetchRecords()\n      ])\n    },\n    async fetchRecords() {\n      try {\n        this.loading = true;\n        const { sportsItemId, status, keyword } = this.filters;\n        const response = await this.$http.get('/api/admin/test-records', {\n          params: {\n            sportsItemId,\n            status,\n            keyword,\n            page: this.currentPage - 1,\n            size: this.pageSize\n          }\n        });\n        \n        if (response.data.code === 200) {\n          const { content, totalElements } = response.data.data;\n          this.records = content;\n          this.total = totalElements;\n        } else {\n          this.$message.error(response.data.msg || '获取数据失败');\n        }\n      } catch (error) {\n        console.error('获取记录失败:', error);\n        this.$message.error('获取记录失败');\n      } finally {\n        this.loading = false;\n      }\n    },\n    async getSportsItems() {\n      try {\n        const res = await this.$http.get('/api/admin/sports-items')\n        if (res.data.code === 200) {\n          this.sportsItems = res.data.data || []\n        }\n      } catch (error) {\n        console.error('获取体测项目列表失败:', error)\n        this.$message.error('获取体测项目列表失败')\n      }\n    },\n    handleSearch() {\n      this.currentPage = 1\n      this.fetchRecords()\n    },\n    resetFilters() {\n      this.$refs.filterForm.resetFields()\n      this.filters = {\n        sportsItemId: undefined,\n        status: undefined,\n        keyword: ''\n      }\n      this.handleSearch()\n    },\n    getStatusType(status) {\n      const types = {\n        PENDING: 'warning',\n        APPROVED: 'success',\n        REJECTED: 'danger'\n      }\n      return types[status] || 'info'\n    },\n    getStatusText(status) {\n      const texts = {\n        PENDING: '待审核',\n        APPROVED: '已通过',\n        REJECTED: '已驳回'\n      }\n      return texts[status] || status\n    },\n    formatDateTime(datetime) {\n      if (!datetime) return ''\n      return new Date(datetime).toLocaleString()\n    },\n    showAddDialog() {\n      this.addDialog.visible = true\n    },\n    async exportData() {\n      try {\n        const response = await exportRecords(this.filters)\n        // 处理导出逻辑\n      } catch (error) {\n        this.$message.error('导出失败：' + error.message)\n      }\n    },\n    handleDialogClosed() {\n      this.$refs.recordForm.resetFields()\n    },\n    submitForm() {\n      this.$refs.recordForm.validate(async (valid) => {\n        if (valid) {\n          try {\n            const response = await addTestRecord(this.form)\n            if (response.data.code === 200) {\n              this.$message.success('成绩录入成功')\n              this.addDialog.visible = false\n              this.handleSearch()\n            } else {\n              this.$message.error(response.data.msg || '录入失败')\n            }\n          } catch (error) {\n            console.error('录入失败:', error)\n            this.$message.error('录入失败')\n          }\n        }\n      })\n    },\n    handleReview(record) {\n      this.currentRecord = record\n      this.reviewDialog.visible = true\n    },\n    submitReview() {\n      this.$refs.reviewForm.validate(async (valid) => {\n        if (valid) {\n          try {\n            const response = await reviewTestRecord(this.currentRecord.id, this.reviewForm)\n            if (response.data.code === 200) {\n              this.$message.success('审核成功')\n              this.reviewDialog.visible = false\n              this.handleSearch()\n            } else {\n              this.$message.error(response.data.msg || '审核失败')\n            }\n          } catch (error) {\n            console.error('审核失败:', error)\n            this.$message.error('审核失败')\n          }\n        }\n      })\n    },\n    handleEdit(record) {\n      this.currentRecord = record\n      this.detailDialog.visible = true\n    },\n    handleSportsItemChange(value) {\n      const item = this.sportsItems.find(i => i.id === value)\n      if (item) {\n        this.selectedItemUnit = item.unit\n      }\n    },\n    searchStudents(query) {\n      this.studentLoading = true\n      this.$http.get('/api/admin/students', {\n        params: {\n          query,\n          page: 0,\n          size: 10\n        }\n      }).then(response => {\n        if (response.data.code === 200) {\n          this.students = response.data.data.content || []\n        } else {\n          this.$message.error(response.data.msg || '获取学生列表失败')\n        }\n      }).finally(() => {\n        this.studentLoading = false\n      })\n    },\n    handleSizeChange(newSize) {\n      this.pageSize = newSize\n      this.handleSearch()\n    },\n    handleCurrentChange(newPage) {\n      this.currentPage = newPage\n      this.handleSearch()\n    },\n    submitModify() {\n      this.$refs.modifyForm.validate(async (valid) => {\n        if (valid) {\n          try {\n            const response = await modifyReview(this.currentRecord.id, this.modifyForm)\n            if (response.data.code === 200) {\n              this.$message.success('审核状态修改成功')\n              this.modifyDialog.visible = false\n              this.handleSearch()\n            } else {\n              this.$message.error(response.data.msg || '修改失败')\n            }\n          } catch (error) {\n            console.error('修改失败:', error)\n            this.$message.error('修改失败')\n          }\n        }\n      })\n    }\n  }\n}\n</script>\n\n<style scoped>\n.data-review {\n  padding: 20px;\n}\n\n.header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 20px;\n}\n\n.filters {\n  margin-bottom: 20px;\n}\n\n.pagination-container {\n  margin-top: 20px;\n  text-align: right;\n}\n</style>"]}]}