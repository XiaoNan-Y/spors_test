{"remainingRequest":"C:\\Users\\HP\\Desktop\\sports_test\\sports_front\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\HP\\Desktop\\sports_test\\sports_front\\src\\views\\teacher\\AppealReview.vue?vue&type=style&index=0&id=026dd7e4&scoped=true&lang=css","dependencies":[{"path":"C:\\Users\\HP\\Desktop\\sports_test\\sports_front\\src\\views\\teacher\\AppealReview.vue","mtime":1742287303552},{"path":"C:\\Users\\HP\\Desktop\\sports_test\\sports_front\\node_modules\\css-loader\\dist\\cjs.js","mtime":1741946995932},{"path":"C:\\Users\\HP\\Desktop\\sports_test\\sports_front\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1741947007541},{"path":"C:\\Users\\HP\\Desktop\\sports_test\\sports_front\\node_modules\\postcss-loader\\src\\index.js","mtime":1741947003089},{"path":"C:\\Users\\HP\\Desktop\\sports_test\\sports_front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1741946992817},{"path":"C:\\Users\\HP\\Desktop\\sports_test\\sports_front\\node_modules\\vue-loader\\lib\\index.js","mtime":1741947007540}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQouYXBwZWFsLXJldmlldyB7DQogIHBhZGRpbmc6IDIwcHg7DQp9DQoNCi5zZWFyY2gtZm9ybSB7DQogIG1hcmdpbi1ib3R0b206IDIwcHg7DQp9DQoNCi5wYWdpbmF0aW9uLWNvbnRhaW5lciB7DQogIG1hcmdpbi10b3A6IDIwcHg7DQogIHRleHQtYWxpZ246IHJpZ2h0Ow0KfQ0K"},{"version":3,"sources":["AppealReview.vue"],"names":[],"mappings":";AAqRA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"AppealReview.vue","sourceRoot":"src/views/teacher","sourcesContent":["<template>\r\n  <div class=\"appeal-review\">\r\n    <el-card>\r\n      <div slot=\"header\" class=\"clearfix\">\r\n        <span>体测成绩申诉审核</span>\r\n      </div>\r\n\r\n      <!-- 搜索和筛选区域 -->\r\n      <el-form :inline=\"true\" :model=\"searchForm\" class=\"search-form\">\r\n        <el-form-item label=\"学生姓名\">\r\n          <el-input v-model=\"searchForm.studentName\" placeholder=\"请输入学生姓名\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"申诉状态\">\r\n          <el-select v-model=\"searchForm.status\" placeholder=\"请选择状态\">\r\n            <el-option label=\"全部\" value=\"\"></el-option>\r\n            <el-option label=\"待审核\" value=\"PENDING\"></el-option>\r\n            <el-option label=\"已通过\" value=\"APPROVED\"></el-option>\r\n            <el-option label=\"已驳回\" value=\"REJECTED\"></el-option>\r\n          </el-select>\r\n        </el-form-item>\r\n        <el-form-item>\r\n          <el-button type=\"primary\" @click=\"handleSearch\">查询</el-button>\r\n          <el-button @click=\"resetSearch\">重置</el-button>\r\n        </el-form-item>\r\n      </el-form>\r\n\r\n      <!-- 申诉列表 -->\r\n      <el-table :data=\"appealList\" v-loading=\"loading\" style=\"width: 100%\">\r\n        <el-table-column prop=\"studentNumber\" label=\"学号\" width=\"120\"></el-table-column>\r\n        <el-table-column prop=\"studentName\" label=\"学生姓名\" width=\"100\"></el-table-column>\r\n        <el-table-column prop=\"className\" label=\"班级\" width=\"120\"></el-table-column>\r\n        <el-table-column prop=\"type\" label=\"申请类型\" width=\"100\">\r\n          <template slot-scope=\"scope\">\r\n            {{ scope.row.type === 'EXEMPTION' ? '免测' : '重测' }}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"reason\" label=\"申请原因\" show-overflow-tooltip min-width=\"200\"></el-table-column>\r\n        <el-table-column prop=\"createdAt\" label=\"申请时间\" width=\"160\">\r\n          <template slot-scope=\"scope\">\r\n            {{ scope.row.createdAt | formatDate }}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"status\" label=\"状态\" width=\"100\">\r\n          <template slot-scope=\"scope\">\r\n            <el-tag :type=\"getStatusType(scope.row.status)\">{{ getStatusText(scope.row.status) }}</el-tag>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"reviewTime\" label=\"审核时间\" width=\"160\">\r\n          <template slot-scope=\"scope\">\r\n            {{ scope.row.reviewTime | formatDate }}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column label=\"操作\" width=\"150\" fixed=\"right\">\r\n          <template slot-scope=\"scope\">\r\n            <el-button\r\n              type=\"text\"\r\n              size=\"small\"\r\n              @click=\"handleReview(scope.row)\"\r\n              v-if=\"scope.row.status === 'PENDING_TEACHER'\"\r\n            >审核</el-button>\r\n            <el-button\r\n              type=\"text\"\r\n              size=\"small\"\r\n              @click=\"viewDetail(scope.row)\"\r\n            >查看</el-button>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n\r\n      <!-- 分页 -->\r\n      <div class=\"pagination-container\">\r\n        <el-pagination\r\n          @size-change=\"handleSizeChange\"\r\n          @current-change=\"handleCurrentChange\"\r\n          :current-page=\"page.current\"\r\n          :page-sizes=\"[10, 20, 30, 50]\"\r\n          :page-size=\"page.size\"\r\n          layout=\"total, sizes, prev, pager, next, jumper\"\r\n          :total=\"page.total\">\r\n        </el-pagination>\r\n      </div>\r\n\r\n      <!-- 审核对话框 -->\r\n      <el-dialog title=\"申诉审核\" :visible.sync=\"reviewDialogVisible\" width=\"500px\">\r\n        <el-form :model=\"reviewForm\" label-width=\"100px\">\r\n          <el-form-item label=\"审核结果\">\r\n            <el-radio-group v-model=\"reviewForm.status\">\r\n              <el-radio label=\"APPROVED\">通过</el-radio>\r\n              <el-radio label=\"REJECTED_TEACHER\">驳回</el-radio>\r\n            </el-radio-group>\r\n          </el-form-item>\r\n          <el-form-item label=\"审核意见\">\r\n            <el-input\r\n              type=\"textarea\"\r\n              v-model=\"reviewForm.teacherReviewComment\"\r\n              :rows=\"4\"\r\n              placeholder=\"请输入审核意见\">\r\n            </el-input>\r\n          </el-form-item>\r\n        </el-form>\r\n        <div slot=\"footer\" class=\"dialog-footer\">\r\n          <el-button @click=\"reviewDialogVisible = false\">取 消</el-button>\r\n          <el-button type=\"primary\" @click=\"submitReview\">确 定</el-button>\r\n        </div>\r\n      </el-dialog>\r\n\r\n      <!-- 详情对话框 -->\r\n      <el-dialog title=\"申诉详情\" :visible.sync=\"detailDialogVisible\" width=\"600px\">\r\n        <el-descriptions :column=\"2\" border>\r\n          <el-descriptions-item label=\"学号\">{{ currentAppeal.studentNumber }}</el-descriptions-item>\r\n          <el-descriptions-item label=\"学生姓名\">{{ currentAppeal.studentName }}</el-descriptions-item>\r\n          <el-descriptions-item label=\"班级\">{{ currentAppeal.className }}</el-descriptions-item>\r\n          <el-descriptions-item label=\"测试项目\">{{ currentAppeal.testItem }}</el-descriptions-item>\r\n          <el-descriptions-item label=\"原始成绩\">{{ currentAppeal.originalScore }}</el-descriptions-item>\r\n          <el-descriptions-item label=\"申诉原因\" :span=\"2\">{{ currentAppeal.appealReason }}</el-descriptions-item>\r\n          <el-descriptions-item label=\"申诉时间\">{{ currentAppeal.createTime | formatDate }}</el-descriptions-item>\r\n          <el-descriptions-item label=\"状态\">{{ getStatusText(currentAppeal.status) }}</el-descriptions-item>\r\n          <el-descriptions-item label=\"审核意见\" :span=\"2\" v-if=\"currentAppeal.comment\">\r\n            {{ currentAppeal.comment }}\r\n          </el-descriptions-item>\r\n          <el-descriptions-item label=\"修正成绩\" v-if=\"currentAppeal.correctedScore\">\r\n            {{ currentAppeal.correctedScore }}\r\n          </el-descriptions-item>\r\n          <el-descriptions-item label=\"审核时间\" v-if=\"currentAppeal.reviewTime\">\r\n            {{ currentAppeal.reviewTime | formatDate }}\r\n          </el-descriptions-item>\r\n        </el-descriptions>\r\n      </el-dialog>\r\n    </el-card>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { getAppealList, reviewAppeal } from '@/api/appeal'\r\nimport moment from 'moment'\r\n\r\nexport default {\r\n  name: 'AppealReview',\r\n  data() {\r\n    return {\r\n      loading: false,\r\n      searchForm: {\r\n        studentName: '',\r\n        status: ''\r\n      },\r\n      page: {\r\n        current: 1,\r\n        size: 10,\r\n        total: 0\r\n      },\r\n      appealList: [],\r\n      reviewDialogVisible: false,\r\n      detailDialogVisible: false,\r\n      reviewForm: {\r\n        id: null,\r\n        result: 'APPROVED',\r\n        correctedScore: null,\r\n        comment: ''\r\n      },\r\n      currentAppeal: {}\r\n    }\r\n  },\r\n  created() {\r\n    this.fetchAppealList()\r\n  },\r\n  filters: {\r\n    formatDate(value) {\r\n      if (!value) return ''\r\n      return moment(value).format('YYYY-MM-DD HH:mm:ss')\r\n    }\r\n  },\r\n  methods: {\r\n    async fetchAppealList() {\r\n      this.loading = true\r\n      try {\r\n        const res = await getAppealList({\r\n          ...this.searchForm,\r\n          page: this.page.current - 1,  // 后端分页从0开始\r\n          size: this.page.size\r\n        })\r\n        console.log('Appeal list response:', res)\r\n        // 确保appealList始终是一个数组，并正确解构后端返回的数据\r\n        this.appealList = res.data?.content || []\r\n        this.page.total = res.data?.totalElements || 0\r\n      } catch (error) {\r\n        this.$message.error('获取申诉列表失败')\r\n      } finally {\r\n        this.loading = false\r\n      }\r\n    },\r\n    handleSearch() {\r\n      this.page.current = 1\r\n      this.fetchAppealList()\r\n    },\r\n    resetSearch() {\r\n      this.searchForm = {\r\n        studentName: '',\r\n        status: ''\r\n      }\r\n      this.handleSearch()\r\n    },\r\n    handleSizeChange(val) {\r\n      this.page.size = val\r\n      this.fetchAppealList()\r\n    },\r\n    handleCurrentChange(val) {\r\n      this.page.current = val\r\n      this.fetchAppealList()\r\n    },\r\n    getStatusType(status) {\r\n      switch (status) {\r\n        case 'PENDING_TEACHER':\r\n          return 'warning'\r\n        case 'PENDING_ADMIN':\r\n          return 'warning'\r\n        case 'APPROVED':\r\n          return 'success'\r\n        case 'REJECTED_TEACHER':\r\n          return 'danger'\r\n        case 'REJECTED':\r\n          return 'danger'\r\n        default:\r\n          return 'info'\r\n      }\r\n    },\r\n    getStatusText(status) {\r\n      switch (status) {\r\n        case 'PENDING_TEACHER':\r\n          return '待教师审核'\r\n        case 'PENDING_ADMIN':\r\n          return '待管理员审核'\r\n        case 'APPROVED':\r\n          return '已通过'\r\n        case 'REJECTED_TEACHER':\r\n          return '教师驳回'\r\n        case 'REJECTED':\r\n          return '最终驳回'\r\n        default:\r\n          return '未知'\r\n      }\r\n    },\r\n    handleReview(row) {\r\n      this.currentAppeal = row\r\n      this.reviewForm = {\r\n        id: row.id,\r\n        status: 'APPROVED',\r\n        teacherReviewComment: ''\r\n      }\r\n      this.reviewDialogVisible = true\r\n    },\r\n    async submitReview() {\r\n      try {\r\n        const { id } = this.currentAppeal\r\n        const { status, teacherReviewComment } = this.reviewForm\r\n\r\n        await teacherReview(id, {\r\n          status,\r\n          teacherReviewComment,\r\n          teacherReviewTime: new Date().toISOString()\r\n        })\r\n\r\n        this.$message.success('审核提交成功')\r\n        this.reviewDialogVisible = false\r\n        this.fetchAppealList()\r\n      } catch (error) {\r\n        this.$message.error('审核提交失败：' + error.message)\r\n      }\r\n    },\r\n    viewDetail(row) {\r\n      this.currentAppeal = { ...row }\r\n      this.detailDialogVisible = true\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.appeal-review {\r\n  padding: 20px;\r\n}\r\n\r\n.search-form {\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.pagination-container {\r\n  margin-top: 20px;\r\n  text-align: right;\r\n}\r\n</style>"]}]}