{"remainingRequest":"C:\\Users\\HP\\Desktop\\sports_test\\sports_front\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\HP\\Desktop\\sports_test\\sports_front\\src\\views\\student\\ScoreAppeal.vue?vue&type=style&index=0&id=29fd5c23&lang=scss&scoped=true","dependencies":[{"path":"C:\\Users\\HP\\Desktop\\sports_test\\sports_front\\src\\views\\student\\ScoreAppeal.vue","mtime":1742467071106},{"path":"C:\\Users\\HP\\Desktop\\sports_test\\sports_front\\node_modules\\css-loader\\dist\\cjs.js","mtime":1741946995932},{"path":"C:\\Users\\HP\\Desktop\\sports_test\\sports_front\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1741947007541},{"path":"C:\\Users\\HP\\Desktop\\sports_test\\sports_front\\node_modules\\postcss-loader\\src\\index.js","mtime":1741947003089},{"path":"C:\\Users\\HP\\Desktop\\sports_test\\sports_front\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1741947006026},{"path":"C:\\Users\\HP\\Desktop\\sports_test\\sports_front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1741946992817},{"path":"C:\\Users\\HP\\Desktop\\sports_test\\sports_front\\node_modules\\vue-loader\\lib\\index.js","mtime":1741947007540}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5zY29yZS1hcHBlYWwgewogIHBhZGRpbmc6IDIwcHg7CgogIC5pbmZvLWNhcmQgewogICAgbWFyZ2luLWJvdHRvbTogMjBweDsKICAgIAogICAgLmluZm8tY29udGVudCB7CiAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgIGFsaWduLWl0ZW1zOiBmbGV4LXN0YXJ0OwoKICAgICAgLmVsLWljb24taW5mbyB7CiAgICAgICAgZm9udC1zaXplOiAyNHB4OwogICAgICAgIGNvbG9yOiAjNDA5RUZGOwogICAgICAgIG1hcmdpbi1yaWdodDogMTVweDsKICAgICAgfQoKICAgICAgLmluZm8tdGV4dCB7CiAgICAgICAgaDMgewogICAgICAgICAgbWFyZ2luOiAwIDAgMTBweDsKICAgICAgICAgIGNvbG9yOiAjMzAzMTMzOwogICAgICAgIH0KCiAgICAgICAgcCB7CiAgICAgICAgICBtYXJnaW46IDA7CiAgICAgICAgICBjb2xvcjogIzYwNjI2NjsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgogIC5vcGVyYXRpb24tYmFyIHsKICAgIG1hcmdpbjogMjBweCAwOwogIH0KCiAgLy8g5re75Yqg5LiA5Lqb5Yqo55S75pWI5p6cCiAgLmVsLWRpYWxvZyB7CiAgICAuZWwtc2VsZWN0IHsKICAgICAgd2lkdGg6IDEwMCU7CiAgICB9CiAgICAKICAgIC5lbC1pbnB1dC1udW1iZXIgewogICAgICB3aWR0aDogMTgwcHg7CiAgICB9CiAgICAKICAgIC5lbC10ZXh0YXJlYSB7CiAgICAgIHRleHRhcmVhIHsKICAgICAgICB0cmFuc2l0aW9uOiBib3JkZXItY29sb3IgMC4zczsKICAgICAgICAmOmhvdmVyLCAmOmZvY3VzIHsKICAgICAgICAgIGJvcmRlci1jb2xvcjogIzQwOUVGRjsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgogIC8vIOa3u+WKoOihqOagvOWGheWuueeahOagt+W8jwogIC5lbC10YWJsZSB7CiAgICBtYXJnaW4tdG9wOiAyMHB4OwogICAgCiAgICAuZWwtdGFnIHsKICAgICAgbWFyZ2luOiAwOwogICAgfQogICAgCiAgICAuY2VsbCB7CiAgICAgIHdoaXRlLXNwYWNlOiBwcmUtbGluZTsKICAgIH0KICB9Cn0K"},{"version":3,"sources":["ScoreAppeal.vue"],"names":[],"mappings":";AA+QA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"ScoreAppeal.vue","sourceRoot":"src/views/student","sourcesContent":["<template>\n  <div class=\"score-appeal\">\n    <!-- 顶部说明卡片 -->\n    <el-card class=\"info-card\">\n      <div class=\"info-content\">\n        <i class=\"el-icon-info\"></i>\n        <div class=\"info-text\">\n          <h3>体测成绩申诉</h3>\n          <p>如果您对体测成绩有异议，可以在此提交申诉。请详细说明申诉理由，我们会尽快处理。</p>\n        </div>\n      </div>\n    </el-card>\n\n    <!-- 申诉按钮 -->\n    <div class=\"operation-bar\">\n      <el-button type=\"primary\" @click=\"dialogVisible = true\">\n        提交申诉\n      </el-button>\n    </div>\n\n    <!-- 申诉记录列表 -->\n    <el-table\n      :data=\"appealList\"\n      border\n      style=\"width: 100%\"\n      v-loading=\"loading\"\n    >\n      <el-table-column prop=\"createTime\" label=\"申诉时间\" width=\"180\">\n        <template slot-scope=\"scope\">\n          {{ formatDateTime(scope.row.createTime) }}\n        </template>\n      </el-table-column>\n      <el-table-column prop=\"sportsItemName\" label=\"测试项目\"></el-table-column>\n      <el-table-column prop=\"originalScore\" label=\"原始成绩\"></el-table-column>\n      <el-table-column prop=\"expectedScore\" label=\"期望成绩\"></el-table-column>\n      <el-table-column prop=\"reason\" label=\"申诉理由\" show-overflow-tooltip></el-table-column>\n      <el-table-column prop=\"status\" label=\"状态\" width=\"100\">\n        <template slot-scope=\"scope\">\n          <el-tag :type=\"getStatusType(scope.row.status)\">\n            {{ getStatusText(scope.row.status) }}\n          </el-tag>\n        </template>\n      </el-table-column>\n      <el-table-column prop=\"reviewComment\" label=\"审核意见\" show-overflow-tooltip></el-table-column>\n      <el-table-column prop=\"reviewTime\" label=\"审核时间\" width=\"180\">\n        <template slot-scope=\"scope\">\n          {{ formatDateTime(scope.row.reviewTime) }}\n        </template>\n      </el-table-column>\n    </el-table>\n\n    <!-- 申诉表单对话框 -->\n    <el-dialog \n      title=\"提交申诉\" \n      :visible.sync=\"dialogVisible\"\n      width=\"600px\"\n      :destroy-on-close=\"true\"\n      :close-on-click-modal=\"false\"\n    >\n      <el-form \n        :model=\"appealForm\" \n        :rules=\"rules\" \n        ref=\"appealForm\" \n        label-width=\"100px\"\n      >\n        <el-form-item label=\"测试记录\" prop=\"testRecordId\">\n          <el-select \n            v-model=\"appealForm.testRecordId\" \n            placeholder=\"请选择要申诉的测试记录\"\n            style=\"width: 100%\"\n            @change=\"handleRecordChange\"\n          >\n            <el-option\n              v-for=\"record in testRecords\"\n              :key=\"record.id\"\n              :label=\"`${record.sportsItemName} - ${record.score}分`\"\n              :value=\"record.id\"\n            >\n              <span style=\"float: left\">{{ record.sportsItemName }}</span>\n              <span style=\"float: right; color: #8492a6; font-size: 13px\">{{ record.score }}分</span>\n            </el-option>\n          </el-select>\n        </el-form-item>\n        <el-form-item label=\"期望成绩\" prop=\"expectedScore\">\n          <el-input-number \n            v-model=\"appealForm.expectedScore\" \n            :min=\"0\" \n            :max=\"100\"\n            :precision=\"1\"\n            :step=\"0.1\"\n            :controls-position=\"'right'\"\n            style=\"width: 200px\"\n          ></el-input-number>\n        </el-form-item>\n        <el-form-item label=\"申诉理由\" prop=\"reason\">\n          <el-input \n            type=\"textarea\" \n            v-model=\"appealForm.reason\"\n            :rows=\"4\"\n            placeholder=\"请详细说明申诉理由，例如：成绩记录错误、测试过程中的特殊情况等...\"\n          ></el-input>\n        </el-form-item>\n      </el-form>\n      <div slot=\"footer\">\n        <el-button @click=\"dialogVisible = false\">取 消</el-button>\n        <el-button type=\"primary\" @click=\"submitAppeal\" :loading=\"submitting\">\n          提 交\n        </el-button>\n      </div>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: 'ScoreAppeal',\n  data() {\n    return {\n      loading: false,\n      submitting: false,\n      dialogVisible: false,\n      appealList: [],\n      testRecords: [], // 存储已通过审核的测试记录\n      currentRecord: null,\n      appealForm: {\n        testRecordId: '',\n        expectedScore: undefined,\n        reason: ''\n      },\n      rules: {\n        testRecordId: [\n          { required: true, message: '请选择要申诉的测试记录', trigger: 'change' }\n        ],\n        expectedScore: [\n          { required: true, message: '请输入期望成绩', trigger: 'blur' }\n        ],\n        reason: [\n          { required: true, message: '请输入申诉理由', trigger: 'blur' },\n          { min: 10, max: 500, message: '申诉理由长度应在10-500字之间', trigger: 'blur' }\n        ]\n      }\n    }\n  },\n  created() {\n    this.fetchAppealList()\n    this.fetchAppealableRecords() // 获取可申诉的记录\n  },\n  methods: {\n    // 获取可申诉的记录\n    async fetchAppealableRecords() {\n      try {\n        this.loading = true\n        const userId = localStorage.getItem('userId')\n        console.log('正在获取可申诉记录，userId:', userId)\n        \n        const response = await this.$axios.get('/api/student/test-records/appealable')\n        console.log('获取可申诉记录响应:', response.data)\n        \n        if (response.data.code === 200) {\n          this.testRecords = response.data.data\n          console.log('设置可申诉记录:', this.testRecords)\n          \n          if (this.testRecords.length === 0) {\n            this.$message.info('暂无可申诉的测试记录')\n          }\n        } else {\n          this.$message.error(response.data.message || '获取可申诉记录失败')\n        }\n      } catch (error) {\n        console.error('获取可申诉记录失败:', error)\n        this.$message.error('获取可申诉记录失败')\n      } finally {\n        this.loading = false\n      }\n    },\n\n    // 获取申诉列表\n    async fetchAppealList() {\n      try {\n        this.loading = true\n        const response = await this.$axios.get('/api/student/appeals')\n        console.log('获取到的申诉列表:', response.data)\n        \n        if (response.data.code === 200) {\n          // 确保返回的数据是数组\n          this.appealList = Array.isArray(response.data.data) ? \n            response.data.data : \n            (response.data.data.content || [])\n        } else {\n          this.$message.error(response.data.message || '获取申诉列表失败')\n        }\n      } catch (error) {\n        console.error('获取申诉列表失败:', error)\n        this.$message.error(error.response?.data?.message || '获取申诉列表失败')\n      } finally {\n        this.loading = false\n      }\n    },\n\n    // 处理记录选择变化\n    handleRecordChange(recordId) {\n      this.currentRecord = this.testRecords.find(r => r.id === recordId)\n      if (this.currentRecord) {\n        // 设置原始成绩\n        this.appealForm.expectedScore = this.currentRecord.score\n      }\n    },\n\n    // 提交申诉\n    submitAppeal() {\n      this.$refs.appealForm.validate(async valid => {\n        if (!valid) {\n          return\n        }\n\n        try {\n          this.submitting = true\n          // 构造提交数据，确保 expectedScore 是数字类型\n          const submitData = {\n            testRecordId: this.appealForm.testRecordId,\n            expectedScore: parseFloat(this.appealForm.expectedScore),\n            reason: this.appealForm.reason\n          }\n\n          const response = await this.$axios.post('/api/student/appeals', submitData)\n          \n          if (response.data.code === 200) {\n            this.$message.success('申诉提交成功')\n            this.dialogVisible = false\n            this.fetchAppealList()\n            this.$refs.appealForm.resetFields()\n          } else {\n            this.$message.error(response.data.message || '提交申诉失败')\n          }\n        } catch (error) {\n          console.error('提交申诉失败:', error)\n          this.$message.error(error.response?.data?.message || '提交申诉失败')\n        } finally {\n          this.submitting = false\n        }\n      })\n    },\n\n    // 状态显示相关方法\n    getStatusType(status) {\n      const types = {\n        'PENDING': 'warning',\n        'APPROVED': 'success',\n        'REJECTED': 'danger'\n      }\n      return types[status] || 'info'\n    },\n\n    getStatusText(status) {\n      const texts = {\n        'PENDING': '待审核',\n        'APPROVED': '已通过',\n        'REJECTED': '已驳回'\n      }\n      return texts[status] || status\n    },\n\n    formatDateTime(datetime) {\n      if (!datetime) return ''\n      return new Date(datetime).toLocaleString()\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.score-appeal {\n  padding: 20px;\n\n  .info-card {\n    margin-bottom: 20px;\n    \n    .info-content {\n      display: flex;\n      align-items: flex-start;\n\n      .el-icon-info {\n        font-size: 24px;\n        color: #409EFF;\n        margin-right: 15px;\n      }\n\n      .info-text {\n        h3 {\n          margin: 0 0 10px;\n          color: #303133;\n        }\n\n        p {\n          margin: 0;\n          color: #606266;\n        }\n      }\n    }\n  }\n\n  .operation-bar {\n    margin: 20px 0;\n  }\n\n  // 添加一些动画效果\n  .el-dialog {\n    .el-select {\n      width: 100%;\n    }\n    \n    .el-input-number {\n      width: 180px;\n    }\n    \n    .el-textarea {\n      textarea {\n        transition: border-color 0.3s;\n        &:hover, &:focus {\n          border-color: #409EFF;\n        }\n      }\n    }\n  }\n\n  // 添加表格内容的样式\n  .el-table {\n    margin-top: 20px;\n    \n    .el-tag {\n      margin: 0;\n    }\n    \n    .cell {\n      white-space: pre-line;\n    }\n  }\n}\n</style> "]}]}