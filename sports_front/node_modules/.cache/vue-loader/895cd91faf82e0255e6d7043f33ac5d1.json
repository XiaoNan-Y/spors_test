{"remainingRequest":"C:\\Users\\HP\\Desktop\\sports_test\\sports_front\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\HP\\Desktop\\sports_test\\sports_front\\src\\views\\admin\\TeacherManagement.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\Users\\HP\\Desktop\\sports_test\\sports_front\\src\\views\\admin\\TeacherManagement.vue","mtime":1742719169728},{"path":"C:\\Users\\HP\\Desktop\\sports_test\\sports_front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1741946992817},{"path":"C:\\Users\\HP\\Desktop\\sports_test\\sports_front\\node_modules\\babel-loader\\lib\\index.js","mtime":1741946991478},{"path":"C:\\Users\\HP\\Desktop\\sports_test\\sports_front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1741946992817},{"path":"C:\\Users\\HP\\Desktop\\sports_test\\sports_front\\node_modules\\vue-loader\\lib\\index.js","mtime":1741947007540}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBVc2VyRm9ybSBmcm9tICcuL1VzZXJGb3JtLnZ1ZScKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnVGVhY2hlck1hbmFnZW1lbnQnLAogIGNvbXBvbmVudHM6IHsKICAgIFVzZXJGb3JtCiAgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgdGVhY2hlcnM6IFtdLAogICAgICBsb2FkaW5nOiBmYWxzZSwKICAgICAgY3VycmVudFBhZ2U6IDEsCiAgICAgIHBhZ2VTaXplOiAxMCwKICAgICAgdG90YWw6IDAsCiAgICAgIGZpbHRlckZvcm06IHsKICAgICAgICBrZXl3b3JkOiAnJwogICAgICB9LAogICAgICBkaWFsb2dWaXNpYmxlOiBmYWxzZSwKICAgICAgaW1wb3J0RGlhbG9nVmlzaWJsZTogZmFsc2UsCiAgICAgIGRpYWxvZ1RpdGxlOiAn5re75Yqg5pWZ5biIJywKICAgICAgY3VycmVudFVzZXI6IG51bGwsCiAgICAgIGhlYWRlcnM6IHsKICAgICAgICAnWC1Ub2tlbic6IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCd0b2tlbicpCiAgICAgIH0sCiAgICAgIGltcG9ydFJlc3VsdDogewogICAgICAgIHRvdGFsOiAwLAogICAgICAgIHN1Y2Nlc3M6IDAsCiAgICAgICAgZmFpbGVkOiAwLAogICAgICAgIGVycm9yczogW10KICAgICAgfQogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgYXN5bmMgZmV0Y2hUZWFjaGVycygpIHsKICAgICAgdHJ5IHsKICAgICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlCiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLiRheGlvcy5nZXQoJy9hcGkvdXNlcnMvdGVhY2hlcnMnLCB7CiAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgcGFnZU51bTogdGhpcy5jdXJyZW50UGFnZSwKICAgICAgICAgICAgcGFnZVNpemU6IHRoaXMucGFnZVNpemUsCiAgICAgICAgICAgIGtleXdvcmQ6IHRoaXMuZmlsdGVyRm9ybS5rZXl3b3JkCiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5jb2RlID09PSAyMDApIHsKICAgICAgICAgIHRoaXMudGVhY2hlcnMgPSByZXNwb25zZS5kYXRhLmRhdGEuY29udGVudAogICAgICAgICAgdGhpcy50b3RhbCA9IHJlc3BvbnNlLmRhdGEuZGF0YS50b3RhbEVsZW1lbnRzCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IocmVzcG9uc2UuZGF0YS5tc2cgfHwgJ+iOt+WPluaVmeW4iOWIl+ihqOWksei0pScpCiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoZXJyb3IucmVzcG9uc2U/LmRhdGE/Lm1zZyB8fCBlcnJvci5tZXNzYWdlIHx8ICfojrflj5bmlZnluIjliJfooajlpLHotKUnKQogICAgICB9IGZpbmFsbHkgewogICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlCiAgICAgIH0KICAgIH0sCiAgICBoYW5kbGVTZWFyY2goKSB7CiAgICAgIHRoaXMuY3VycmVudFBhZ2UgPSAxCiAgICAgIHRoaXMuZmV0Y2hUZWFjaGVycygpCiAgICB9LAogICAgaGFuZGxlUGFnZUNoYW5nZShwYWdlKSB7CiAgICAgIHRoaXMuY3VycmVudFBhZ2UgPSBwYWdlCiAgICAgIHRoaXMuZmV0Y2hUZWFjaGVycygpCiAgICB9LAogICAgaGFuZGxlQWRkKCkgewogICAgICB0aGlzLmRpYWxvZ1RpdGxlID0gJ+a3u+WKoOaVmeW4iCcKICAgICAgdGhpcy5jdXJyZW50VXNlciA9IG51bGwKICAgICAgdGhpcy5kaWFsb2dWaXNpYmxlID0gdHJ1ZQogICAgfSwKICAgIGhhbmRsZUVkaXQocm93KSB7CiAgICAgIHRoaXMuZGlhbG9nVGl0bGUgPSAn57yW6L6R5pWZ5biIJwogICAgICB0aGlzLmN1cnJlbnRVc2VyID0gcm93CiAgICAgIHRoaXMuZGlhbG9nVmlzaWJsZSA9IHRydWUKICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gewogICAgICAgIHRoaXMuJHJlZnMudXNlckZvcm0uc2V0Rm9ybURhdGEocm93KQogICAgICB9KQogICAgfSwKICAgIGFzeW5jIGhhbmRsZURlbGV0ZShyb3cpIHsKICAgICAgdHJ5IHsKICAgICAgICBhd2FpdCB0aGlzLiRjb25maXJtKCfnoa7orqTliKDpmaTor6XmlZnluIg/JywgJ+aPkOekuicsIHsKICAgICAgICAgIHR5cGU6ICd3YXJuaW5nJwogICAgICAgIH0pCiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLiRheGlvcy5kZWxldGUoYC9hcGkvdXNlcnMvJHtyb3cuaWR9YCkKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5jb2RlID09PSAyMDApIHsKICAgICAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcygn5Yig6Zmk5oiQ5YqfJykKICAgICAgICAgIHRoaXMuZmV0Y2hUZWFjaGVycygpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IocmVzcG9uc2UuZGF0YS5tc2cgfHwgJ+WIoOmZpOWksei0pScpCiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGlmIChlcnJvciAhPT0gJ2NhbmNlbCcpIHsKICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+WIoOmZpOWksei0pe+8micgKyBlcnJvci5tZXNzYWdlKQogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGhhbmRsZVNhdmVkKCkgewogICAgICB0aGlzLmRpYWxvZ1Zpc2libGUgPSBmYWxzZQogICAgICB0aGlzLmZldGNoVGVhY2hlcnMoKQogICAgfSwKICAgIGJlZm9yZVVwbG9hZChmaWxlKSB7CiAgICAgIGNvbnN0IGlzRXhjZWwgPSBmaWxlLnR5cGUgPT09ICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQuc3ByZWFkc2hlZXRtbC5zaGVldCcKICAgICAgY29uc3QgaXNMdDEwTSA9IGZpbGUuc2l6ZSAvIDEwMjQgLyAxMDI0IDwgMTAKCiAgICAgIGlmICghaXNFeGNlbCkgewogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+WPquiDveS4iuS8oCB4bHN4IOagvOW8j+eahOaWh+S7tiEnKQogICAgICAgIHJldHVybiBmYWxzZQogICAgICB9CiAgICAgIGlmICghaXNMdDEwTSkgewogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+aWh+S7tuWkp+Wwj+S4jeiDvei2hei/hyAxME1CIScpCiAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgIH0KICAgICAgcmV0dXJuIHRydWUKICAgIH0sCiAgICBoYW5kbGVVcGxvYWRTdWNjZXNzKHJlc3BvbnNlKSB7CiAgICAgIGlmIChyZXNwb25zZS5jb2RlID09PSAyMDApIHsKICAgICAgICB0aGlzLmltcG9ydFJlc3VsdCA9IHsKICAgICAgICAgIHRvdGFsOiByZXNwb25zZS5kYXRhLmxlbmd0aCwKICAgICAgICAgIHN1Y2Nlc3M6IHJlc3BvbnNlLmRhdGEubGVuZ3RoLAogICAgICAgICAgZmFpbGVkOiAwLAogICAgICAgICAgZXJyb3JzOiBbXQogICAgICAgIH0KICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoJ+WvvOWFpeaIkOWKnycpCiAgICAgICAgdGhpcy5mZXRjaFRlYWNoZXJzKCkKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmltcG9ydFJlc3VsdCA9IHsKICAgICAgICAgIHRvdGFsOiAwLAogICAgICAgICAgc3VjY2VzczogMCwKICAgICAgICAgIGZhaWxlZDogMSwKICAgICAgICAgIGVycm9yczogW3Jlc3BvbnNlLm1lc3NhZ2VdCiAgICAgICAgfQogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IocmVzcG9uc2UubWVzc2FnZSkKICAgICAgfQogICAgfSwKICAgIGhhbmRsZVVwbG9hZEVycm9yKGVycikgewogICAgICB0aGlzLmltcG9ydFJlc3VsdCA9IHsKICAgICAgICB0b3RhbDogMCwKICAgICAgICBzdWNjZXNzOiAwLAogICAgICAgIGZhaWxlZDogMSwKICAgICAgICBlcnJvcnM6IFtlcnIubWVzc2FnZSB8fCAn5a+85YWl5aSx6LSlJ10KICAgICAgfQogICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCflr7zlhaXlpLHotKUnKQogICAgfSwKICAgIGRvd25sb2FkVGVtcGxhdGUoKSB7CiAgICAgIC8vIOWIm+W7uuS4gOS4qumTvuaOpeadpeS4i+i9veaooeadvwogICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpCiAgICAgIGxpbmsuaHJlZiA9ICcvdGVtcGxhdGVzL3RlYWNoZXJfaW1wb3J0X3RlbXBsYXRlLnhsc3gnIC8vIOi/meS4qui3r+W+hOmcgOimgeWQjuerr+aPkOS+mwogICAgICBsaW5rLmRvd25sb2FkID0gJ+aVmeW4iOWvvOWFpeaooeadvy54bHN4JwogICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGxpbmspCiAgICAgIGxpbmsuY2xpY2soKQogICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGxpbmspCiAgICB9CiAgfSwKICBjcmVhdGVkKCkgewogICAgdGhpcy5mZXRjaFRlYWNoZXJzKCkKICB9Cn0K"},{"version":3,"sources":["TeacherManagement.vue"],"names":[],"mappings":";AA6FA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"TeacherManagement.vue","sourceRoot":"src/views/admin","sourcesContent":["<template>\n  <div class=\"teacher-management\">\n    <div class=\"filter-section\">\n      <el-form :inline=\"true\" :model=\"filterForm\">\n        <el-form-item>\n          <el-input\n            v-model=\"filterForm.keyword\"\n            placeholder=\"搜索姓名\"\n            clearable\n            @clear=\"handleSearch\">\n          </el-input>\n        </el-form-item>\n        <el-form-item>\n          <el-button type=\"primary\" @click=\"handleSearch\">搜索</el-button>\n          <el-button type=\"success\" @click=\"handleAdd\">添加教师</el-button>\n          \n        </el-form-item>\n      </el-form>\n    </div>\n\n    <el-table :data=\"teachers\" border v-loading=\"loading\">\n      <el-table-column prop=\"username\" label=\"用户名\"></el-table-column>\n      <el-table-column prop=\"realName\" label=\"姓名\"></el-table-column>\n      <el-table-column prop=\"email\" label=\"邮箱\"></el-table-column>\n      <el-table-column prop=\"phone\" label=\"电话\"></el-table-column>\n      <el-table-column label=\"操作\" width=\"200\">\n        <template slot-scope=\"scope\">\n          <el-button size=\"mini\" @click=\"handleEdit(scope.row)\">编辑</el-button>\n          <el-button size=\"mini\" type=\"danger\" @click=\"handleDelete(scope.row)\">删除</el-button>\n        </template>\n      </el-table-column>\n    </el-table>\n\n    <el-pagination\n      @current-change=\"handlePageChange\"\n      :current-page.sync=\"currentPage\"\n      :page-size=\"pageSize\"\n      layout=\"total, prev, pager, next\"\n      :total=\"total\">\n    </el-pagination>\n\n    <!-- 添加/编辑对话框 -->\n    <el-dialog :title=\"dialogTitle\" :visible.sync=\"dialogVisible\">\n      <user-form\n        ref=\"userForm\"\n        :user-type=\"'TEACHER'\"\n        @saved=\"handleSaved\">\n      </user-form>\n    </el-dialog>\n\n    <!-- Excel导入部分 -->\n    <el-dialog title=\"导入教师\" :visible.sync=\"importDialogVisible\" width=\"500px\">\n      <el-upload\n        class=\"upload-demo\"\n        drag\n        action=\"/api/admin/users/teacher/import\"\n        :headers=\"headers\"\n        :on-success=\"handleUploadSuccess\"\n        :on-error=\"handleUploadError\"\n        :before-upload=\"beforeUpload\"\n        :limit=\"1\"\n        accept=\".xlsx\">\n        <i class=\"el-icon-upload\"></i>\n        <div class=\"el-upload__text\">将文件拖到此处，或<em>点击上传</em></div>\n        <div class=\"el-upload__tip\" slot=\"tip\">\n          <p>只能上传xlsx文件，且文件大小不超过10MB</p>\n          <p>请按模板格式填写数据，<a href=\"javascript:;\" @click=\"downloadTemplate\">下载模板</a></p>\n        </div>\n      </el-upload>\n      <div class=\"import-result\" v-if=\"importResult.total\">\n        <p>导入结果：</p>\n        <p>总数：{{ importResult.total }}</p>\n        <p>成功：{{ importResult.success }}</p>\n        <p>失败：{{ importResult.failed }}</p>\n        <div v-if=\"importResult.errors.length\">\n          <p>错误信息：</p>\n          <ul>\n            <li v-for=\"(error, index) in importResult.errors\" :key=\"index\">{{ error }}</li>\n          </ul>\n        </div>\n      </div>\n    </el-dialog>\n\n    <!-- 批量导入入口 -->\n    <div class=\"batch-import\">\n      <el-button type=\"primary\" @click=\"importDialogVisible = true\">\n        <i class=\"el-icon-upload2\"></i> 批量导入\n      </el-button>\n    </div>\n  </div>\n</template>\n\n<script>\nimport UserForm from './UserForm.vue'\n\nexport default {\n  name: 'TeacherManagement',\n  components: {\n    UserForm\n  },\n  data() {\n    return {\n      teachers: [],\n      loading: false,\n      currentPage: 1,\n      pageSize: 10,\n      total: 0,\n      filterForm: {\n        keyword: ''\n      },\n      dialogVisible: false,\n      importDialogVisible: false,\n      dialogTitle: '添加教师',\n      currentUser: null,\n      headers: {\n        'X-Token': localStorage.getItem('token')\n      },\n      importResult: {\n        total: 0,\n        success: 0,\n        failed: 0,\n        errors: []\n      }\n    }\n  },\n  methods: {\n    async fetchTeachers() {\n      try {\n        this.loading = true\n        const response = await this.$axios.get('/api/users/teachers', {\n          params: {\n            pageNum: this.currentPage,\n            pageSize: this.pageSize,\n            keyword: this.filterForm.keyword\n          }\n        })\n        if (response.data.code === 200) {\n          this.teachers = response.data.data.content\n          this.total = response.data.data.totalElements\n        } else {\n          this.$message.error(response.data.msg || '获取教师列表失败')\n        }\n      } catch (error) {\n        this.$message.error(error.response?.data?.msg || error.message || '获取教师列表失败')\n      } finally {\n        this.loading = false\n      }\n    },\n    handleSearch() {\n      this.currentPage = 1\n      this.fetchTeachers()\n    },\n    handlePageChange(page) {\n      this.currentPage = page\n      this.fetchTeachers()\n    },\n    handleAdd() {\n      this.dialogTitle = '添加教师'\n      this.currentUser = null\n      this.dialogVisible = true\n    },\n    handleEdit(row) {\n      this.dialogTitle = '编辑教师'\n      this.currentUser = row\n      this.dialogVisible = true\n      this.$nextTick(() => {\n        this.$refs.userForm.setFormData(row)\n      })\n    },\n    async handleDelete(row) {\n      try {\n        await this.$confirm('确认删除该教师?', '提示', {\n          type: 'warning'\n        })\n        const response = await this.$axios.delete(`/api/users/${row.id}`)\n        if (response.data.code === 200) {\n          this.$message.success('删除成功')\n          this.fetchTeachers()\n        } else {\n          this.$message.error(response.data.msg || '删除失败')\n        }\n      } catch (error) {\n        if (error !== 'cancel') {\n          this.$message.error('删除失败：' + error.message)\n        }\n      }\n    },\n    handleSaved() {\n      this.dialogVisible = false\n      this.fetchTeachers()\n    },\n    beforeUpload(file) {\n      const isExcel = file.type === 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'\n      const isLt10M = file.size / 1024 / 1024 < 10\n\n      if (!isExcel) {\n        this.$message.error('只能上传 xlsx 格式的文件!')\n        return false\n      }\n      if (!isLt10M) {\n        this.$message.error('文件大小不能超过 10MB!')\n        return false\n      }\n      return true\n    },\n    handleUploadSuccess(response) {\n      if (response.code === 200) {\n        this.importResult = {\n          total: response.data.length,\n          success: response.data.length,\n          failed: 0,\n          errors: []\n        }\n        this.$message.success('导入成功')\n        this.fetchTeachers()\n      } else {\n        this.importResult = {\n          total: 0,\n          success: 0,\n          failed: 1,\n          errors: [response.message]\n        }\n        this.$message.error(response.message)\n      }\n    },\n    handleUploadError(err) {\n      this.importResult = {\n        total: 0,\n        success: 0,\n        failed: 1,\n        errors: [err.message || '导入失败']\n      }\n      this.$message.error('导入失败')\n    },\n    downloadTemplate() {\n      // 创建一个链接来下载模板\n      const link = document.createElement('a')\n      link.href = '/templates/teacher_import_template.xlsx' // 这个路径需要后端提供\n      link.download = '教师导入模板.xlsx'\n      document.body.appendChild(link)\n      link.click()\n      document.body.removeChild(link)\n    }\n  },\n  created() {\n    this.fetchTeachers()\n  }\n}\n</script>\n\n<style scoped>\n.teacher-management {\n  padding: 20px;\n}\n.filter-section {\n  margin-bottom: 20px;\n}\n.batch-import {\n  margin-top: 20px;\n}\n.import-result {\n  margin-top: 20px;\n  padding: 10px;\n  background-color: #f5f7fa;\n  border-radius: 4px;\n}\n.el-upload__tip {\n  line-height: 1.5;\n}\n</style> "]}]}