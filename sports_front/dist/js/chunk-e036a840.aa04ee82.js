(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e036a840"],{"762f":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"notice-management"},[e("div",{staticClass:"operation-bar"},[e("div",{staticClass:"search-area"},[e("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"输入标题搜索"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleSearch.apply(null,arguments)}},model:{value:t.searchKeyword,callback:function(e){t.searchKeyword=e},expression:"searchKeyword"}},[e("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:t.handleSearch},slot:"append"})],1),e("el-select",{staticStyle:{width:"120px","margin-left":"10px"},attrs:{placeholder:"通知类型"},model:{value:t.searchType,callback:function(e){t.searchType=e},expression:"searchType"}},[e("el-option",{attrs:{label:"全部",value:""}}),e("el-option",{attrs:{label:"体测安排",value:"TEST_SCHEDULE"}}),e("el-option",{attrs:{label:"成绩公布",value:"SCORE_RELEASE"}}),e("el-option",{attrs:{label:"其他通知",value:"OTHER"}})],1)],1),e("el-button",{attrs:{type:"primary"},on:{click:t.handleAdd}},[e("i",{staticClass:"el-icon-plus"}),t._v(" 发布通知 ")])],1),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.noticeList,border:"",stripe:""}},[e("el-table-column",{attrs:{prop:"id",label:"ID",width:"80"}}),e("el-table-column",{attrs:{prop:"type",label:"类型",width:"100"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-tag",{attrs:{type:t.getTypeTagType(a.row.type)}},[t._v(" "+t._s(t.getTypeLabel(a.row.type))+" ")])]}}])}),e("el-table-column",{attrs:{prop:"title",label:"标题","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",{class:{"important-notice":"HIGH"===a.row.priority}},[t._v(" "+t._s(a.row.title)+" ")])]}}])}),e("el-table-column",{attrs:{prop:"createTime",label:"发布时间",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.formatDate(e.row.createTime))+" ")]}}])}),e("el-table-column",{attrs:{prop:"status",label:"状态",width:"100"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-switch",{attrs:{"active-value":1,"inactive-value":0,"active-color":"#13ce66","inactive-color":"#ff4949",disabled:a.row.createBy!==t.$store.state.user.id},on:{change:function(e){return t.handleStatusChange(a.row)}},model:{value:a.row.status,callback:function(e){t.$set(a.row,"status",e)},expression:"scope.row.status"}})]}}])}),e("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button-group",{staticClass:"operation-group"},[e("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.handleView(a.row)}}},[t._v(" 查看 ")]),a.row.createBy===t.$store.state.user.id?e("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(e){return t.handleEdit(a.row)}}},[t._v(" 编辑 ")]):t._e(),a.row.createBy===t.$store.state.user.id?e("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(e){return t.handleDelete(a.row)}}},[t._v(" 删除 ")]):t._e()],1)]}}])})],1),e("div",{staticClass:"pagination-container"},[e("el-pagination",{attrs:{"current-page":t.page.current,"page-sizes":[10,20,50,100],"page-size":t.page.size,layout:"total, sizes, prev, pager, next, jumper",total:t.page.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),e("el-dialog",{attrs:{title:t.dialogTitle,visible:t.dialogVisible,width:"700px"},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"80px"}},[e("el-form-item",{attrs:{label:"通知类型",prop:"type"}},[e("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择通知类型"},model:{value:t.form.type,callback:function(e){t.$set(t.form,"type",e)},expression:"form.type"}},[e("el-option",{attrs:{label:"体测安排",value:"TEST_SCHEDULE"}}),e("el-option",{attrs:{label:"成绩公布",value:"SCORE_RELEASE"}}),e("el-option",{attrs:{label:"其他通知",value:"OTHER"}})],1)],1),e("el-form-item",{attrs:{label:"重要程度",prop:"priority"}},[e("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择重要程度"},model:{value:t.form.priority,callback:function(e){t.$set(t.form,"priority",e)},expression:"form.priority"}},[e("el-option",{attrs:{label:"普通",value:"NORMAL"}}),e("el-option",{attrs:{label:"重要",value:"HIGH"}})],1)],1),e("el-form-item",{attrs:{label:"标题",prop:"title"}},[e("el-input",{attrs:{maxlength:"100","show-word-limit":""},model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}})],1),e("el-form-item",{attrs:{label:"内容",prop:"content"}},[e("el-input",{attrs:{type:"textarea",rows:10,maxlength:"2000","show-word-limit":""},model:{value:t.form.content,callback:function(e){t.$set(t.form,"content",e)},expression:"form.content"}})],1),e("el-form-item",{attrs:{label:"状态",prop:"status"}},[e("el-switch",{attrs:{"active-value":1,"inactive-value":0,"active-text":"启用","inactive-text":"禁用"},model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}})],1)],1),e("div",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.handleSubmit}},[t._v("确定")])],1)],1),e("el-dialog",{attrs:{title:"查看通知",visible:t.viewDialogVisible,width:"700px"},on:{"update:visible":function(e){t.viewDialogVisible=e}}},[e("div",{staticClass:"notice-header"},[e("el-tag",{staticClass:"notice-type",attrs:{type:t.getTypeTagType(t.currentNotice.type)}},[t._v(" "+t._s(t.getTypeLabel(t.currentNotice.type))+" ")]),e("h3",{staticClass:"notice-title"},[t._v(t._s(t.currentNotice.title))])],1),e("div",{staticClass:"notice-meta"},[e("span",[t._v("发布时间："+t._s(t.formatDate(t.currentNotice.createTime)))]),"HIGH"===t.currentNotice.priority?e("span",{staticClass:"notice-priority"},[e("i",{staticClass:"el-icon-warning"}),t._v(" 重要通知 ")]):t._e()]),e("div",{staticClass:"notice-content"},[t._v(t._s(t.currentNotice.content))])])],1)},s=[],r={name:"TeacherNoticeManagement",data(){return{searchKeyword:"",searchType:"",noticeList:[],loading:!1,dialogVisible:!1,viewDialogVisible:!1,dialogTitle:"",currentNotice:{},page:{current:1,size:10,total:0},form:{id:null,type:"OTHER",priority:"NORMAL",title:"",content:"",status:1,createTime:null,updateTime:null,createBy:this.$store.state.user.id},rules:{type:[{required:!0,message:"请选择通知类型",trigger:"change"}],priority:[{required:!0,message:"请选择重要程度",trigger:"change"}],title:[{required:!0,message:"请输入标题",trigger:"blur"},{max:100,message:"长度不能超过100个字符",trigger:"blur"}],content:[{required:!0,message:"请输入内容",trigger:"blur"},{max:2e3,message:"长度不能超过2000个字符",trigger:"blur"}]}}},created(){this.fetchNoticeList()},methods:{formatDate(t){return t?new Date(t).toLocaleString():""},getTypeTagType(t){const e={TEST_SCHEDULE:"primary",SCORE_RELEASE:"success",OTHER:"info"};return e[t]||"info"},getTypeLabel(t){const e={TEST_SCHEDULE:"体测安排",SCORE_RELEASE:"成绩公布",OTHER:"其他通知"};return e[t]||"其他通知"},async fetchNoticeList(){try{this.loading=!0;const t=await this.$http.get("/api/teacher/notices",{params:{keyword:this.searchKeyword,type:this.searchType,page:this.page.current-1,size:this.page.size}});200===t.data.code?Array.isArray(t.data.data)?(this.noticeList=t.data.data,this.page.total=t.data.data.length):t.data.data.content&&(this.noticeList=t.data.data.content,this.page.total=t.data.data.totalElements):this.$message.error(t.data.msg||"获取通知列表失败")}catch(t){console.error("获取通知列表失败:",t),this.$message.error("获取通知列表失败")}finally{this.loading=!1}},handleSearch(){this.page.current=1,this.fetchNoticeList()},handleSizeChange(t){this.page.size=t,this.fetchNoticeList()},handleCurrentChange(t){this.page.current=t,this.fetchNoticeList()},handleAdd(){this.dialogTitle="发布通知",this.form={id:null,type:"OTHER",priority:"NORMAL",title:"",content:"",status:1,createTime:null,updateTime:null,createBy:this.$store.state.user.id},this.dialogVisible=!0},handleView(t){this.currentNotice={...t},this.viewDialogVisible=!0},handleEdit(t){t.createBy===this.$store.state.user.id?(this.dialogTitle="编辑通知",this.form={...t},this.dialogVisible=!0):this.$message.warning("只能编辑自己发布的通知")},async handleSubmit(){this.$refs.form.validate(async t=>{if(t)try{const t=this.form.id?"/api/teacher/notices/"+this.form.id:"/api/teacher/notices",e=this.form.id?"put":"post",a=await this.$http[e](t,this.form);200===a.data.code?(this.$message.success(this.form.id?"更新成功":"添加成功"),this.dialogVisible=!1,this.fetchNoticeList()):this.$message.error(a.data.msg||"操作失败")}catch(a){var e;console.error("操作失败:",a),this.$message.error((null===(e=a.response)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.msg)||"操作失败")}})},async handleDelete(t){if(t.createBy===this.$store.state.user.id)try{await this.$confirm("确认删除该通知吗？","提示",{type:"warning"});const e=await this.$http.delete("/api/teacher/notices/"+t.id);200===e.data.code&&(this.$message.success("删除成功"),this.fetchNoticeList())}catch(e){"cancel"!==e&&this.$message.error("删除失败")}else this.$message.warning("只能删除自己发布的通知")},async handleStatusChange(t){if(t.createBy===this.$store.state.user.id)try{const e=await this.$http.put(`/api/teacher/notices/${t.id}/status`,{status:t.status});200===e.data.code?(this.$message.success("状态更新成功"),this.fetchNoticeList()):this.$message.error(e.data.msg||"状态更新失败")}catch(e){console.error("状态更新失败:",e),this.$message.error("状态更新失败")}else this.$message.warning("只能修改自己发布的通知")}}},l=r,o=(a("88b5"),a("2877")),n=Object(o["a"])(l,i,s,!1,null,"510dd82e",null);e["default"]=n.exports},"88b5":function(t,e,a){"use strict";a("ed53")},ed53:function(t,e,a){}}]);
//# sourceMappingURL=chunk-e036a840.aa04ee82.js.map