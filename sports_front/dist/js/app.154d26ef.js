(function(e){function t(t){for(var a,r,l=t[0],n=t[1],c=t[2],d=0,u=[];d<l.length;d++)r=l[d],Object.prototype.hasOwnProperty.call(o,r)&&o[r]&&u.push(o[r][0]),o[r]=0;for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a]);m&&m(t);while(u.length)u.shift()();return i.push.apply(i,c||[]),s()}function s(){for(var e,t=0;t<i.length;t++){for(var s=i[t],a=!0,r=1;r<s.length;r++){var l=s[r];0!==o[l]&&(a=!1)}a&&(i.splice(t--,1),e=n(n.s=s[0]))}return e}var a={},r={app:0},o={app:0},i=[];function l(e){return n.p+"js/"+({}[e]||e)+"."+{"chunk-0b7e33b0":"1250fe84","chunk-11d6ab97":"a3f3f60a","chunk-13199d7f":"110f192a","chunk-2e272d06":"a1c92c64","chunk-36afc62f":"2e92fd73","chunk-3ab03eee":"693d496e","chunk-3c786940":"8f371996","chunk-40d7f547":"43a32fe2","chunk-4520ee9f":"373d339a","chunk-46256bdf":"e9dd1419","chunk-4cff9319":"61d38fa3","chunk-521f1c06":"dd2c1b48","chunk-6177d41a":"faeae434","chunk-67d2f004":"aaa6c0cd","chunk-700a0965":"9e73f2ea","chunk-8d3a07ac":"2fb3246f","chunk-c1d6e44a":"84800fe4","chunk-eae0d316":"86b4d8a7"}[e]+".js"}function n(t){if(a[t])return a[t].exports;var s=a[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.e=function(e){var t=[],s={"chunk-0b7e33b0":1,"chunk-11d6ab97":1,"chunk-13199d7f":1,"chunk-2e272d06":1,"chunk-36afc62f":1,"chunk-3ab03eee":1,"chunk-3c786940":1,"chunk-40d7f547":1,"chunk-4520ee9f":1,"chunk-46256bdf":1,"chunk-4cff9319":1,"chunk-521f1c06":1,"chunk-6177d41a":1,"chunk-67d2f004":1,"chunk-700a0965":1,"chunk-8d3a07ac":1,"chunk-c1d6e44a":1,"chunk-eae0d316":1};r[e]?t.push(r[e]):0!==r[e]&&s[e]&&t.push(r[e]=new Promise((function(t,s){for(var a="css/"+({}[e]||e)+"."+{"chunk-0b7e33b0":"d37374c8","chunk-11d6ab97":"39ac6425","chunk-13199d7f":"e4e2cf67","chunk-2e272d06":"8c216a83","chunk-36afc62f":"fa02a399","chunk-3ab03eee":"42c17491","chunk-3c786940":"2c254c25","chunk-40d7f547":"53648753","chunk-4520ee9f":"4522c35f","chunk-46256bdf":"4baf2ada","chunk-4cff9319":"e23c90ff","chunk-521f1c06":"31ed745c","chunk-6177d41a":"5bd5237d","chunk-67d2f004":"d810f850","chunk-700a0965":"c70292ce","chunk-8d3a07ac":"3267fc9d","chunk-c1d6e44a":"11713cd8","chunk-eae0d316":"3df8f68c"}[e]+".css",o=n.p+a,i=document.getElementsByTagName("link"),l=0;l<i.length;l++){var c=i[l],d=c.getAttribute("data-href")||c.getAttribute("href");if("stylesheet"===c.rel&&(d===a||d===o))return t()}var u=document.getElementsByTagName("style");for(l=0;l<u.length;l++){c=u[l],d=c.getAttribute("data-href");if(d===a||d===o)return t()}var m=document.createElement("link");m.rel="stylesheet",m.type="text/css",m.onload=t,m.onerror=function(t){var a=t&&t.target&&t.target.src||o,i=new Error("Loading CSS chunk "+e+" failed.\n("+a+")");i.code="CSS_CHUNK_LOAD_FAILED",i.request=a,delete r[e],m.parentNode.removeChild(m),s(i)},m.href=o;var p=document.getElementsByTagName("head")[0];p.appendChild(m)})).then((function(){r[e]=0})));var a=o[e];if(0!==a)if(a)t.push(a[2]);else{var i=new Promise((function(t,s){a=o[e]=[t,s]}));t.push(a[2]=i);var c,d=document.createElement("script");d.charset="utf-8",d.timeout=120,n.nc&&d.setAttribute("nonce",n.nc),d.src=l(e);var u=new Error;c=function(t){d.onerror=d.onload=null,clearTimeout(m);var s=o[e];if(0!==s){if(s){var a=t&&("load"===t.type?"missing":t.type),r=t&&t.target&&t.target.src;u.message="Loading chunk "+e+" failed.\n("+a+": "+r+")",u.name="ChunkLoadError",u.type=a,u.request=r,s[1](u)}o[e]=void 0}};var m=setTimeout((function(){c({type:"timeout",target:d})}),12e4);d.onerror=d.onload=c,document.head.appendChild(d)}return Promise.all(t)},n.m=e,n.c=a,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(s,a,function(t){return e[t]}.bind(null,a));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n.oe=function(e){throw console.error(e),e};var c=window["webpackJsonp"]=window["webpackJsonp"]||[],d=c.push.bind(c);c.push=t,c=c.slice();for(var u=0;u<c.length;u++)t(c[u]);var m=d;i.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"0208":function(e,t,s){},"02c2":function(e,t,s){"use strict";s("166a")},"0c5e":function(e,t,s){"use strict";s("3e06")},"166a":function(e,t,s){},"1a2c":function(e,t,s){},"2f87":function(e,t,s){"use strict";s("0208")},"382e":function(e,t,s){"use strict";s("b1ef")},"3bd8":function(e,t,s){},"3e06":function(e,t,s){},"4ca1":function(e,t,s){},"56d7":function(e,t,s){"use strict";s.r(t);var a=s("2b0e"),r=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},o=[],i={name:"App"},l=i,n=(s("ee5d"),s("2877")),c=Object(n["a"])(l,r,o,!1,null,null,null),d=c.exports,u=s("8c4f"),m=function(){var e=this,t=e._self._c;return t("div",{staticClass:"login-container"},[t("el-form",{ref:"loginForm",staticClass:"login-form",attrs:{model:e.loginForm,rules:e.loginRules}},[t("h3",{staticClass:"title"},[e._v("体育测试管理系统")]),t("el-form-item",{attrs:{prop:"username"}},[t("el-input",{attrs:{placeholder:"用户名",type:"text","auto-complete":"off"},model:{value:e.loginForm.username,callback:function(t){e.$set(e.loginForm,"username",t)},expression:"loginForm.username"}})],1),t("el-form-item",{attrs:{prop:"password"}},[t("el-input",{attrs:{placeholder:"密码",type:"password","auto-complete":"off"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleLogin.apply(null,arguments)}},model:{value:e.loginForm.password,callback:function(t){e.$set(e.loginForm,"password",t)},expression:"loginForm.password"}})],1),t("el-button",{staticStyle:{width:"100%"},attrs:{loading:e.loading,type:"primary"},nativeOn:{click:function(t){return t.preventDefault(),e.handleLogin.apply(null,arguments)}}},[e._v(" 登录 ")])],1)],1)},p=[],h=(s("14d9"),{name:"Login",data(){return{loginForm:{username:"",password:""},loading:!1,loginRules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]}}},methods:{handleLogin(){this.$refs.loginForm.validate(async e=>{if(e)try{this.loading=!0,console.log("开始登录请求:",this.loginForm);const e=await this.$axios.post("/api/users/login",this.loginForm);if(console.log("登录响应:",e.data),200===e.data.code){localStorage.clear();const{id:t,token:s,userType:a,username:r,realName:o,className:i}=e.data.data;switch(localStorage.setItem("userId",t),localStorage.setItem("token",s),localStorage.setItem("userRole",a),localStorage.setItem("username",r),localStorage.setItem("realName",o),localStorage.setItem("className",i),console.log("存储的用户信息:",{userId:localStorage.getItem("userId"),username:localStorage.getItem("username"),userRole:localStorage.getItem("userRole")}),this.$message.success("登录成功"),a){case"STUDENT":this.$router.push("/student/home");break;case"TEACHER":this.$router.push("/teacher/dashboard");break;case"ADMIN":this.$router.push("/admin/dashboard");break;default:this.$router.push("/login")}}else this.$message.error(e.data.message||"登录失败")}catch(s){var t;console.error("登录失败:",s),this.$message.error((null===(t=s.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.message)||"登录失败")}finally{this.loading=!1}})}}}),f=h,g=(s("02c2"),Object(n["a"])(f,m,p,!1,null,"67606dde",null)),b=g.exports,v=function(){var e=this,t=e._self._c;return t("el-container",{staticClass:"admin-layout"},[t("el-aside",{attrs:{width:"200px"}},[t("el-menu",{staticClass:"el-menu-vertical",attrs:{"default-active":e.activeMenu,"background-color":"#304156","text-color":"#bfcbd9","active-text-color":"#409EFF",router:!0}},[t("el-menu-item",{attrs:{index:"/admin/dashboard"}},[t("i",{staticClass:"el-icon-s-home"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("首页")])]),t("el-submenu",{attrs:{index:"1"}},[t("template",{slot:"title"},[t("i",{staticClass:"el-icon-user"}),t("span",[e._v("用户管理")])]),t("el-menu-item",{attrs:{index:"/admin/users/student"}},[e._v("学生管理")]),t("el-menu-item",{attrs:{index:"/admin/users/teacher"}},[e._v("教师管理")])],2),t("el-menu-item",{attrs:{index:"/admin/sports-items"}},[t("i",{staticClass:"el-icon-trophy"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("体测项目管理")])]),t("el-menu-item",{attrs:{index:"/admin/notices"}},[t("i",{staticClass:"el-icon-bell"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("通知管理")])]),t("el-menu-item",{attrs:{index:"/admin/data-review"}},[t("i",{staticClass:"el-icon-document-checked"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("数据录入与审核")])]),t("el-menu-item",{attrs:{index:"/admin/exemption-review"}},[t("i",{staticClass:"el-icon-document"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("免测申请审核")])]),t("el-menu-item",{attrs:{index:"/admin/feedback"}},[t("i",{staticClass:"el-icon-message"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("反馈管理")])]),t("el-menu-item",{attrs:{index:"/admin/profile"}},[t("i",{staticClass:"el-icon-user"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("个人信息")])])],1)],1),t("el-container",[t("el-header",[t("div",{staticClass:"header-left"},[e._v("体育测试管理系统-管理员端")]),t("div",{staticClass:"header-right"},[t("el-dropdown",{on:{command:e.handleCommand}},[t("span",{staticClass:"el-dropdown-link"},[e._v(" "+e._s(e.username)),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"logout"}},[e._v("退出登录")])],1)],1)],1)]),t("el-main",[t("router-view")],1)],1)],1)},y=[],w={name:"AdminLayout",data(){return{username:localStorage.getItem("username")||"管理员",activeMenu:""}},created(){this.activeMenu=this.$route.path},methods:{handleCommand(e){"logout"===e&&(localStorage.clear(),this.$nextTick(async()=>{try{await this.$router.push("/login"),this.$message.success("已退出登录")}catch(e){console.error("退出登录时发生错误:",e)}}))}}},_=w,k=(s("71ed"),Object(n["a"])(_,v,y,!1,null,"13d40898",null)),S=k.exports,C=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"filter-section"},[t("el-form",{attrs:{inline:!0,model:e.filterForm}},[t("el-form-item",{attrs:{label:"状态"}},[t("el-select",{attrs:{placeholder:"选择状态"},model:{value:e.filterForm.status,callback:function(t){e.$set(e.filterForm,"status",t)},expression:"filterForm.status"}},[t("el-option",{attrs:{label:"全部",value:""}}),t("el-option",{attrs:{label:"待审核",value:"PENDING"}}),t("el-option",{attrs:{label:"已通过",value:"APPROVED"}}),t("el-option",{attrs:{label:"已驳回",value:"REJECTED"}})],1)],1),t("el-form-item",{attrs:{label:"体测项目"}},[t("el-select",{attrs:{placeholder:"选择项目"},model:{value:e.filterForm.sportsItemId,callback:function(t){e.$set(e.filterForm,"sportsItemId",t)},expression:"filterForm.sportsItemId"}},[t("el-option",{attrs:{label:"全部",value:""}}),e._l(e.sportsItems,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],2)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.fetchRecords}},[e._v("查询")]),t("el-button",{attrs:{type:"success"},on:{click:e.handleExport}},[e._v("导出")])],1)],1)],1),t("el-table",{attrs:{data:e.records,border:""}},[t("el-table-column",{attrs:{prop:"student.realName",label:"学生姓名"}}),t("el-table-column",{attrs:{prop:"student.studentNumber",label:"学号"}}),t("el-table-column",{attrs:{prop:"sportsItem.name",label:"测试项目"}}),t("el-table-column",{attrs:{prop:"score",label:"成绩"}}),t("el-table-column",{attrs:{prop:"testTime",label:"测试时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.formatDateTime(t.row.testTime))+" ")]}}])}),t("el-table-column",{attrs:{prop:"status",label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.getStatusText(t.row.status))+" ")]}}])}),t("el-table-column",{attrs:{prop:"reviewComment",label:"审核意见"}}),t("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(s){return["PENDING"===s.row.status?t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.handleReview(s.row)}}},[e._v(" 审核 ")]):e._e(),"PENDING"!==s.row.status?t("el-button",{attrs:{size:"mini",type:"warning"},on:{click:function(t){return e.handleModify(s.row)}}},[e._v(" 修改 ")]):e._e()]}}])})],1),t("el-pagination",{attrs:{"current-page":e.currentPage,"page-size":e.pageSize,layout:"total, prev, pager, next",total:e.total},on:{"current-change":e.handlePageChange,"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t}}}),t("test-record-review",{attrs:{visible:e.reviewDialogVisible,record:e.currentRecord},on:{"update:visible":function(t){e.reviewDialogVisible=t},success:e.handleReviewSuccess}}),t("el-dialog",{attrs:{title:"修改审核结果",visible:e.modifyDialogVisible,width:"500px"},on:{"update:visible":function(t){e.modifyDialogVisible=t}}},[t("el-form",{ref:"modifyForm",attrs:{model:e.modifyForm,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"审核状态",prop:"status"}},[t("el-radio-group",{model:{value:e.modifyForm.status,callback:function(t){e.$set(e.modifyForm,"status",t)},expression:"modifyForm.status"}},[t("el-radio",{attrs:{label:"APPROVED"}},[e._v("通过")]),t("el-radio",{attrs:{label:"REJECTED"}},[e._v("驳回")])],1)],1),t("el-form-item",{attrs:{label:"审核意见",prop:"comment"}},[t("el-input",{attrs:{type:"textarea",rows:3,placeholder:"请输入审核意见"},model:{value:e.modifyForm.comment,callback:function(t){e.$set(e.modifyForm,"comment",t)},expression:"modifyForm.comment"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.modifyDialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submitModify}},[e._v("确 定")])],1)],1)],1)},$=[];s("88a7"),s("271a"),s("5494");function x(e){if(!e)return"";const t=new Date(e),s=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0"),o=String(t.getHours()).padStart(2,"0"),i=String(t.getMinutes()).padStart(2,"0"),l=String(t.getSeconds()).padStart(2,"0");return`${s}-${a}-${r} ${o}:${i}:${l}`}var E=function(){var e=this,t=e._self._c;return t("div",{staticClass:"test-record-review"},[t("el-dialog",{attrs:{title:"测试记录审核",visible:e.visible,width:"500px"},on:{"update:visible":function(t){e.visible=t},close:e.handleClose}},[t("el-form",{ref:"form",attrs:{model:e.form,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"学生姓名"}},[t("span",[e._v(e._s(e.record.student?e.record.student.realName:""))])]),t("el-form-item",{attrs:{label:"学号"}},[t("span",[e._v(e._s(e.record.studentNumber))])]),t("el-form-item",{attrs:{label:"测试项目"}},[t("span",[e._v(e._s(e.record.sportsItem?e.record.sportsItem.name:""))])]),t("el-form-item",{attrs:{label:"测试成绩"}},[t("span",[e._v(e._s(e.record.score))])]),t("el-form-item",{attrs:{label:"测试时间"}},[t("span",[e._v(e._s(e.formatDateTime(e.record.testTime)))])]),t("el-form-item",{attrs:{label:"审核状态",prop:"status"}},[t("el-radio-group",{model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}},[t("el-radio",{attrs:{label:"APPROVED"}},[e._v("通过")]),t("el-radio",{attrs:{label:"REJECTED"}},[e._v("驳回")])],1)],1),t("el-form-item",{attrs:{label:"审核意见",prop:"comment"}},[t("el-input",{attrs:{type:"textarea",rows:3,placeholder:"请输入审核意见"},model:{value:e.form.comment,callback:function(t){e.$set(e.form,"comment",t)},expression:"form.comment"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.handleClose}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v("确 定")])],1)],1)],1)},T=[],R={name:"TestRecordReview",props:{visible:{type:Boolean,default:!1},record:{type:Object,default:()=>({})}},data(){return{form:{status:"",comment:""}}},methods:{formatDateTime:x,handleClose(){this.$emit("update:visible",!1),this.resetForm()},resetForm(){this.form={status:"",comment:""}},async handleSubmit(){try{const e=await this.$axios.put("/api/admin/test-record/review",{id:this.record.id,status:this.form.status,comment:this.form.comment,reviewerId:this.$store.state.user.id});200===e.data.code?(this.$message.success("审核成功"),this.$emit("success"),this.handleClose()):this.$message.error(e.data.msg||"审核失败")}catch(e){this.$message.error("审核失败："+e.message)}}},watch:{record:{handler(e){e&&(this.form.status="",this.form.comment="")},immediate:!0}}},I=R,D=(s("7e79"),Object(n["a"])(I,E,T,!1,null,"c1bee01e",null)),N=D.exports,P={components:{TestRecordReview:N},data(){return{records:[],sportsItems:[],filterForm:{status:"",sportsItemId:""},currentPage:1,pageSize:10,total:0,reviewDialogVisible:!1,modifyDialogVisible:!1,currentRecord:null,modifyForm:{status:"",comment:""}}},methods:{formatDateTime:x,getStatusText(e){const t={PENDING:"待审核",APPROVED:"已通过",REJECTED:"已驳回"};return t[e]||e},async fetchRecords(){try{const e=await this.$axios.get("/api/admin/test-record/review",{params:{status:this.filterForm.status,sportsItemId:this.filterForm.sportsItemId,pageNum:this.currentPage,pageSize:this.pageSize}});200===e.data.code&&(this.records=e.data.data.content,this.total=e.data.data.totalElements)}catch(e){this.$message.error("获取记录失败："+e.message)}},async fetchSportsItems(){try{const e=await this.$axios.get("/api/admin/sports-items");200===e.data.code&&(this.sportsItems=e.data.data)}catch(e){this.$message.error("获取体测项目失败："+e.message)}},handlePageChange(e){this.currentPage=e,this.fetchRecords()},handleReview(e){this.currentRecord=e,this.reviewDialogVisible=!0},handleReviewSuccess(){this.fetchRecords()},handleModify(e){this.currentRecord=e,this.modifyForm.status=e.status,this.modifyForm.comment=e.reviewComment,this.modifyDialogVisible=!0},async submitModify(){try{const e=await this.$axios.put("/api/admin/test-record/modify",{id:this.currentRecord.id,status:this.modifyForm.status,comment:this.modifyForm.comment,reviewerId:this.$store.state.user.id});200===e.data.code?(this.$message.success("修改成功"),this.modifyDialogVisible=!1,this.fetchRecords()):this.$message.error(e.data.msg||"修改失败")}catch(e){this.$message.error("修改失败："+e.message)}},async handleExport(){try{const e=await this.$axios.get("/api/admin/test-record/export",{params:{status:this.filterForm.status,sportsItemId:this.filterForm.sportsItemId},responseType:"blob"}),t=window.URL.createObjectURL(new Blob([e.data])),s=document.createElement("a");s.href=t,s.setAttribute("download","test_records.xlsx"),document.body.appendChild(s),s.click(),document.body.removeChild(s)}catch(e){this.$message.error("导出失败："+e.message)}}},created(){this.fetchSportsItems(),this.fetchRecords()}},F=P,A=(s("382e"),Object(n["a"])(F,C,$,!1,null,"38689621",null)),z=A.exports,O=function(){var e=this,t=e._self._c;return t("div",[t("el-table",{attrs:{data:e.users,border:""}},[t("el-table-column",{attrs:{prop:"username",label:"用户名"}}),t("el-table-column",{attrs:{prop:"realName",label:"姓名"}}),"STUDENT"===e.userType?t("el-table-column",{attrs:{prop:"studentNumber",label:"学号"}}):e._e(),t("el-table-column",{attrs:{prop:"email",label:"邮箱"}}),t("el-table-column",{attrs:{prop:"phone",label:"电话"}}),t("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.handleEdit(s.row)}}},[e._v("编辑")]),t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(s.row)}}},[e._v("删除")])]}}])})],1),t("el-pagination",{attrs:{"current-page":e.currentPage,"page-size":e.pageSize,layout:"total, prev, pager, next",total:e.total},on:{"current-change":e.handlePageChange,"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t}}})],1)},U=[],L={data(){return{users:[],userType:"",currentPage:1,pageSize:10,total:0}},methods:{async fetchUsers(){try{const e="STUDENT"===this.userType?"/students":"/teachers",t=await this.$axios.get("/api/admin/users"+e,{params:{pageNum:this.currentPage,pageSize:this.pageSize}});200===t.data.code?(this.users=t.data.data.content,this.total=t.data.data.totalElements):this.$message.error(t.data.msg||"获取用户列表失败")}catch(e){this.$message.error("获取用户列表失败："+e.message)}},handlePageChange(e){this.currentPage=e,this.fetchUsers()},handleEdit(e){this.$emit("edit",e)},handleDelete(e){this.$confirm("确认删除该用户?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const t=await this.$axios.delete("/api/admin/users/"+e.id);200===t.data.code?(this.$message.success("删除成功"),this.fetchUsers()):this.$message.error(t.data.msg||"删除失败")}catch(t){this.$message.error("删除失败："+t.message)}}).catch(()=>{})}},created(){this.fetchUsers()},watch:{userType:{handler(e){e&&(this.currentPage=1,this.fetchUsers())},immediate:!0}}},V=L,M=Object(n["a"])(V,O,U,!1,null,null,null),q=M.exports,j=function(){var e=this,t=e._self._c;return t("div",{staticClass:"dashboard"},[t("el-row",{staticClass:"stats-row",attrs:{gutter:20}},[t("el-col",{attrs:{span:6}},[t("el-card",{staticClass:"stats-card",attrs:{shadow:"hover"}},[t("div",{staticClass:"stats-icon student-icon"},[t("i",{staticClass:"el-icon-user"})]),t("div",{staticClass:"stats-info"},[t("div",{staticClass:"stats-title"},[e._v("学生总数")]),t("div",{staticClass:"stats-number"},[e._v(e._s(e.stats.studentCount))]),t("div",{staticClass:"stats-desc"},[e._v("在校学生总人数")])])])],1),t("el-col",{attrs:{span:6}},[t("el-card",{staticClass:"stats-card",attrs:{shadow:"hover"}},[t("div",{staticClass:"stats-icon teacher-icon"},[t("i",{staticClass:"el-icon-s-custom"})]),t("div",{staticClass:"stats-info"},[t("div",{staticClass:"stats-title"},[e._v("教师总数")]),t("div",{staticClass:"stats-number"},[e._v(e._s(e.stats.teacherCount))]),t("div",{staticClass:"stats-desc"},[e._v("任职教师总人数")])])])],1),t("el-col",{attrs:{span:6}},[t("el-card",{staticClass:"stats-card",attrs:{shadow:"hover"}},[t("div",{staticClass:"stats-icon item-icon"},[t("i",{staticClass:"el-icon-trophy"})]),t("div",{staticClass:"stats-info"},[t("div",{staticClass:"stats-title"},[e._v("体育项目")]),t("div",{staticClass:"stats-number"},[t("count-to",{attrs:{"start-val":0,"end-val":e.stats.sportsItemCount,duration:2e3}})],1),t("div",{staticClass:"stats-desc"},[e._v("当前测试项目数")])])])],1),t("el-col",{attrs:{span:6}},[t("el-card",{staticClass:"stats-card",attrs:{shadow:"hover"}},[t("div",{staticClass:"stats-icon record-icon"},[t("i",{staticClass:"el-icon-data-line"})]),t("div",{staticClass:"stats-info"},[t("div",{staticClass:"stats-title"},[e._v("测试记录")]),t("div",{staticClass:"stats-number"},[t("count-to",{attrs:{"start-val":0,"end-val":e.stats.testRecordCount,duration:2e3}})],1),t("div",{staticClass:"stats-desc"},[e._v("累计测试记录数")])])])],1)],1),t("el-row",{staticClass:"quick-access",attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-card",{staticClass:"box-card"},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",[e._v("快捷操作")])]),t("div",{staticClass:"quick-buttons"},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.$router.push("/admin/users/student")}}},[t("i",{staticClass:"el-icon-plus"}),e._v(" 添加学生 ")]),t("el-button",{attrs:{type:"success"},on:{click:function(t){return e.$router.push("/admin/users/teacher")}}},[t("i",{staticClass:"el-icon-plus"}),e._v(" 添加教师 ")]),t("el-button",{attrs:{type:"warning"},on:{click:function(t){return e.$router.push("/admin/sports-items")}}},[t("i",{staticClass:"el-icon-plus"}),e._v(" 添加项目 ")]),t("el-button",{attrs:{type:"info"},on:{click:function(t){return e.$router.push("/admin/notices")}}},[t("i",{staticClass:"el-icon-plus"}),e._v(" 发布公告 ")])],1)])],1),t("el-col",{attrs:{span:12}},[t("el-card",{staticClass:"box-card"},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",[e._v("最新公告")]),t("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:function(t){return e.$router.push("/admin/notices")}}},[e._v(" 查看更多 ")])],1),e.notices.length>0?t("div",e._l(e.notices,(function(s){return t("div",{key:s.id,staticClass:"notice-item"},[t("span",{staticClass:"notice-title"},[e._v(e._s(s.title))]),t("span",{staticClass:"notice-time"},[e._v(e._s(s.createTime))])])})),0):t("div",{staticClass:"empty-text"},[e._v(" 暂无公告 ")])])],1)],1),t("el-row",{staticClass:"charts-row",attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-card",{staticClass:"box-card"},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",[e._v("各年级学生分布")])]),t("div",{staticClass:"chart-container"})])],1),t("el-col",{attrs:{span:12}},[t("el-card",{staticClass:"box-card"},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",[e._v("测试成绩分布")])]),t("div",{staticClass:"chart-container"})])],1)],1)],1)},H=[],B=s("ec1b"),G=s.n(B),J={name:"Dashboard",components:{CountTo:G.a},data(){return{stats:{studentCount:0,teacherCount:0,sportsItemCount:0,testRecordCount:0},notices:[],loading:{stats:!1,notices:!1}}},async created(){await this.fetchStats(),await this.fetchNotices()},methods:{async fetchStats(){try{this.loading.stats=!0;const e=await this.$http.get("/api/admin/dashboard/stats");200===e.data.code?this.stats=e.data.data:this.$message.error(e.data.msg||"获取统计数据失败")}catch(e){console.error("获取统计数据失败:",e),this.$message.error("获取统计数据失败: "+e.message)}finally{this.loading.stats=!1}},async fetchNotices(){try{const e=await this.$http.get("/api/admin/notices/latest");200===e.data.code?this.notices=e.data.data||[]:(console.warn("获取公告失败:",e.data.msg),this.notices=[])}catch(e){console.error("获取公告失败:",e),this.notices=[]}},formatDate(e){return e?new Date(e).toLocaleString():""}}},K=J,X=(s("5a41"),Object(n["a"])(K,j,H,!1,null,"52743e92",null)),Y=(X.exports,function(){var e=this,t=e._self._c;return t("div",{staticClass:"student-management"},[t("div",{staticClass:"filter-section"},[t("el-form",{attrs:{inline:!0,model:e.filterForm}},[t("el-form-item",[t("el-input",{attrs:{placeholder:"搜索姓名/学号",clearable:""},on:{clear:e.handleSearch},model:{value:e.filterForm.keyword,callback:function(t){e.$set(e.filterForm,"keyword",t)},expression:"filterForm.keyword"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("搜索")]),t("el-button",{attrs:{type:"success"},on:{click:e.handleAdd}},[e._v("添加学生")])],1)],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.students,border:""}},[t("el-table-column",{attrs:{prop:"username",label:"用户名"}}),t("el-table-column",{attrs:{prop:"realName",label:"姓名"}}),t("el-table-column",{attrs:{prop:"studentNumber",label:"学号"}}),t("el-table-column",{attrs:{prop:"email",label:"邮箱"}}),t("el-table-column",{attrs:{prop:"phone",label:"电话"}}),t("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.handleEdit(s.row)}}},[e._v("编辑")]),t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(s.row)}}},[e._v("删除")])]}}])})],1),t("el-pagination",{attrs:{"current-page":e.currentPage,"page-size":e.pageSize,layout:"total, prev, pager, next",total:e.total},on:{"current-change":e.handlePageChange,"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t}}}),t("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("user-form",{ref:"userForm",attrs:{"user-type":"STUDENT"},on:{saved:e.handleSaved}})],1),t("el-upload",{staticClass:"upload-demo",attrs:{action:"/api/admin/users/student/import",headers:e.headers,"on-success":e.handleUploadSuccess,"on-error":e.handleUploadError,"before-upload":e.beforeUpload}},[t("el-button",{attrs:{type:"primary"}},[e._v("导入学生")]),t("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传xlsx文件")])],1)],1)}),Q=[],W=function(){var e=this,t=e._self._c;return t("div",{staticClass:"user-form"},[t("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"100px"}},[e.isEdit?e._e():t("el-form-item",{attrs:{label:"用户名",prop:"username"}},[t("el-input",{attrs:{placeholder:"请输入用户名"},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1),t("el-form-item",{attrs:{label:"用户类型",prop:"userType"}},[t("el-select",{attrs:{placeholder:"请选择用户类型"},model:{value:e.form.userType,callback:function(t){e.$set(e.form,"userType",t)},expression:"form.userType"}},[t("el-option",{attrs:{label:"学生",value:"STUDENT"}}),t("el-option",{attrs:{label:"教师",value:"TEACHER"}})],1)],1),t("el-form-item",{attrs:{label:"姓名",prop:"realName"}},[t("el-input",{attrs:{placeholder:"请输入姓名"},model:{value:e.form.realName,callback:function(t){e.$set(e.form,"realName",t)},expression:"form.realName"}})],1),"STUDENT"===e.userType?t("el-form-item",{attrs:{label:"学号",prop:"studentNumber"}},[t("el-input",{attrs:{placeholder:"请输入学号"},model:{value:e.form.studentNumber,callback:function(t){e.$set(e.form,"studentNumber",t)},expression:"form.studentNumber"}})],1):e._e(),t("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[t("el-input",{attrs:{placeholder:"请输入邮箱"},model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1),t("el-form-item",{attrs:{label:"电话",prop:"phone"}},[t("el-input",{attrs:{placeholder:"请输入电话"},model:{value:e.form.phone,callback:function(t){e.$set(e.form,"phone",t)},expression:"form.phone"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("保存")]),t("el-button",{on:{click:e.resetForm}},[e._v("重置")])],1)],1)],1)},Z=[],ee={name:"UserForm",props:{userType:{type:String,required:!0}},data(){return{isEdit:!1,form:{id:null,username:"",userType:"",realName:"",studentNumber:"",email:"",phone:""},rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"}],userType:[{required:!0,message:"请选择用户类型",trigger:"change"}],realName:[{required:!0,message:"请输入姓名",trigger:"blur"}],studentNumber:[{required:!0,message:"请输入学号",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]}}},methods:{setFormData(e){this.isEdit=!0,this.form={...e}},submitForm(){this.$refs.form.validate(async e=>{if(e)try{const e=this.isEdit?"/api/admin/users/"+this.form.id:"/api/admin/users",t=this.isEdit?"put":"post";this.form.userType=this.userType;const s=await this.$axios[t](e,this.form);200===s.data.code?(this.$message.success("保存成功"),this.$emit("saved"),this.resetForm()):this.$message.error(s.data.msg||"保存失败")}catch(t){this.$message.error("保存失败："+t.message)}})},resetForm(){this.$refs.form.resetFields(),this.isEdit=!1,this.form={id:null,username:"",userType:"",realName:"",studentNumber:"",email:"",phone:""}}},watch:{"form.userType"(e){"STUDENT"!==e&&(this.form.studentNumber="")}}},te=ee,se=(s("a6ec"),Object(n["a"])(te,W,Z,!1,null,"24a52aea",null)),ae=se.exports,re={name:"StudentManagement",components:{UserForm:ae},data(){return{students:[],loading:!1,currentPage:1,pageSize:10,total:0,filterForm:{keyword:""},dialogVisible:!1,dialogTitle:"添加学生",currentUser:null,headers:{"X-Token":localStorage.getItem("token")}}},methods:{async fetchStudents(){try{this.loading=!0,console.log("Fetching students...");const e=await this.$axios.get("/api/users/students",{params:{pageNum:this.currentPage,pageSize:this.pageSize,keyword:this.filterForm.keyword}});console.log("Response:",e),200===e.data.code?(this.students=e.data.data.content,this.total=e.data.data.totalElements):this.$message.error(e.data.msg||"获取学生列表失败")}catch(t){var e;console.error("Error details:",t),this.$message.error((null===(e=t.response)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.msg)||t.message||"获取学生列表失败")}finally{this.loading=!1}},handleSearch(){this.currentPage=1,this.fetchStudents()},handlePageChange(e){this.currentPage=e,this.fetchStudents()},handleAdd(){this.dialogTitle="添加学生",this.currentUser=null,this.dialogVisible=!0},handleEdit(e){this.dialogTitle="编辑学生",this.currentUser=e,this.dialogVisible=!0,this.$nextTick(()=>{this.$refs.userForm.setFormData(e)})},async handleDelete(e){try{await this.$confirm("确认删除该学生?","提示",{type:"warning"});const t=await this.$axios.delete("/api/users/"+e.id);200===t.data.code?(this.$message.success("删除成功"),this.fetchStudents()):this.$message.error(t.data.msg||"删除失败")}catch(t){"cancel"!==t&&this.$message.error("删除失败："+t.message)}},handleSaved(){this.dialogVisible=!1,this.fetchStudents()},beforeUpload(e){const t="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===e.type;return!!t||(this.$message.error("只能上传Excel文件!"),!1)},handleUploadSuccess(e){200===e.code?(this.$message.success("导入成功"),this.fetchStudents()):this.$message.error(e.message)},handleUploadError(){this.$message.error("导入失败")}},created(){this.fetchStudents()}},oe=re,ie=(s("2f87"),Object(n["a"])(oe,Y,Q,!1,null,"04200ffb",null)),le=ie.exports,ne=function(){var e=this,t=e._self._c;return t("div",{staticClass:"teacher-management"},[t("div",{staticClass:"filter-section"},[t("el-form",{attrs:{inline:!0,model:e.filterForm}},[t("el-form-item",[t("el-input",{attrs:{placeholder:"搜索姓名",clearable:""},on:{clear:e.handleSearch},model:{value:e.filterForm.keyword,callback:function(t){e.$set(e.filterForm,"keyword",t)},expression:"filterForm.keyword"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("搜索")]),t("el-button",{attrs:{type:"success"},on:{click:e.handleAdd}},[e._v("添加教师")])],1)],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.teachers,border:""}},[t("el-table-column",{attrs:{prop:"username",label:"用户名"}}),t("el-table-column",{attrs:{prop:"realName",label:"姓名"}}),t("el-table-column",{attrs:{prop:"email",label:"邮箱"}}),t("el-table-column",{attrs:{prop:"phone",label:"电话"}}),t("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.handleEdit(s.row)}}},[e._v("编辑")]),t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(s.row)}}},[e._v("删除")])]}}])})],1),t("el-pagination",{attrs:{"current-page":e.currentPage,"page-size":e.pageSize,layout:"total, prev, pager, next",total:e.total},on:{"current-change":e.handlePageChange,"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t}}}),t("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("user-form",{ref:"userForm",attrs:{"user-type":"TEACHER"},on:{saved:e.handleSaved}})],1),t("el-dialog",{attrs:{title:"导入教师",visible:e.importDialogVisible,width:"500px"},on:{"update:visible":function(t){e.importDialogVisible=t}}},[t("el-upload",{staticClass:"upload-demo",attrs:{drag:"",action:"/api/admin/users/teacher/import",headers:e.headers,"on-success":e.handleUploadSuccess,"on-error":e.handleUploadError,"before-upload":e.beforeUpload,limit:1,accept:".xlsx"}},[t("i",{staticClass:"el-icon-upload"}),t("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),t("em",[e._v("点击上传")])]),t("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t("p",[e._v("只能上传xlsx文件，且文件大小不超过10MB")]),t("p",[e._v("请按模板格式填写数据，"),t("a",{attrs:{href:"javascript:;"},on:{click:e.downloadTemplate}},[e._v("下载模板")])])])]),e.importResult.total?t("div",{staticClass:"import-result"},[t("p",[e._v("导入结果：")]),t("p",[e._v("总数："+e._s(e.importResult.total))]),t("p",[e._v("成功："+e._s(e.importResult.success))]),t("p",[e._v("失败："+e._s(e.importResult.failed))]),e.importResult.errors.length?t("div",[t("p",[e._v("错误信息：")]),t("ul",e._l(e.importResult.errors,(function(s,a){return t("li",{key:a},[e._v(e._s(s))])})),0)]):e._e()]):e._e()],1),t("div",{staticClass:"batch-import"},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.importDialogVisible=!0}}},[t("i",{staticClass:"el-icon-upload2"}),e._v(" 批量导入 ")])],1)],1)},ce=[],de={name:"TeacherManagement",components:{UserForm:ae},data(){return{teachers:[],loading:!1,currentPage:1,pageSize:10,total:0,filterForm:{keyword:""},dialogVisible:!1,importDialogVisible:!1,dialogTitle:"添加教师",currentUser:null,headers:{"X-Token":localStorage.getItem("token")},importResult:{total:0,success:0,failed:0,errors:[]}}},methods:{async fetchTeachers(){try{this.loading=!0;const e=await this.$axios.get("/api/users/teachers",{params:{pageNum:this.currentPage,pageSize:this.pageSize,keyword:this.filterForm.keyword}});200===e.data.code?(this.teachers=e.data.data.content,this.total=e.data.data.totalElements):this.$message.error(e.data.msg||"获取教师列表失败")}catch(t){var e;this.$message.error((null===(e=t.response)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.msg)||t.message||"获取教师列表失败")}finally{this.loading=!1}},handleSearch(){this.currentPage=1,this.fetchTeachers()},handlePageChange(e){this.currentPage=e,this.fetchTeachers()},handleAdd(){this.dialogTitle="添加教师",this.currentUser=null,this.dialogVisible=!0},handleEdit(e){this.dialogTitle="编辑教师",this.currentUser=e,this.dialogVisible=!0,this.$nextTick(()=>{this.$refs.userForm.setFormData(e)})},async handleDelete(e){try{await this.$confirm("确认删除该教师?","提示",{type:"warning"});const t=await this.$axios.delete("/api/users/"+e.id);200===t.data.code?(this.$message.success("删除成功"),this.fetchTeachers()):this.$message.error(t.data.msg||"删除失败")}catch(t){"cancel"!==t&&this.$message.error("删除失败："+t.message)}},handleSaved(){this.dialogVisible=!1,this.fetchTeachers()},beforeUpload(e){const t="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===e.type,s=e.size/1024/1024<10;return t?!!s||(this.$message.error("文件大小不能超过 10MB!"),!1):(this.$message.error("只能上传 xlsx 格式的文件!"),!1)},handleUploadSuccess(e){200===e.code?(this.importResult={total:e.data.length,success:e.data.length,failed:0,errors:[]},this.$message.success("导入成功"),this.fetchTeachers()):(this.importResult={total:0,success:0,failed:1,errors:[e.message]},this.$message.error(e.message))},handleUploadError(e){this.importResult={total:0,success:0,failed:1,errors:[e.message||"导入失败"]},this.$message.error("导入失败")},downloadTemplate(){const e=document.createElement("a");e.href="/templates/teacher_import_template.xlsx",e.download="教师导入模板.xlsx",document.body.appendChild(e),e.click(),document.body.removeChild(e)}},created(){this.fetchTeachers()}},ue=de,me=(s("60d3"),Object(n["a"])(ue,ne,ce,!1,null,"d66d86a8",null)),pe=me.exports,he=function(){var e=this,t=e._self._c;return t("div",{staticClass:"sports-item-management"},[t("div",{staticClass:"operation-bar"},[t("div",{staticClass:"search-area"},[t("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"输入项目名称搜索"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}},model:{value:e.searchKeyword,callback:function(t){e.searchKeyword=t},expression:"searchKeyword"}},[t("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.handleSearch},slot:"append"})],1)],1),t("el-button",{attrs:{type:"primary"},on:{click:e.handleAdd}},[t("i",{staticClass:"el-icon-plus"}),e._v(" 添加项目 ")])],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"",stripe:""}},[t("el-table-column",{attrs:{prop:"id",label:"ID",width:"80"}}),t("el-table-column",{attrs:{prop:"name",label:"项目名称"}}),t("el-table-column",{attrs:{prop:"type",label:"项目类型",width:"100"}}),t("el-table-column",{attrs:{prop:"description",label:"项目描述","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"unit",label:"计量单位",width:"100"}}),t("el-table-column",{attrs:{prop:"testMethod",label:"测试方法","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"location",label:"测试地点"}}),t("el-table-column",{attrs:{prop:"testTime",label:"测试时间",width:"120"}}),t("el-table-column",{attrs:{prop:"standard",label:"评分标准","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"isActive",label:"状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},on:{change:function(t){return e.handleStatusChange(s.row)}},model:{value:s.row.isActive,callback:function(t){e.$set(s.row,"isActive",t)},expression:"scope.row.isActive"}})]}}])}),t("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button-group",[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.handleEdit(s.row)}}},[e._v(" 编辑 ")]),t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(s.row)}}},[e._v(" 删除 ")])],1)]}}])})],1),t("div",{staticClass:"pagination-container"},[t("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[10,20,50,100],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),t("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible,width:"600px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"项目名称",prop:"name"}},[t("el-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),t("el-form-item",{attrs:{label:"项目类型",prop:"type"}},[t("el-select",{attrs:{placeholder:"请选择项目类型"},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},[t("el-option",{attrs:{label:"田径",value:"田径"}}),t("el-option",{attrs:{label:"力量",value:"力量"}}),t("el-option",{attrs:{label:"耐力",value:"耐力"}})],1)],1),t("el-form-item",{attrs:{label:"项目描述",prop:"description"}},[t("el-input",{attrs:{type:"textarea",rows:"3"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),t("el-form-item",{attrs:{label:"计量单位",prop:"unit"}},[t("el-input",{model:{value:e.form.unit,callback:function(t){e.$set(e.form,"unit",t)},expression:"form.unit"}})],1),t("el-form-item",{attrs:{label:"测试方法",prop:"testMethod"}},[t("el-input",{attrs:{type:"textarea",rows:"3"},model:{value:e.form.testMethod,callback:function(t){e.$set(e.form,"testMethod",t)},expression:"form.testMethod"}})],1),t("el-form-item",{attrs:{label:"测试地点",prop:"location"}},[t("el-input",{model:{value:e.form.location,callback:function(t){e.$set(e.form,"location",t)},expression:"form.location"}})],1),t("el-form-item",{attrs:{label:"测试时间",prop:"testTime"}},[t("el-input",{attrs:{placeholder:"例如：每学期第3-4周"},model:{value:e.form.testTime,callback:function(t){e.$set(e.form,"testTime",t)},expression:"form.testTime"}})],1),t("el-form-item",{attrs:{label:"评分标准",prop:"standard"}},[t("el-input",{attrs:{type:"textarea",rows:"3",placeholder:"例如：男生：优秀≤7.0秒，及格≤8.5秒"},model:{value:e.form.standard,callback:function(t){e.$set(e.form,"standard",t)},expression:"form.standard"}})],1),t("el-form-item",{attrs:{label:"状态",prop:"isActive"}},[t("el-switch",{model:{value:e.form.isActive,callback:function(t){e.$set(e.form,"isActive",t)},expression:"form.isActive"}})],1)],1),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v("确定")])],1)],1)],1)},fe=[],ge={name:"SportsItemManagement",data(){return{searchKeyword:"",tableData:[],loading:!1,currentPage:1,pageSize:10,total:0,dialogVisible:!1,dialogTitle:"",form:{name:"",type:"",description:"",unit:"",testMethod:"",location:"",testTime:"",standard:"",isActive:!0},rules:{name:[{required:!0,message:"请输入项目名称",trigger:"blur"}],type:[{required:!0,message:"请选择项目类型",trigger:"change"}],unit:[{required:!0,message:"请输入计量单位",trigger:"blur"}],testMethod:[{required:!0,message:"请输入测试方法",trigger:"blur"}],location:[{required:!0,message:"请输入测试地点",trigger:"blur"}],testTime:[{required:!0,message:"请输入测试时间",trigger:"blur"}],standard:[{required:!0,message:"请输入评分标准",trigger:"blur"}]}}},created(){this.fetchItemList()},methods:{async fetchItemList(){try{this.loading=!0;const e=await this.$http.get("/api/sports-items",{params:{keyword:this.searchKeyword,page:this.currentPage-1,size:this.pageSize}});if(200===e.data.code){const t=e.data.data;Array.isArray(t)?(this.tableData=t,this.total=t.length):t&&t.content&&(this.tableData=t.content,this.total=t.totalElements),console.log("获取到的数据:",this.tableData)}else this.$message.error(e.data.msg||"获取体测项目列表失败")}catch(e){console.error("获取体测项目列表失败:",e),this.$message.error("获取体测项目列表失败")}finally{this.loading=!1}},handleSearch(){this.currentPage=1,this.fetchItemList()},handleSizeChange(e){this.pageSize=e,this.fetchItemList()},handleCurrentChange(e){this.currentPage=e,this.fetchItemList()},handleAdd(){this.dialogTitle="添加体测项目",this.form={name:"",type:"",description:"",unit:"",testMethod:"",location:"",testTime:"",standard:"",isActive:!0},this.dialogVisible=!0},handleEdit(e){this.dialogTitle="编辑体测项目",this.form={...e},this.dialogVisible=!0},async handleSubmit(){this.$refs.form.validate(async e=>{if(e)try{const e=this.form.id?"/api/sports-items/"+this.form.id:"/api/sports-items",t=this.form.id?"put":"post",s=await this.$http[t](e,this.form);200===s.data.code?(this.$message.success(this.form.id?"更新成功":"添加成功"),this.dialogVisible=!1,this.fetchItemList()):this.$message.error(s.data.msg||"操作失败")}catch(t){console.error("操作失败:",t),this.$message.error("操作失败")}})},async handleDelete(e){try{await this.$confirm("确认删除该体测项目吗？","提示",{type:"warning"});const t=await this.$http.delete("/api/sports-items/"+e.id);200===t.data.code?(this.$message.success("删除成功"),this.fetchItemList()):this.$message.error(t.data.msg||"删除失败")}catch(t){"cancel"!==t&&(console.error("删除失败:",t),this.$message.error("删除失败"))}},async handleStatusChange(e){try{const t=await this.$http.put(`/api/sports-items/${e.id}/status`,{isActive:e.isActive});200===t.data.code?this.$message.success((e.isActive?"启用":"禁用")+"成功"):(e.isActive=!e.isActive,this.$message.error(t.data.msg||"操作失败"))}catch(t){e.isActive=!e.isActive,console.error("操作失败:",t),this.$message.error("操作失败")}}}},be=ge,ve=(s("9db2"),Object(n["a"])(be,he,fe,!1,null,"61ae701e",null)),ye=ve.exports,we=function(){var e=this,t=e._self._c;return t("div",{staticClass:"notice-management"},[t("div",{staticClass:"operation-bar"},[t("div",{staticClass:"search-area"},[t("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"输入标题搜索"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}},model:{value:e.searchKeyword,callback:function(t){e.searchKeyword=t},expression:"searchKeyword"}},[t("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.handleSearch},slot:"append"})],1),t("el-select",{staticStyle:{width:"120px","margin-left":"10px"},attrs:{placeholder:"通知类型"},model:{value:e.searchType,callback:function(t){e.searchType=t},expression:"searchType"}},[t("el-option",{attrs:{label:"全部",value:""}}),t("el-option",{attrs:{label:"体测安排",value:"TEST_SCHEDULE"}}),t("el-option",{attrs:{label:"成绩公布",value:"SCORE_RELEASE"}}),t("el-option",{attrs:{label:"系统维护",value:"SYSTEM_MAINTENANCE"}}),t("el-option",{attrs:{label:"其他通知",value:"OTHER"}})],1)],1),t("el-button",{attrs:{type:"primary"},on:{click:e.handleAdd}},[t("i",{staticClass:"el-icon-plus"}),e._v(" 发布通知 ")])],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.noticeList,border:"",stripe:""}},[t("el-table-column",{attrs:{prop:"id",label:"ID",width:"80"}}),t("el-table-column",{attrs:{prop:"type",label:"类型",width:"100"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-tag",{attrs:{type:e.getTypeTagType(s.row.type)}},[e._v(" "+e._s(e.getTypeLabel(s.row.type))+" ")])]}}])}),t("el-table-column",{attrs:{prop:"title",label:"标题","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(s){return[t("span",{class:{"important-notice":"HIGH"===s.row.priority}},[e._v(" "+e._s(s.row.title)+" ")])]}}])}),t("el-table-column",{attrs:{prop:"createTime",label:"发布时间",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.formatDate(t.row.createTime))+" ")]}}])}),t("el-table-column",{attrs:{prop:"status",label:"状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-switch",{attrs:{"active-value":1,"inactive-value":0,"active-color":"#13ce66","inactive-color":"#ff4949"},on:{change:function(t){return e.handleStatusChange(s.row)}},model:{value:s.row.status,callback:function(t){e.$set(s.row,"status",t)},expression:"scope.row.status"}})]}}])}),t("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button-group",{staticClass:"operation-group"},[t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.handleView(s.row)}}},[e._v(" 查看 ")]),t("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(t){return e.handleEdit(s.row)}}},[e._v(" 编辑 ")]),t("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(t){return e.handleDelete(s.row)}}},[e._v(" 删除 ")])],1)]}}])})],1),t("div",{staticClass:"pagination-container"},[t("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[10,20,50,100],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),t("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible,width:"700px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"通知类型",prop:"type"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择通知类型"},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},[t("el-option",{attrs:{label:"体测安排",value:"TEST_SCHEDULE"}}),t("el-option",{attrs:{label:"成绩公布",value:"SCORE_RELEASE"}}),t("el-option",{attrs:{label:"系统维护",value:"SYSTEM_MAINTENANCE"}}),t("el-option",{attrs:{label:"其他通知",value:"OTHER"}})],1)],1),t("el-form-item",{attrs:{label:"重要程度",prop:"priority"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择重要程度"},model:{value:e.form.priority,callback:function(t){e.$set(e.form,"priority",t)},expression:"form.priority"}},[t("el-option",{attrs:{label:"普通",value:"NORMAL"}}),t("el-option",{attrs:{label:"重要",value:"HIGH"}})],1)],1),t("el-form-item",{attrs:{label:"标题",prop:"title"}},[t("el-input",{attrs:{maxlength:"100","show-word-limit":""},model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1),t("el-form-item",{attrs:{label:"内容",prop:"content"}},[t("el-input",{attrs:{type:"textarea",rows:10,maxlength:"2000","show-word-limit":""},model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}})],1),t("el-form-item",{attrs:{label:"状态",prop:"status"}},[t("el-switch",{attrs:{"active-value":1,"inactive-value":0,"active-text":"启用","inactive-text":"禁用"},model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}})],1)],1),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v("确定")])],1)],1),t("el-dialog",{attrs:{title:"查看通知",visible:e.viewDialogVisible,width:"700px"},on:{"update:visible":function(t){e.viewDialogVisible=t}}},[t("div",{staticClass:"notice-header"},[t("el-tag",{staticClass:"notice-type",attrs:{type:e.getTypeTagType(e.currentNotice.type)}},[e._v(" "+e._s(e.getTypeLabel(e.currentNotice.type))+" ")]),t("h3",{staticClass:"notice-title"},[e._v(e._s(e.currentNotice.title))])],1),t("div",{staticClass:"notice-meta"},[t("span",[e._v("发布时间："+e._s(e.formatDate(e.currentNotice.createTime)))]),"HIGH"===e.currentNotice.priority?t("span",{staticClass:"notice-priority"},[t("i",{staticClass:"el-icon-warning"}),e._v(" 重要通知 ")]):e._e()]),t("div",{staticClass:"notice-content"},[e._v(e._s(e.currentNotice.content))])])],1)},_e=[],ke={name:"NoticeManagement",data(){return{searchKeyword:"",searchType:"",noticeList:[],loading:!1,dialogVisible:!1,viewDialogVisible:!1,dialogTitle:"",currentNotice:{},currentPage:1,pageSize:10,total:0,form:{id:null,type:"OTHER",priority:"NORMAL",title:"",content:"",status:1,createTime:null,updateTime:null,createBy:null},rules:{type:[{required:!0,message:"请选择通知类型",trigger:"change"}],priority:[{required:!0,message:"请选择重要程度",trigger:"change"}],title:[{required:!0,message:"请输入标题",trigger:"blur"},{max:100,message:"长度不能超过100个字符",trigger:"blur"}],content:[{required:!0,message:"请输入内容",trigger:"blur"},{max:2e3,message:"长度不能超过2000个字符",trigger:"blur"}]}}},created(){const e=localStorage.getItem("userId");e&&(this.form.createBy=parseInt(e)),this.fetchNoticeList()},methods:{formatDate(e){return e?new Date(e).toLocaleString():""},getTypeTagType(e){const t={TEST_SCHEDULE:"primary",SCORE_RELEASE:"success",SYSTEM_MAINTENANCE:"warning",OTHER:"info"};return t[e]||"info"},getTypeLabel(e){const t={TEST_SCHEDULE:"体测安排",SCORE_RELEASE:"成绩公布",SYSTEM_MAINTENANCE:"系统维护",OTHER:"其他通知"};return t[e]||"其他通知"},async fetchNoticeList(){try{this.loading=!0,console.log("Fetching notices...");const e=await this.$http.get("/api/admin/notices",{params:{keyword:this.searchKeyword,type:this.searchType,page:this.currentPage-1,size:this.pageSize}});if(200===e.data.code){const t=e.data.data;this.noticeList=Array.isArray(t)?t:t.content||[],this.total=t.totalElements||this.noticeList.length}else this.$message.error(e.data.msg||"获取通知列表失败")}catch(e){console.error("获取通知列表失败:",e),this.$message.error("获取通知列表失败")}finally{this.loading=!1}},handleSearch(){this.currentPage=1,this.fetchNoticeList()},handleSizeChange(e){this.pageSize=e,this.fetchNoticeList()},handleCurrentChange(e){this.currentPage=e,this.fetchNoticeList()},handleAdd(){if(this.dialogTitle="发布通知",this.form={id:null,type:"OTHER",priority:"NORMAL",title:"",content:"",status:1,createTime:null,updateTime:null,createBy:null},this.$store.state.user)this.form.createBy=this.$store.state.user.id;else{const e=localStorage.getItem("userId");e&&(this.form.createBy=parseInt(e))}this.dialogVisible=!0},handleView(e){this.currentNotice={...e},this.viewDialogVisible=!0},handleEdit(e){this.dialogTitle="编辑通知",this.form={...e},this.dialogVisible=!0},async handleSubmit(){this.$refs.form.validate(async e=>{if(e)try{const e=this.form.id?"/api/admin/notices/"+this.form.id:"/api/admin/notices",t=this.form.id?"put":"post",s=await this.$http[t](e,this.form);200===s.data.code?(this.$message.success(this.form.id?"更新成功":"添加成功"),this.dialogVisible=!1,this.fetchNoticeList()):this.$message.error(s.data.msg||"操作失败")}catch(s){var t;console.error("操作失败:",s),this.$message.error((null===(t=s.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.msg)||"操作失败")}})},async handleDelete(e){try{await this.$confirm("确认删除该通知吗？","提示",{type:"warning"});const t=await this.$http.delete("/api/admin/notices/"+e.id);200===t.data.code&&(this.$message.success("删除成功"),this.fetchNoticeList())}catch(t){"cancel"!==t&&this.$message.error("删除失败")}},async handleStatusChange(e){try{const t=await this.$http.put(`/admin/notices/${e.id}/status`,{status:e.status});200===t.data.code?this.$message.success((1===e.status?"启用":"禁用")+"成功"):(e.status=1===e.status?0:1,this.$message.error(t.data.msg||"操作失败"))}catch(t){e.status=1===e.status?0:1,this.$message.error("操作失败")}}}},Se=ke,Ce=(s("b29e"),Object(n["a"])(Se,we,_e,!1,null,"6a5306ea",null)),$e=Ce.exports,xe=function(){var e=this,t=e._self._c;return t("div",{staticClass:"profile"},[t("el-card",{staticClass:"profile-card"},[t("div",{attrs:{slot:"header"},slot:"header"},[t("span",[e._v("个人信息")]),t("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:e.handleEdit}},[e._v(" 修改 ")])],1),t("el-form",{attrs:{"label-width":"80px",model:e.userInfo,disabled:!e.isEditing}},[t("el-form-item",{attrs:{label:"用户名"}},[t("el-input",{attrs:{disabled:""},model:{value:e.userInfo.username,callback:function(t){e.$set(e.userInfo,"username",t)},expression:"userInfo.username"}})],1),t("el-form-item",{attrs:{label:"姓名"}},[t("el-input",{model:{value:e.userInfo.realName,callback:function(t){e.$set(e.userInfo,"realName",t)},expression:"userInfo.realName"}})],1),t("el-form-item",{attrs:{label:"邮箱"}},[t("el-input",{model:{value:e.userInfo.email,callback:function(t){e.$set(e.userInfo,"email",t)},expression:"userInfo.email"}})],1),t("el-form-item",{attrs:{label:"手机号"}},[t("el-input",{model:{value:e.userInfo.phone,callback:function(t){e.$set(e.userInfo,"phone",t)},expression:"userInfo.phone"}})],1)],1),e.isEditing?t("div",{staticClass:"button-group"},[t("el-button",{on:{click:function(t){e.isEditing=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.handleSave}},[e._v("保存")])],1):e._e()],1),t("el-card",{staticClass:"password-card"},[t("div",{attrs:{slot:"header"},slot:"header"},[t("span",[e._v("修改密码")])]),t("el-form",{ref:"passwordForm",attrs:{model:e.passwordForm,rules:e.passwordRules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"原密码",prop:"oldPassword"}},[t("el-input",{attrs:{type:"password"},model:{value:e.passwordForm.oldPassword,callback:function(t){e.$set(e.passwordForm,"oldPassword",t)},expression:"passwordForm.oldPassword"}})],1),t("el-form-item",{attrs:{label:"新密码",prop:"newPassword"}},[t("el-input",{attrs:{type:"password"},model:{value:e.passwordForm.newPassword,callback:function(t){e.$set(e.passwordForm,"newPassword",t)},expression:"passwordForm.newPassword"}})],1),t("el-form-item",{attrs:{label:"确认新密码",prop:"confirmPassword"}},[t("el-input",{attrs:{type:"password"},model:{value:e.passwordForm.confirmPassword,callback:function(t){e.$set(e.passwordForm,"confirmPassword",t)},expression:"passwordForm.confirmPassword"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.handleChangePassword}},[e._v("修改密码")])],1)],1)],1)],1)},Ee=[],Te=(s("d9e2"),s("2f62")),Re={name:"Profile",data(){const e=(e,t,s)=>{t!==this.passwordForm.newPassword?s(new Error("两次输入的密码不一致")):s()};return{isEditing:!1,passwordForm:{oldPassword:"",newPassword:"",confirmPassword:""},passwordRules:{oldPassword:[{required:!0,message:"请输入原密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能小于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:e,trigger:"blur"}]}}},computed:{...Object(Te["b"])({userInfo:e=>e.user})},methods:{handleEdit(){this.isEditing=!0},async handleSave(){try{const e=await this.$http.put("/api/admin/users/update",this.userInfo);200===e.data.code?(this.$message.success("保存成功"),this.isEditing=!1,this.$store.dispatch("setUser",this.userInfo)):this.$message.error(e.data.msg)}catch(e){this.$message.error("保存失败")}},async handleChangePassword(){this.$refs.passwordForm.validate(async e=>{if(e)try{const e={userId:this.userInfo.id,oldPassword:this.passwordForm.oldPassword,newPassword:this.passwordForm.newPassword},t=await this.$http.put("/api/auth/change-password",e);200===t.data.code?(this.$message.success("密码修改成功，请重新登录"),this.$store.dispatch("clearUser"),this.$router.push("/login")):this.$message.error(t.data.msg)}catch(t){this.$message.error("修改密码失败")}})}}},Ie=Re,De=(s("7a67"),Object(n["a"])(Ie,xe,Ee,!1,null,"2c68ba63",null)),Ne=(De.exports,function(){var e=this,t=e._self._c;return t("div",{staticClass:"data-review"},[t("div",{staticClass:"header"},[t("h2",[e._v("数据录入与审核")]),t("div",{staticClass:"actions"},[t("el-button",{attrs:{type:"success"},on:{click:e.exportData}},[t("i",{staticClass:"el-icon-download"}),e._v(" 导出数据 ")])],1)]),t("div",{staticClass:"filters"},[t("el-form",{staticClass:"filter-form",attrs:{inline:!0}},[t("el-form-item",{attrs:{label:"状态"}},[t("el-select",{attrs:{placeholder:"选择状态",clearable:""},model:{value:e.filters.status,callback:function(t){e.$set(e.filters,"status",t)},expression:"filters.status"}},[t("el-option",{attrs:{label:"待审核",value:"PENDING"}}),t("el-option",{attrs:{label:"已通过",value:"APPROVED"}}),t("el-option",{attrs:{label:"已驳回",value:"REJECTED"}})],1)],1),t("el-form-item",{attrs:{label:"关键词"}},[t("el-input",{attrs:{placeholder:"学号/姓名",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}},model:{value:e.filters.keyword,callback:function(t){e.$set(e.filters,"keyword",t)},expression:"filters.keyword"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("查询")]),t("el-button",{on:{click:e.resetFilters}},[e._v("重置")])],1)],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.records,border:""}},[t("el-table-column",{attrs:{label:"序号",type:"index",width:"50",align:"center"}}),t("el-table-column",{attrs:{prop:"studentNumber",label:"学号",width:"120"}}),t("el-table-column",{attrs:{prop:"studentName",label:"姓名",width:"120"}}),t("el-table-column",{attrs:{prop:"className",label:"班级",width:"120"}}),t("el-table-column",{attrs:{label:"测试项目",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.sportsItem?t.row.sportsItem.name:"")+" ")]}}])}),t("el-table-column",{attrs:{prop:"score",label:"成绩",width:"100"}}),t("el-table-column",{attrs:{prop:"reviewStatus",label:"审核状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-tag",{attrs:{type:e.getReviewStatusType(s.row.reviewStatus)}},[e._v(" "+e._s(e.getReviewStatusText(s.row.reviewStatus))+" ")])]}}])}),t("el-table-column",{attrs:{prop:"reviewComment",label:"审核意见"}}),t("el-table-column",{attrs:{prop:"createdAt",label:"创建时间",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.formatDateTime(t.row.createdAt))+" ")]}}])}),t("el-table-column",{attrs:{label:"操作",width:"200",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.handleDetail(s.row)}}},[e._v("详情")]),"PENDING"===s.row.reviewStatus?t("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){return e.handleReview(s.row,"APPROVED")}}},[e._v("审核")]):e._e()]}}])})],1),t("div",{staticClass:"pagination-container"},[t("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[10,20,50,100],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t}}})],1),t("el-dialog",{attrs:{title:"录入成绩",visible:e.addDialog.visible,width:"500px"},on:{"update:visible":function(t){return e.$set(e.addDialog,"visible",t)},closed:function(t){return e.resetForm("addForm")}}},[t("el-form",{ref:"addForm",attrs:{model:e.addForm,rules:e.rules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"学生",prop:"studentId",required:""}},[t("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",remote:"","reserve-keyword":"",placeholder:"请选择学生","remote-method":e.searchStudents,loading:e.studentLoading},model:{value:e.addForm.studentId,callback:function(t){e.$set(e.addForm,"studentId",t)},expression:"addForm.studentId"}},e._l(e.students,(function(s){return t("el-option",{key:s.id,attrs:{label:`${s.realName} (${s.studentNumber})`,value:s.id}},[t("span",[e._v(e._s(s.realName))]),t("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(s.studentNumber))])])})),1)],1),t("el-form-item",{attrs:{label:"测试项目",prop:"sportsItemId",required:""}},[t("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"请选择测试项目"},on:{change:e.handleSportsItemChange},model:{value:e.addForm.sportsItemId,callback:function(t){e.$set(e.addForm,"sportsItemId",t)},expression:"addForm.sportsItemId"}},e._l(e.sportsItems,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"成绩",prop:"score",required:""}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{precision:2,step:.01,min:0,"controls-position":"right"},model:{value:e.addForm.score,callback:function(t){e.$set(e.addForm,"score",t)},expression:"addForm.score"}})],1),t("el-form-item",{attrs:{label:"班级",prop:"className"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择班级"},model:{value:e.addForm.className,callback:function(t){e.$set(e.addForm,"className",t)},expression:"addForm.className"}},e._l(e.classNames,(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.addDialog.visible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submitAdd}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"成绩审核",visible:e.reviewDialog.visible,width:"500px"},on:{"update:visible":function(t){return e.$set(e.reviewDialog,"visible",t)}}},[e.currentRecord?t("div",{staticClass:"review-info"},[t("el-descriptions",{attrs:{column:2,border:""}},[t("el-descriptions-item",{attrs:{label:"学生"}},[e._v(e._s(e.currentRecord.student?e.currentRecord.student.realName:"-")+" ("+e._s(e.currentRecord.studentNumber||"-")+")")]),t("el-descriptions-item",{attrs:{label:"测试项目"}},[e._v(e._s(e.currentRecord.sportsItem?e.currentRecord.sportsItem.name:"-"))]),t("el-descriptions-item",{attrs:{label:"测试成绩"}},[e._v(e._s(e.currentRecord.score||"-")+" "+e._s(e.currentRecord.sportsItem?e.currentRecord.sportsItem.unit:""))]),t("el-descriptions-item",{attrs:{label:"班级"}},[e._v(e._s(e.currentRecord.className||"-"))]),t("el-descriptions-item",{attrs:{label:"录入教师"}},[e._v(e._s(e.currentRecord.teacher?e.currentRecord.teacher.realName:"-"))]),t("el-descriptions-item",{attrs:{label:"录入时间"}},[e._v(e._s(e.formatDateTime(e.currentRecord.createdAt)))])],1)],1):e._e(),t("el-form",{ref:"reviewForm",staticClass:"review-form",attrs:{model:e.reviewForm,rules:e.reviewRules}},[t("el-form-item",{attrs:{label:"审核结果",prop:"status"}},[t("el-radio-group",{model:{value:e.reviewForm.status,callback:function(t){e.$set(e.reviewForm,"status",t)},expression:"reviewForm.status"}},[t("el-radio",{attrs:{label:"APPROVED"}},[e._v("通过")]),t("el-radio",{attrs:{label:"REJECTED"}},[e._v("驳回")])],1)],1),t("el-form-item",{attrs:{label:"审核意见",prop:"comment"}},[t("el-input",{attrs:{type:"textarea",rows:3,placeholder:"请输入审核意见"},model:{value:e.reviewForm.comment,callback:function(t){e.$set(e.reviewForm,"comment",t)},expression:"reviewForm.comment"}})],1)],1),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.reviewDialog.visible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submitReview}},[e._v("确定")])],1)],1),t("el-dialog",{attrs:{title:"成绩详情",visible:e.detailDialog.visible,width:"500px"},on:{"update:visible":function(t){return e.$set(e.detailDialog,"visible",t)}}},[e.currentRecord?t("div",{staticClass:"record-detail"},[t("el-descriptions",{attrs:{column:2,border:""}},[t("el-descriptions-item",{attrs:{label:"学生"}},[e._v(e._s(e.currentRecord.student?e.currentRecord.student.realName:"-")+" ("+e._s(e.currentRecord.studentNumber||"-")+")")]),t("el-descriptions-item",{attrs:{label:"测试项目"}},[e._v(e._s(e.currentRecord.sportsItem?e.currentRecord.sportsItem.name:"-"))]),t("el-descriptions-item",{attrs:{label:"测试成绩"}},[e._v(e._s(e.currentRecord.score||"-")+" "+e._s(e.currentRecord.sportsItem?e.currentRecord.sportsItem.unit:""))]),t("el-descriptions-item",{attrs:{label:"班级"}},[e._v(e._s(e.currentRecord.className||"-"))]),t("el-descriptions-item",{attrs:{label:"录入教师"}},[e._v(e._s(e.currentRecord.teacher?e.currentRecord.teacher.realName:"-"))]),t("el-descriptions-item",{attrs:{label:"录入时间"}},[e._v(e._s(e.formatDateTime(e.currentRecord.createdAt)))]),t("el-descriptions-item",{attrs:{label:"审核状态"}},[t("el-tag",{attrs:{type:e.getReviewStatusType(e.currentRecord.reviewStatus)}},[e._v(" "+e._s(e.getReviewStatusText(e.currentRecord.reviewStatus))+" ")])],1),t("el-descriptions-item",{attrs:{label:"审核意见"}},[e._v(e._s(e.currentRecord.reviewComment||"-"))])],1)],1):e._e(),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.detailDialog.visible=!1}}},[e._v("关闭")]),e.currentRecord&&"PENDING"===e.currentRecord.reviewStatus?t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleReview(e.currentRecord,"APPROVED")}}},[e._v("审核")]):e._e()],1)]),t("el-dialog",{attrs:{title:"修改审核状态",visible:e.modifyDialog.visible,width:"400px"},on:{"update:visible":function(t){return e.$set(e.modifyDialog,"visible",t)}}},[t("div",{staticClass:"review-info"},[t("p",[e._v("学生："+e._s(e.currentRecord&&e.currentRecord.student?e.currentRecord.student.realName:"-")+" ("+e._s(e.currentRecord?e.currentRecord.studentNumber:"-")+")")]),t("p",[e._v("项目："+e._s(e.currentRecord&&e.currentRecord.sportsItem?e.currentRecord.sportsItem.name:"-"))]),t("p",[e._v("成绩："+e._s(e.currentRecord?e.currentRecord.score:"-")+" "+e._s(e.currentRecord&&e.currentRecord.sportsItem?e.currentRecord.sportsItem.unit:""))])]),t("el-form",{ref:"modifyForm",attrs:{model:e.modifyForm,rules:e.modifyRules,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"审核状态",prop:"status"}},[t("el-select",{attrs:{placeholder:"请选择审核状态"},model:{value:e.modifyForm.status,callback:function(t){e.$set(e.modifyForm,"status",t)},expression:"modifyForm.status"}},[t("el-option",{attrs:{label:"待审核",value:"PENDING"}}),t("el-option",{attrs:{label:"通过",value:"APPROVED"}}),t("el-option",{attrs:{label:"驳回",value:"REJECTED"}})],1)],1),t("el-form-item",{attrs:{label:"审核意见",prop:"comment"}},[t("el-input",{attrs:{type:"textarea",rows:3,placeholder:"请输入审核意见"},model:{value:e.modifyForm.comment,callback:function(t){e.$set(e.modifyForm,"comment",t)},expression:"modifyForm.comment"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.modifyDialog.visible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submitModify}},[e._v("确 定")])],1)],1)],1)}),Pe=[],Fe=(s("e9f5"),s("f665"),s("bc3a")),Ae=s.n(Fe),ze=s("b775");function Oe(e){return Object(ze["a"])({url:"/api/admin/test-record/modify",method:"put",data:e})}var Ue={name:"DataReview",data(){return{loading:!1,records:[],total:0,currentPage:1,pageSize:10,filters:{status:"",keyword:""},sportsItems:[],classList:[],addDialog:{visible:!1},addForm:{studentId:null,sportsItemId:null,score:0,className:""},rules:{studentId:[{required:!0,message:"请选择学生",trigger:"change"}],sportsItemId:[{required:!0,message:"请选择测试项目",trigger:"change"}],score:[{required:!0,message:"请输入成绩",trigger:"blur"}]},teachers:[],selectedItemUnit:"",students:[],reviewDialog:{visible:!1},currentRecord:null,reviewForm:{id:null,status:"",comment:""},reviewRules:{status:[{required:!0,message:"请选择审核结果",trigger:"change"}],comment:[{required:!0,message:"请输入审核意见",trigger:"blur"}]},studentLoading:!1,detailDialog:{visible:!1},historyRecords:[],modifyDialog:{visible:!1},modifyForm:{id:null,status:"",comment:""},modifyRules:{status:[{required:!0,message:"请选择审核状态",trigger:"change"}],comment:[{required:!0,message:"请输入审核意见",trigger:"blur"}]},classNames:[]}},created(){this.init()},methods:{async init(){await Promise.all([this.getSportsItems(),this.fetchRecords()])},async fetchRecords(){try{this.loading=!0;const{status:e,keyword:t}=this.filters,s=await this.$http.get("/api/admin/test-records",{params:{status:e,keyword:t,page:this.currentPage-1,size:this.pageSize}});if(200===s.data.code){const{content:e,totalElements:t}=s.data.data;this.records=e,this.total=t}else this.$message.error(s.data.msg||"获取数据失败")}catch(e){console.error("获取记录失败:",e),this.$message.error("获取记录失败")}finally{this.loading=!1}},async getSportsItems(){try{const e=await this.$http.get("/api/sports-items");200===e.data.code?this.sportsItems=e.data.data.content||[]:this.$message.error(e.data.msg||"获取体测项目列表失败")}catch(e){console.error("获取体测项目列表失败:",e),this.$message.error("获取体测项目列表失败")}},handleSearch(){this.currentPage=1,this.fetchRecords()},resetFilters(){this.filters={status:"",keyword:""},this.handleSearch()},getReviewStatusText(e){const t={PENDING:"待审核",APPROVED:"已通过",REJECTED:"已驳回"};return t[e]||e},getReviewStatusType(e){const t={PENDING:"warning",APPROVED:"success",REJECTED:"danger"};return t[e]||"info"},formatDateTime(e){return e?new Date(e).toLocaleString():""},showAddDialog(){this.addDialog.visible=!0,this.loadSportsItems(),this.loadClassNames()},async exportData(){try{const e=this.$loading({lock:!0,text:"正在导出数据...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),t={status:this.filters.status||null,keyword:this.filters.keyword||null},s=Object({NODE_ENV:"production",BASE_URL:"/"}).VUE_APP_API_URL||"http://localhost:8080",a=await Ae()({url:s+"/api/admin/test-records/export",method:"GET",params:t,responseType:"blob",headers:{"X-User-ID":localStorage.getItem("userId")||"1"}}),r=new Blob([a.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});let o="体测数据.xlsx";const i=a.headers["content-disposition"];if(i){const e=i.match(/filename="(.+?)"/);e&&e.length>1&&(o=decodeURIComponent(e[1]))}const l=window.URL.createObjectURL(r),n=document.createElement("a");n.href=l,n.download=o,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(l),e.close(),this.$message.success("数据导出成功")}catch(e){console.error("导出失败:",e),this.$message.error("导出失败: "+(e.message||"未知错误"))}},resetForm(e){this.$refs[e]&&this.$refs[e].resetFields(),this.addForm={studentId:null,sportsItemId:null,score:0,className:""}},submitAdd(){this.$refs.addForm.validate(async e=>{if(e)try{const e=await this.$http.post("/api/admin/test-records",this.addForm);200===e.data.code?(this.$message.success("成绩录入成功"),this.addDialog.visible=!1,this.handleSearch()):this.$message.error(e.data.msg||"录入失败")}catch(t){console.error("录入失败:",t),this.$message.error("录入失败")}})},handleReview(e,t){this.currentRecord=e,this.reviewForm.status=t,this.reviewDialog.visible=!0},submitReview(){this.$refs.reviewForm.validate(async e=>{if(e)try{await this.$http.put(`/api/admin/records/${this.currentRecord.id}/review`,null,{params:{status:this.reviewForm.status,comment:this.reviewForm.comment||""}});this.$message.success("审核成功"),this.reviewDialog.visible=!1,this.handleSearch()}catch(s){var t;if(s.response&&s.response.data&&s.response.data.msg&&s.response.data.msg.includes("异常成绩"))this.$confirm(s.response.data.msg+"，确定要强制通过审核吗？","异常成绩警告",{confirmButtonText:"强制通过",cancelButtonText:"取消",type:"warning"}).then(async()=>{await this.$http.put(`/api/admin/records/${this.currentRecord.id}/review`,null,{params:{status:this.reviewForm.status,comment:this.reviewForm.comment+" (强制通过异常成绩)",forceApprove:!0}});this.$message.success("已强制通过审核"),this.reviewDialog.visible=!1,this.handleSearch()}).catch(()=>{this.$message.info("已取消审核")});else console.error("审核失败:",s),this.$message.error("审核失败: "+((null===(t=s.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.msg)||s.message||"未知错误"))}})},handleDetail(e){this.currentRecord=e,this.detailDialog.visible=!0},handleSportsItemChange(e){const t=this.sportsItems.find(t=>t.id===e);t&&(this.selectedItemUnit=t.unit)},searchStudents(e){e&&(this.studentLoading=!0,this.$http.get("/api/admin/students",{params:{query:e,page:0,size:10}}).then(e=>{200===e.data.code?this.students=e.data.data.content||[]:this.$message.error(e.data.msg||"获取学生列表失败")}).finally(()=>{this.studentLoading=!1}))},handleSizeChange(e){this.pageSize=e,this.handleSearch()},handleCurrentChange(e){this.currentPage=e,this.handleSearch()},submitModify(){this.$refs.modifyForm.validate(async e=>{if(e)try{const e=await Oe(this.currentRecord.id,this.modifyForm);200===e.data.code?(this.$message.success("审核状态修改成功"),this.modifyDialog.visible=!1,this.handleSearch()):this.$message.error(e.data.msg||"修改失败")}catch(t){console.error("修改失败:",t),this.$message.error("修改失败")}})},async loadSportsItems(){try{const e=await this.$http.get("/api/sports-items");200===e.data.code&&(this.sportsItems=e.data.data)}catch(e){console.error("获取体育项目失败:",e),this.$message.error("获取体育项目失败")}},async loadClassNames(){try{const e=await this.$http.get("/api/admin/class-names");200===e.data.code&&(this.classNames=e.data.data)}catch(e){console.error("获取班级列表失败:",e)}}}},Le=Ue,Ve=(s("0c5e"),Object(n["a"])(Le,Ne,Pe,!1,null,"215cd954",null)),Me=Ve.exports,qe=function(){var e=this,t=e._self._c;return t("div",{staticClass:"test-records"},[t("div",{staticClass:"filter-container"},[t("el-select",{attrs:{placeholder:"状态",clearable:""},model:{value:e.status,callback:function(t){e.status=t},expression:"status"}},[t("el-option",{attrs:{label:"全部",value:""}}),t("el-option",{attrs:{label:"待审核",value:"PENDING"}}),t("el-option",{attrs:{label:"已通过",value:"APPROVED"}}),t("el-option",{attrs:{label:"已拒绝",value:"REJECTED"}})],1),t("el-button",{attrs:{type:"primary"},on:{click:e.getTestRecords}},[e._v("查询")]),t("el-button",{on:{click:e.resetQuery}},[e._v("重置")])],1),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.records,border:""}},[t("el-table-column",{attrs:{prop:"createdAt",label:"测试时间",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.formatDateTime(t.row.createdAt))+" ")]}}])}),t("el-table-column",{attrs:{prop:"sportsItemName",label:"体育项目"}}),t("el-table-column",{attrs:{prop:"score",label:"成绩"}}),t("el-table-column",{attrs:{prop:"grade",label:"等级"}}),t("el-table-column",{attrs:{prop:"status",label:"状态",width:"120"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-tag",{attrs:{type:e.getStatusType(s.row.status)}},[e._v(" "+e._s(e.getStatusText(s.row.status))+" ")])]}}])}),t("el-table-column",{attrs:{prop:"reviewComment",label:"审核意见"}})],1),t("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[10,20,50],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)},je=[],He={name:"TestRecords",data(){return{status:"",currentPage:1,pageSize:10,total:0,records:[],loading:!1}},created(){this.getTestRecords()},methods:{async getTestRecords(){try{this.loading=!0;const e=localStorage.getItem("userId");if(!e)return this.$message.error("未登录或用户信息缺失"),void this.$router.push("/login");console.log("请求参数:",{status:this.status,page:this.currentPage,size:this.pageSize,userId:e});const t=await this.$axios.get("/api/student/test-records",{params:{status:this.status,page:this.currentPage,size:this.pageSize},headers:{userId:e}});console.log("获取到的记录数据:",t.data.data.content),200===t.data.code?(this.records=t.data.data.content,this.total=t.data.data.totalElements):this.$message.error(t.data.message||"获取数据失败")}catch(e){console.error("获取测试记录失败:",e),"object"===typeof e&&e.message?this.$message.error("获取测试记录失败: "+e.message):this.$message.error("获取测试记录失败: "+e)}finally{this.loading=!1}},handleSizeChange(e){console.log("改变每页数量:",e),this.pageSize=e,this.getTestRecords()},handleCurrentChange(e){console.log("改变页码:",e),this.currentPage=e,this.getTestRecords()},resetQuery(){this.status="",this.currentPage=1,this.getTestRecords()},getStatusType(e){const t={TESTED:"success",NOT_TESTED:"info",EXEMPTED:"warning",APPROVED:"success",REJECTED:"danger",PENDING:"warning"};return t[e]||"info"},getStatusText(e){const t={TESTED:"已测试",NOT_TESTED:"未测试",EXEMPTED:"免测",APPROVED:"已通过",REJECTED:"已驳回",PENDING:"待审核"};return t[e]||e},formatDateTime(e){if(!e)return"";const t=new Date(e);return t.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}}},Be=He,Ge=(s("a3c5"),Object(n["a"])(Be,qe,je,!1,null,"00931aea",null)),Je=Ge.exports,Ke=function(){var e=this,t=e._self._c;return t("el-container",{staticClass:"layout-container"},[t("el-aside",{attrs:{width:"200px"}},[t("el-menu",{staticClass:"el-menu-vertical",attrs:{"default-active":e.activeMenu,"background-color":"#304156","text-color":"#fff","active-text-color":"#409EFF",router:!0}},[t("el-menu-item",{attrs:{index:"/student/home"}},[t("i",{staticClass:"el-icon-s-home"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("首页")])]),t("el-menu-item",{attrs:{index:"/student/test-records"}},[t("i",{staticClass:"el-icon-data-line"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("体测成绩")])]),t("el-menu-item",{attrs:{index:"/student/sports-standard"}},[t("i",{staticClass:"el-icon-document"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("体测标准")])]),t("el-menu-item",{attrs:{index:"/student/score-appeal"}},[t("i",{staticClass:"el-icon-warning"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("成绩申诉")])]),t("el-menu-item",{attrs:{index:"/student/exemption"}},[t("i",{staticClass:"el-icon-document-checked"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("免测/重测申请")])]),t("el-menu-item",{attrs:{index:"/student/notices"}},[t("i",{staticClass:"el-icon-bell"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("通知公告")])]),t("el-menu-item",{attrs:{index:"/student/feedback"}},[t("i",{staticClass:"el-icon-chat-dot-round"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("意见反馈")])]),t("el-menu-item",{attrs:{index:"/student/profile"}},[t("i",{staticClass:"el-icon-user"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("个人信息")])])],1)],1),t("el-container",[t("el-header",[t("div",{staticClass:"header-left"},[t("h2",[e._v("体育测试管理系统 - 学生端")])]),t("div",{staticClass:"header-right"},[t("el-dropdown",{attrs:{trigger:"click"},on:{command:e.handleCommand}},[t("span",{staticClass:"el-dropdown-link"},[e._v(" "+e._s(e.username)),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"logout"}},[e._v("退出登录")])],1)],1)],1)]),t("el-main",[t("router-view")],1)],1)],1)},Xe=[],Ye={name:"StudentLayout",data(){return{username:localStorage.getItem("username")||"学生"}},computed:{activeMenu(){return this.$route.path}},created(){const e=localStorage.getItem("userId"),t=localStorage.getItem("userRole"),s=localStorage.getItem("token");console.log("StudentLayout created - 用户信息:",{userId:e,userRole:t,token:s}),s&&e&&t&&"STUDENT"===t||(console.log("用户信息无效，重定向到登录页"),localStorage.clear(),this.$router.push("/login"))},methods:{handleCommand(e){"logout"===e&&(localStorage.clear(),this.$router.push("/login"))}}},Qe=Ye,We=(s("94b0"),Object(n["a"])(Qe,Ke,Xe,!1,null,"59910f16",null)),Ze=We.exports;a["default"].use(u["a"]);const et={path:"/student",component:Ze,meta:{requiresAuth:!0,role:"STUDENT"},children:[{path:"",redirect:"home"},{path:"home",name:"StudentHome",component:()=>s.e("chunk-11d6ab97").then(s.bind(null,"d4e6")),meta:{title:"首页",requiresAuth:!0,role:"STUDENT",keepAlive:!0}},{path:"test-records",name:"StudentTestRecords",component:Je,meta:{title:"体测成绩"}},{path:"sports-standard",name:"SportsStandard",component:()=>s.e("chunk-2e272d06").then(s.bind(null,"0a4a")),meta:{title:"体测标准"}},{path:"score-appeal",name:"ScoreAppeal",component:()=>s.e("chunk-521f1c06").then(s.bind(null,"a1d7")),meta:{title:"成绩申诉"}},{path:"notices",name:"StudentNotices",component:()=>s.e("chunk-0b7e33b0").then(s.bind(null,"993d")),meta:{title:"通知公告"}},{path:"feedback",name:"StudentFeedback",component:()=>s.e("chunk-40d7f547").then(s.bind(null,"4959")),meta:{title:"意见反馈"}},{path:"exemption",name:"StudentExemption",component:()=>s.e("chunk-4cff9319").then(s.bind(null,"168a")),meta:{requiresAuth:!0,role:"STUDENT"}},{path:"profile",name:"StudentProfile",component:()=>s.e("chunk-4520ee9f").then(s.bind(null,"1671")),meta:{title:"个人信息",requiresAuth:!0,role:"STUDENT"}}]},tt=[{path:"/login",name:"Login",component:b,meta:{requiresAuth:!1}},{path:"/admin",component:S,redirect:"/admin/dashboard",children:[{path:"dashboard",name:"AdminHome",component:()=>s.e("chunk-700a0965").then(s.bind(null,"6966")),meta:{title:"首页",icon:"dashboard"}},{path:"users/student",name:"StudentManagement",component:le},{path:"users/teacher",name:"TeacherManagement",component:pe},{path:"sports-items",name:"SportsItemManagement",component:ye,meta:{requiresAuth:!0,requiresAdmin:!0}},{path:"notices",name:"NoticeManagement",component:$e},{path:"profile",name:"Profile",component:()=>s.e("chunk-13199d7f").then(s.bind(null,"ecac")),meta:{title:"个人信息",icon:"el-icon-user"}},{path:"data-review",name:"DataReview",component:Me,meta:{title:"数据录入与审核",requiresAuth:!0,role:"ADMIN"}},{path:"exemption-review",name:"ExemptionReview",component:()=>s.e("chunk-eae0d316").then(s.bind(null,"2b76")),meta:{title:"免测/重测申请",icon:"el-icon-document-checked"}},{path:"feedback",name:"AdminFeedback",component:()=>s.e("chunk-c1d6e44a").then(s.bind(null,"2d59")),meta:{requiresAuth:!0,roles:["ADMIN"]}}]},{path:"/admin/test-records",name:"TestRecordList",component:z,meta:{requiresAuth:!0,roles:["ADMIN"]}},{path:"/admin/users",name:"UserList",component:q,meta:{requiresAuth:!0,roles:["ADMIN"]}},{path:"/teacher",component:()=>s.e("chunk-8d3a07ac").then(s.bind(null,"610b")),meta:{requiresAuth:!0,role:"TEACHER"},children:[{path:"dashboard",name:"TeacherDashboard",component:()=>s.e("chunk-36afc62f").then(s.bind(null,"c865")),meta:{title:"首页"}},{path:"class-stats",name:"ClassStats",component:()=>s.e("chunk-3c786940").then(s.bind(null,"dac2")),meta:{title:"班级成绩统计"}},{path:"student-records",name:"StudentRecords",component:()=>s.e("chunk-3ab03eee").then(s.bind(null,"1bd6")),meta:{title:"学生成绩管理"}},{path:"exemption-review",name:"TeacherExemptionReview",component:()=>s.e("chunk-6177d41a").then(s.bind(null,"a245")),meta:{title:"免测/重测审核"}},{path:"profile",name:"TeacherProfile",component:()=>s.e("chunk-13199d7f").then(s.bind(null,"ecac")),meta:{title:"个人信息"}},{path:"notice-management",name:"TeacherNoticeManagement",component:()=>s.e("chunk-67d2f004").then(s.bind(null,"762f")),meta:{title:"通知管理",roles:["TEACHER"]}},{path:"/teacher/student-records",name:"TeacherStudentRecords",component:()=>s.e("chunk-3ab03eee").then(s.bind(null,"1bd6")),meta:{title:"学生成绩管理",roles:["TEACHER"]}},{path:"score-appeals",name:"TeacherScoreAppeals",component:()=>s.e("chunk-46256bdf").then(s.bind(null,"38bf")),meta:{title:"成绩申诉审核",requiresAuth:!0,role:"TEACHER"}}]},et,{path:"/",redirect:e=>{const t=localStorage.getItem("token"),s=localStorage.getItem("userRole");if(!t)return"/login";switch(s){case"STUDENT":return"/student/home";case"TEACHER":return"/teacher/dashboard";case"ADMIN":return"/admin/dashboard";default:return"/login"}}}],st=new u["a"]({mode:"history",base:"/",routes:tt});st.beforeEach((e,t,s)=>{const a=localStorage.getItem("token"),r=localStorage.getItem("userRole"),o=localStorage.getItem("userId");if(console.log("路由守卫 - 当前状态:",{to:e.path,from:t.path,token:a,userRole:r,userId:o}),"/login"===e.path)if(a&&r)switch(console.log("已登录，重定向到对应首页"),r){case"STUDENT":s("/student/test-records");break;case"TEACHER":s("/teacher/dashboard");break;case"ADMIN":s("/admin/dashboard");break;default:s()}else console.log("未登录，允许访问登录页"),s();else if(a&&r){const t=e.meta.role;if(t&&t!==r)switch(console.log("角色不匹配，重定向到对应首页"),r){case"STUDENT":s("/student/test-records");break;case"TEACHER":s("/teacher/dashboard");break;case"ADMIN":s("/admin/dashboard");break;default:s("/login")}else console.log("验证通过，允许访问"),s()}else console.log("未登录，重定向到登录页"),s("/login")});var at=st;a["default"].use(Te["a"]);var rt=new Te["a"].Store({state:{user:JSON.parse(localStorage.getItem("user"))||null},mutations:{SET_USER(e,t){e.user=t,t?localStorage.setItem("user",JSON.stringify(t)):localStorage.removeItem("user")}},actions:{setUser({commit:e},t){e("SET_USER",t)},clearUser({commit:e}){e("SET_USER",null)}},getters:{isLoggedIn:e=>!!e.user,userType:e=>e.user?e.user.userType:null}}),ot=s("5c96"),it=s.n(ot);s("0fae");a["default"].use(it.a,{tableOptions:{mousewheel:{passive:!0}}}),a["default"].config.productionTip=!1,a["default"].prototype.$http=ze["a"],a["default"].prototype.$axios=ze["a"],new a["default"]({router:at,store:rt,render:e=>e(d)}).$mount("#app")},"5a41":function(e,t,s){"use strict";s("7ab9")},6051:function(e,t,s){},"60d3":function(e,t,s){"use strict";s("f435")},"71ed":function(e,t,s){"use strict";s("4ca1")},7467:function(e,t,s){},"7a67":function(e,t,s){"use strict";s("7e35")},"7ab9":function(e,t,s){},"7e35":function(e,t,s){},"7e79":function(e,t,s){"use strict";s("3bd8")},"8c11":function(e,t,s){},"94b0":function(e,t,s){"use strict";s("d06f")},"9db2":function(e,t,s){"use strict";s("7467")},a3c5:function(e,t,s){"use strict";s("1a2c")},a6ec:function(e,t,s){"use strict";s("d166")},b1ef:function(e,t,s){},b29e:function(e,t,s){"use strict";s("6051")},b775:function(e,t,s){"use strict";var a=s("bc3a"),r=s.n(a),o=s("5c96");const i=r.a.create({baseURL:Object({NODE_ENV:"production",BASE_URL:"/"}).VUE_APP_API_URL||"http://localhost:8080",timeout:5e3});i.interceptors.request.use(e=>{const t=localStorage.getItem("token"),s=localStorage.getItem("userId"),a=localStorage.getItem("username");console.log("请求拦截器:",{url:e.url,method:e.method,token:t,userId:s,username:a,existingHeaders:e.headers}),t&&(e.headers["Authorization"]="Bearer "+t),s&&(e.headers["userId"]=s,console.log("设置请求头 userId:",s));const r=JSON.parse(localStorage.getItem("studentInfo"));return r&&r.id&&(e.headers["X-User-ID"]=r.id),console.log("最终请求配置:",{url:e.url,method:e.method,headers:e.headers}),e},e=>(console.error("请求错误:",e),Promise.reject(e))),i.interceptors.response.use(e=>{const t=e.data;return console.log("Response data:",t),200!==t.code?(Object(o["Message"])({message:t.message||t.msg||"错误",type:"error",duration:5e3}),Promise.reject(t.message||t.msg||"错误")):e},e=>{var t;return console.error("Response error:",e),e.response&&401===e.response.status&&(localStorage.clear(),window.location.href="/login"),o["Message"].error((null===(t=e.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.message)||"请求失败"),Promise.reject(e)}),t["a"]=i},d06f:function(e,t,s){},d166:function(e,t,s){},ee5d:function(e,t,s){"use strict";s("8c11")},f435:function(e,t,s){}});
//# sourceMappingURL=app.154d26ef.js.map