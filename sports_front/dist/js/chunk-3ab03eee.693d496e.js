(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3ab03eee"],{"1bd6":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"student-records"},[t("div",{staticClass:"filter-section"},[t("el-form",{ref:"queryForm",attrs:{inline:!0,model:e.queryParams}},[t("el-form-item",{attrs:{label:"班级"}},[t("el-select",{attrs:{placeholder:"选择班级",clearable:""},model:{value:e.queryParams.className,callback:function(t){e.$set(e.queryParams,"className",t)},expression:"queryParams.className"}},e._l(e.classNames,(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),t("el-form-item",{attrs:{label:"测试项目"}},[t("el-select",{attrs:{placeholder:"选择测试项目",clearable:""},model:{value:e.queryParams.sportsItemId,callback:function(t){e.$set(e.queryParams,"sportsItemId",t)},expression:"queryParams.sportsItemId"}},e._l(e.sportsItems,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"状态"}},[t("el-select",{attrs:{placeholder:"选择状态",clearable:""},model:{value:e.queryParams.status,callback:function(t){e.$set(e.queryParams,"status",t)},expression:"queryParams.status"}},[t("el-option",{attrs:{label:"未测试",value:"PENDING"}}),t("el-option",{attrs:{label:"已测试",value:"APPROVED"}}),t("el-option",{attrs:{label:"免测",value:"EXEMPTED"}})],1)],1),t("el-form-item",{attrs:{label:"学号"}},[t("el-input",{attrs:{placeholder:"请输入学号",clearable:""},model:{value:e.queryParams.studentNumber,callback:function(t){e.$set(e.queryParams,"studentNumber",t)},expression:"queryParams.studentNumber"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.handleQuery}},[e._v("查询")]),t("el-button",{on:{click:e.resetQuery}},[e._v("重置")]),t("el-button",{attrs:{type:"success"},on:{click:e.handleExport}},[e._v("导出成绩")])],1)],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,border:""}},[t("el-table-column",{attrs:{type:"index",label:"序号",width:"60"}}),t("el-table-column",{attrs:{prop:"studentInfo.realName",label:"学生姓名"}}),t("el-table-column",{attrs:{prop:"studentInfo.studentNumber",label:"学号"}}),t("el-table-column",{attrs:{prop:"studentInfo.className",label:"班级"}}),t("el-table-column",{attrs:{prop:"sportsItem.name",label:"测试项目"}}),t("el-table-column",{attrs:{prop:"score",label:"成绩"}}),t("el-table-column",{attrs:{label:"测试状态",align:"center"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-tag",{attrs:{type:e.getStatusType(s.row.status)}},[e._v(" "+e._s(e.getStatusText(s.row.status))+" ")])]}}])}),t("el-table-column",{attrs:{label:"操作",width:"180",align:"center"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{attrs:{size:"mini",type:"primary",disabled:"EXEMPTED"===s.row.status},on:{click:function(t){return e.handleEdit(s.row)}}},[e._v(" "+e._s(e.getActionButtonText(s.row.status))+" ")]),t("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(t){return e.handleDetail(s.row)}}},[e._v(" 详情 ")])]}}])})],1),t("div",{staticClass:"pagination-container"},[t("el-pagination",{attrs:{"current-page":e.queryParams.pageNum,"page-sizes":[10,20,50,100],"page-size":e.queryParams.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),t("el-dialog",{attrs:{title:e.editDialog.title,visible:e.editDialog.visible,width:"500px"},on:{"update:visible":function(t){return e.$set(e.editDialog,"visible",t)},closed:e.handleEditDialogClosed}},[t("el-form",{ref:"editForm",attrs:{model:e.editForm,rules:e.editRules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"学生姓名"}},[t("span",[e._v(e._s(e.editForm.studentName))])]),t("el-form-item",{attrs:{label:"测试项目"}},[t("span",[e._v(e._s(e.editForm.sportsItemName))])]),t("el-form-item",{attrs:{label:"成绩",prop:"score"}},[t("el-input",{attrs:{type:"number"},model:{value:e.editForm.score,callback:function(t){e.$set(e.editForm,"score",e._n(t))},expression:"editForm.score"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.editDialog.visible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submitEdit}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"成绩详情",visible:e.detailDialog.visible,width:"500px"},on:{"update:visible":function(t){return e.$set(e.detailDialog,"visible",t)}}},[t("el-descriptions",{attrs:{column:1,border:""}},[t("el-descriptions-item",{attrs:{label:"学生姓名"}},[e._v(e._s(e.detailForm.studentName))]),t("el-descriptions-item",{attrs:{label:"学号"}},[e._v(e._s(e.detailForm.studentNumber))]),t("el-descriptions-item",{attrs:{label:"班级"}},[e._v(e._s(e.detailForm.className))]),t("el-descriptions-item",{attrs:{label:"测试项目"}},[e._v(e._s(e.detailForm.sportsItemName))]),t("el-descriptions-item",{attrs:{label:"成绩"}},[e._v(e._s(e.detailForm.score))]),t("el-descriptions-item",{attrs:{label:"状态"}},[t("el-tag",{attrs:{type:e.getStatusType(e.detailForm.status)}},[e._v(" "+e._s(e.getStatusText(e.detailForm.status))+" ")])],1),t("el-descriptions-item",{attrs:{label:"创建时间"}},[e._v(e._s(e.detailForm.createdAt))]),t("el-descriptions-item",{attrs:{label:"更新时间"}},[e._v(e._s(e.detailForm.updatedAt))])],1)],1)],1)},r=[],i=(s("d9e2"),s("88a7"),s("271a"),s("5494"),{name:"StudentRecords",data(){return{loading:!1,queryParams:{pageNum:1,pageSize:10,className:"",sportsItemId:void 0,status:"",studentNumber:""},classNames:[],sportsItems:[],tableData:[],total:0,editDialog:{visible:!1,title:"修改成绩"},editForm:{id:null,studentName:"",sportsItemName:"",score:null},editRules:{score:[{required:!0,message:"请输入成绩",trigger:"blur"},{type:"number",message:"成绩必须为数字",trigger:"blur"}]},detailDialog:{visible:!1},detailForm:{studentName:"",studentNumber:"",className:"",sportsItemName:"",score:null,status:"",createdAt:"",updatedAt:""}}},created(){this.init()},methods:{async init(){await Promise.all([this.getClassNames(),this.getSportsItems(),this.getList()])},async getList(){try{this.loading=!0;const e=await this.$axios.get("/api/teacher/student-records",{params:{page:this.queryParams.pageNum-1,size:this.queryParams.pageSize,className:this.queryParams.className,sportsItemId:this.queryParams.sportsItemId,status:this.queryParams.status,keyword:this.queryParams.studentNumber}});200===e.data.code&&(this.tableData=e.data.data.content,this.total=e.data.data.totalElements)}catch(e){console.error("获取列表失败:",e),this.$message.error("获取列表失败: "+e.message)}finally{this.loading=!1}},async getClassNames(){try{const e=await this.$axios.get("/api/teacher/classes");200===e.data.code&&(this.classNames=e.data.data)}catch(e){console.error("获取班级列表失败:",e)}},async getSportsItems(){try{const e=await this.$axios.get("/api/teacher/sports-items");200===e.data.code&&(this.sportsItems=e.data.data)}catch(e){console.error("获取体测项目列表失败:",e)}},handleQuery(){this.queryParams.pageNum=1,this.getList()},resetQuery(){this.$refs.queryForm.resetFields(),this.queryParams={pageNum:1,pageSize:10,className:"",sportsItemId:void 0,status:"",studentNumber:""},this.getList()},handleSizeChange(e){this.queryParams.pageSize=e,this.getList()},handleCurrentChange(e){this.queryParams.pageNum=e,this.getList()},getStatusType(e){const t={APPROVED:"success",PENDING:"warning",EXEMPTED:"info",REJECTED:"danger"};return t[e]||"warning"},getStatusText(e){const t={APPROVED:"已测试",PENDING:"未测试",EXEMPTED:"免测",REJECTED:"未测试"};return t[e]||"未测试"},getActionButtonText(e){switch(e){case"APPROVED":return"修改";case"PENDING":case"REJECTED":return"录入";case"EXEMPTED":return"免测";default:return"录入"}},handleEdit(e){this.editForm={id:e.id,studentName:e.studentInfo.realName,sportsItemName:e.sportsItem.name,score:e.score},this.editDialog.title="APPROVED"===e.status?"修改成绩":"录入成绩",this.editDialog.visible=!0},handleDetail(e){this.detailForm={studentName:e.studentInfo.realName,studentNumber:e.studentInfo.studentNumber,className:e.studentInfo.className,sportsItemName:e.sportsItem.name,score:e.score,status:e.status,createdAt:e.createdAt,updatedAt:e.updatedAt},this.detailDialog.visible=!0},submitEdit(){this.$refs.editForm.validate(async e=>{if(e)try{const e=parseFloat(this.editForm.score);if(isNaN(e))return void this.$message.error("请输入有效的成绩");const t=0===e?"PENDING":"APPROVED";console.log("提交数据:",{id:this.editForm.id,score:e,status:t});const s=await this.$axios.put("/api/teacher/test-records/"+this.editForm.id,{score:e,status:t});200===s.data.code?(this.$message.success("修改成绩"===this.editDialog.title?"修改成功":"录入成功"),this.editDialog.visible=!1,await this.getList()):this.$message.error(s.data.message||"操作失败")}catch(s){var t;console.error("操作失败:",s);const e=(null===(t=s.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.message)||"操作失败";this.$message.error(e)}else this.$message.warning("请正确填写表单")})},handleEditDialogClosed(){var e;null===(e=this.$refs.editForm)||void 0===e||e.resetFields(),this.editForm={id:null,studentName:"",sportsItemName:"",score:null}},async handleExport(){try{await this.$confirm("确认要导出当前筛选条件下的成绩数据吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"});const t=this.$loading({lock:!0,text:"正在导出数据，请稍候...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});try{const e={className:this.queryParams.className||"",sportsItemId:this.queryParams.sportsItemId||"",status:this.queryParams.status||"",studentNumber:this.queryParams.studentNumber||""};console.log("导出查询参数:",e);const s=await fetch(`/api/teacher/test-records/export?className=${encodeURIComponent(e.className)}&sportsItemId=${encodeURIComponent(e.sportsItemId||"")}&status=${encodeURIComponent(e.status)}&studentNumber=${encodeURIComponent(e.studentNumber)}`,{method:"GET",headers:{Accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",Authorization:"Bearer "+localStorage.getItem("token"),userId:localStorage.getItem("userId")}});if(!s.ok){const e=await s.text();throw console.error("服务器错误:",e),new Error(`服务器返回错误: ${s.status} ${s.statusText}`)}const a=s.headers.get("content-type");if(a&&a.includes("application/json")){const e=await s.json();return void this.$message.warning(e.message||"没有找到符合条件的记录")}const r=await s.blob();let i="学生成绩记录.xlsx";const l=s.headers.get("content-disposition");if(l&&l.includes("filename")){const e=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/,t=e.exec(l);t&&t[1]&&(i=t[1].replace(/['"]/g,""))}const o=window.URL.createObjectURL(r),n=document.createElement("a");n.href=o,n.download=i,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(o),this.$message.success("导出成功")}catch(e){console.error("导出过程出错:",e),this.$message.error("导出失败："+(e.message||"未知错误"))}finally{t.close()}}catch(e){"cancel"!==e&&console.error("导出操作失败:",e)}}}}),l=i,o=(s("a4e5"),s("2877")),n=Object(o["a"])(l,a,r,!1,null,"3716358f",null);t["default"]=n.exports},a4e5:function(e,t,s){"use strict";s("e292")},e292:function(e,t,s){}}]);
//# sourceMappingURL=chunk-3ab03eee.693d496e.js.map