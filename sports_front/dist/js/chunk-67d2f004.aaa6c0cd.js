(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-67d2f004"],{2035:function(t,e,a){"use strict";a("48e3")},4754:function(t,e,a){"use strict";t.exports=function(t,e){return{value:t,done:e}}},"48e3":function(t,e,a){},6964:function(t,e,a){"use strict";var s=a("cb2d");t.exports=function(t,e,a){for(var r in e)s(t,r,e[r],a);return t}},"762f":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"notice-management"},[e("div",{staticClass:"operation-bar"},[e("div",{staticClass:"search-area"},[e("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"输入标题搜索"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleSearch.apply(null,arguments)}},model:{value:t.searchKeyword,callback:function(e){t.searchKeyword=e},expression:"searchKeyword"}},[e("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:t.handleSearch},slot:"append"})],1),e("el-select",{staticStyle:{width:"120px","margin-left":"10px"},attrs:{placeholder:"通知类型"},model:{value:t.searchType,callback:function(e){t.searchType=e},expression:"searchType"}},[e("el-option",{attrs:{label:"全部",value:""}}),e("el-option",{attrs:{label:"体测安排",value:"TEST_SCHEDULE"}}),e("el-option",{attrs:{label:"成绩公布",value:"SCORE_RELEASE"}}),e("el-option",{attrs:{label:"系统维护",value:"SYSTEM_MAINTENANCE"}}),e("el-option",{attrs:{label:"其他通知",value:"OTHER"}})],1)],1),e("el-button",{attrs:{type:"primary"},on:{click:t.handleAdd}},[e("i",{staticClass:"el-icon-plus"}),t._v(" 发布通知 ")])],1),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.noticeList,border:"",stripe:""}},[e("el-table-column",{attrs:{prop:"id",label:"ID",width:"80"}}),e("el-table-column",{attrs:{prop:"type",label:"类型",width:"100"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-tag",{attrs:{type:t.getTypeTagType(a.row.type)}},[t._v(" "+t._s(t.getTypeLabel(a.row.type))+" ")])]}}])}),e("el-table-column",{attrs:{prop:"title",label:"标题","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",{class:{"important-notice":"HIGH"===a.row.priority}},[t._v(" "+t._s(a.row.title)+" ")])]}}])}),e("el-table-column",{attrs:{prop:"classIds",label:"发送班级",width:"150"},scopedSlots:t._u([{key:"default",fn:function(a){return[a.row.isGlobal?e("span",[t._v("全部班级")]):e("span",[t._v(t._s(t.formatClassIds(a.row.classIds)))])]}}])}),e("el-table-column",{attrs:{prop:"createTime",label:"发布时间",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.formatDate(e.row.createTime))+" ")]}}])}),e("el-table-column",{attrs:{prop:"status",label:"状态",width:"100"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-switch",{attrs:{"active-value":1,"inactive-value":0,"active-color":"#13ce66","inactive-color":"#ff4949"},on:{change:function(e){return t.handleStatusChange(a.row)}},model:{value:a.row.status,callback:function(e){t.$set(a.row,"status",e)},expression:"scope.row.status"}})]}}])}),e("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button-group",{staticClass:"operation-group"},[e("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.handleView(a.row)}}},[t._v(" 查看 ")]),e("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(e){return t.handleEdit(a.row)}}},[t._v(" 编辑 ")]),e("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(e){return t.handleDelete(a.row)}}},[t._v(" 删除 ")])],1)]}}])})],1),e("div",{staticClass:"pagination-container"},[e("el-pagination",{attrs:{"current-page":t.currentPage,"page-sizes":[10,20,50,100],"page-size":t.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),e("el-dialog",{attrs:{title:t.dialogTitle,visible:t.dialogVisible,width:"700px"},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"100px"}},[e("el-form-item",{attrs:{label:"通知类型",prop:"type"}},[e("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择通知类型"},model:{value:t.form.type,callback:function(e){t.$set(t.form,"type",e)},expression:"form.type"}},[e("el-option",{attrs:{label:"体测安排",value:"TEST_SCHEDULE"}}),e("el-option",{attrs:{label:"成绩公布",value:"SCORE_RELEASE"}}),e("el-option",{attrs:{label:"系统维护",value:"SYSTEM_MAINTENANCE"}}),e("el-option",{attrs:{label:"其他通知",value:"OTHER"}})],1)],1),e("el-form-item",{attrs:{label:"重要程度",prop:"priority"}},[e("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择重要程度"},model:{value:t.form.priority,callback:function(e){t.$set(t.form,"priority",e)},expression:"form.priority"}},[e("el-option",{attrs:{label:"普通",value:"NORMAL"}}),e("el-option",{attrs:{label:"重要",value:"HIGH"}})],1)],1),e("el-form-item",{attrs:{label:"发送范围",prop:"isGlobal"}},[e("el-radio-group",{model:{value:t.form.isGlobal,callback:function(e){t.$set(t.form,"isGlobal",e)},expression:"form.isGlobal"}},[e("el-radio",{attrs:{label:!0}},[t._v("全部班级")]),e("el-radio",{attrs:{label:!1}},[t._v("指定班级")])],1)],1),t.form.isGlobal?t._e():e("el-form-item",{attrs:{label:"选择班级",prop:"classIds"}},[e("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",placeholder:"请选择班级"},model:{value:t.selectedClasses,callback:function(e){t.selectedClasses=e},expression:"selectedClasses"}},t._l(t.classList,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),e("el-form-item",{attrs:{label:"标题",prop:"title"}},[e("el-input",{attrs:{maxlength:"100","show-word-limit":""},model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}})],1),e("el-form-item",{attrs:{label:"内容",prop:"content"}},[e("el-input",{attrs:{type:"textarea",rows:10,maxlength:"2000","show-word-limit":""},model:{value:t.form.content,callback:function(e){t.$set(t.form,"content",e)},expression:"form.content"}})],1),e("el-form-item",{attrs:{label:"状态",prop:"status"}},[e("el-switch",{attrs:{"active-value":1,"inactive-value":0,"active-text":"启用","inactive-text":"禁用"},model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}})],1)],1),e("div",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.handleSubmit}},[t._v("确定")])],1)],1),e("el-dialog",{attrs:{title:"查看通知",visible:t.viewDialogVisible,width:"700px"},on:{"update:visible":function(e){t.viewDialogVisible=e}}},[e("div",{staticClass:"notice-header"},[e("el-tag",{staticClass:"notice-type",attrs:{type:t.getTypeTagType(t.currentNotice.type)}},[t._v(" "+t._s(t.getTypeLabel(t.currentNotice.type))+" ")]),e("h3",{staticClass:"notice-title"},[t._v(t._s(t.currentNotice.title))])],1),e("div",{staticClass:"notice-meta"},[e("span",[t._v("发布时间："+t._s(t.formatDate(t.currentNotice.createTime)))]),"HIGH"===t.currentNotice.priority?e("span",{staticClass:"notice-priority"},[e("i",{staticClass:"el-icon-warning"}),t._v(" 重要通知 ")]):t._e(),e("span",[t._v(" 发送范围： "),t.currentNotice.isGlobal?[t._v("全部班级")]:[t._v(t._s(t.formatClassIds(t.currentNotice.classIds)))]],2)]),e("div",{staticClass:"notice-content"},[t._v(t._s(t.currentNotice.content))])])],1)},r=[],i=(a("14d9"),a("e9f5"),a("ab43"),{name:"TeacherNoticeManagement",data(){return{searchKeyword:"",searchType:"",noticeList:[],loading:!1,currentPage:1,pageSize:10,total:0,dialogVisible:!1,viewDialogVisible:!1,dialogTitle:"",currentNotice:{},classList:[],selectedClasses:[],form:{id:null,type:"OTHER",priority:"NORMAL",title:"",content:"",status:1,isGlobal:!0,classIds:"",createTime:null,updateTime:null,creatorId:null},rules:{type:[{required:!0,message:"请选择通知类型",trigger:"change"}],priority:[{required:!0,message:"请选择重要程度",trigger:"change"}],title:[{required:!0,message:"请输入标题",trigger:"blur"},{min:2,max:100,message:"长度在 2 到 100 个字符",trigger:"blur"}],content:[{required:!0,message:"请输入内容",trigger:"blur"},{min:5,max:2e3,message:"长度在 5 到 2000 个字符",trigger:"blur"}]},currentUserId:null}},created(){const t=localStorage.getItem("userRole");if("TEACHER"!==t)return this.$message.error("无权访问"),void this.$router.push("/login");console.log("教师通知管理页面初始化，用户ID:",this.currentUserId),this.fetchNoticeList(),this.fetchClassList()},watch:{selectedClasses(t){this.form.classIds=t.join(",")}},methods:{formatDate(t){return t?new Date(t).toLocaleString():""},getTypeTagType(t){const e={TEST_SCHEDULE:"primary",SCORE_RELEASE:"success",SYSTEM_MAINTENANCE:"warning",OTHER:"info"};return e[t]||"info"},getTypeLabel(t){const e={TEST_SCHEDULE:"体测安排",SCORE_RELEASE:"成绩公布",SYSTEM_MAINTENANCE:"系统维护",OTHER:"其他通知"};return e[t]||"其他通知"},formatClassIds(t){return t?t.split(",").join(", "):"无"},async fetchClassList(){try{const t=await this.$http.get("/api/teacher/classes");200===t.data.code?this.classList=t.data.data.map(t=>({label:t,value:t})):console.error("获取班级列表失败:",t.data.msg)}catch(t){console.error("获取班级列表失败:",t),this.classList=[{label:"计科1班",value:"计科1班"},{label:"计科2班",value:"计科2班"},{label:"软工1班",value:"软工1班"},{label:"软工2班",value:"软工2班"}]}},async fetchNoticeList(){try{this.loading=!0,console.log("开始获取教师通知列表，当前用户ID:",this.currentUserId);const t=await this.$http.get("/api/teacher/notices",{params:{keyword:this.searchKeyword,type:this.searchType,page:this.currentPage-1,size:this.pageSize}});if(console.log("获取到的响应:",t),200===t.data.code){const e=t.data.data;this.noticeList=e.content||[],this.total=e.totalElements||0,console.log("解析后的通知列表:",this.noticeList)}else this.$message.error(t.data.msg||"获取通知列表失败")}catch(t){console.error("获取通知列表失败:",t),this.$message.error("获取通知列表失败")}finally{this.loading=!1}},handleSearch(){this.currentPage=1,this.fetchNoticeList()},handleSizeChange(t){this.pageSize=t,this.fetchNoticeList()},handleCurrentChange(t){this.currentPage=t,this.fetchNoticeList()},handleAdd(){this.dialogTitle="发布通知",this.form={id:null,type:"OTHER",priority:"NORMAL",title:"",content:"",status:1,isGlobal:!0,classIds:"",createTime:null,updateTime:null,creatorId:this.currentUserId},this.selectedClasses=[],this.dialogVisible=!0},handleView(t){this.currentNotice={...t},this.viewDialogVisible=!0},handleEdit(t){this.dialogTitle="编辑通知",this.form={...t},this.selectedClasses=this.form.classIds?this.form.classIds.split(","):[],this.dialogVisible=!0},async handleSubmit(){this.$refs.form.validate(async t=>{if(t)try{if(this.form.isGlobal)this.form.classIds=null;else{if(!(this.selectedClasses&&this.selectedClasses.length>0))return this.$message.error("请选择至少一个班级");this.form.classIds=this.selectedClasses.join(",")}console.log("提交的表单数据:",this.form);const t=this.form.id?"/api/teacher/notices/"+this.form.id:"/api/teacher/notices",e=this.form.id?"put":"post",a=await this.$http[e](t,this.form);200===a.data.code?(this.$message.success(this.form.id?"更新成功":"添加成功"),this.dialogVisible=!1,this.fetchNoticeList()):this.$message.error(a.data.msg||"操作失败")}catch(a){var e;console.error("操作失败:",a),this.$message.error((null===(e=a.response)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.msg)||"操作失败")}})},async handleDelete(t){try{await this.$confirm("确认删除该通知吗？","提示",{type:"warning"});const e=await this.$http.delete("/api/teacher/notices/"+t.id);200===e.data.code&&(this.$message.success("删除成功"),this.fetchNoticeList())}catch(e){"cancel"!==e&&this.$message.error("删除失败")}},async handleStatusChange(t){try{const e=await this.$http.put(`/api/teacher/notices/${t.id}/status`,{status:t.status});200===e.data.code?this.$message.success((1===t.status?"启用":"禁用")+"成功"):(t.status=1===t.status?0:1,this.$message.error(e.data.msg||"操作失败"))}catch(e){t.status=1===t.status?0:1,this.$message.error("操作失败")}}}}),l=i,o=(a("2035"),a("2877")),n=Object(o["a"])(l,s,r,!1,null,"5f896d5e",null);e["default"]=n.exports},"9bdd":function(t,e,a){"use strict";var s=a("825a"),r=a("2a62");t.exports=function(t,e,a,i){try{return i?e(s(a)[0],a[1]):e(a)}catch(l){r(t,"throw",l)}}},ab43:function(t,e,a){"use strict";var s=a("23e7"),r=a("d024"),i=a("c430");s({target:"Iterator",proto:!0,real:!0,forced:i},{map:r})},c5cc:function(t,e,a){"use strict";var s=a("c65b"),r=a("7c73"),i=a("9112"),l=a("6964"),o=a("b622"),n=a("69f3"),c=a("dc4a"),u=a("ae93").IteratorPrototype,d=a("4754"),p=a("2a62"),h=o("toStringTag"),f="IteratorHelper",m="WrapForValidIterator",g=n.set,v=function(t){var e=n.getterFor(t?m:f);return l(r(u),{next:function(){var a=e(this);if(t)return a.nextHandler();if(a.done)return d(void 0,!0);try{var s=a.nextHandler();return a.returnHandlerResult?s:d(s,a.done)}catch(r){throw a.done=!0,r}},return:function(){var a=e(this),r=a.iterator;if(a.done=!0,t){var i=c(r,"return");return i?s(i,r):d(void 0,!0)}if(a.inner)try{p(a.inner.iterator,"normal")}catch(l){return p(r,"throw",l)}return r&&p(r,"normal"),d(void 0,!0)}})},b=v(!0),y=v(!1);i(y,h,"Iterator Helper"),t.exports=function(t,e,a){var s=function(s,r){r?(r.iterator=s.iterator,r.next=s.next):r=s,r.type=e?m:f,r.returnHandlerResult=!!a,r.nextHandler=t,r.counter=0,r.done=!1,g(this,r)};return s.prototype=e?b:y,s}},d024:function(t,e,a){"use strict";var s=a("c65b"),r=a("59ed"),i=a("825a"),l=a("46c4"),o=a("c5cc"),n=a("9bdd"),c=o((function(){var t=this.iterator,e=i(s(this.next,t)),a=this.done=!!e.done;if(!a)return n(t,this.mapper,[e.value,this.counter++],!0)}));t.exports=function(t){return i(this),r(t),new c(l(this),{mapper:t})}}}]);
//# sourceMappingURL=chunk-67d2f004.aaa6c0cd.js.map