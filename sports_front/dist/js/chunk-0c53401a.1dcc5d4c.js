(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0c53401a"],{a245:function(e,t,a){"use strict";a.r(t);var r=function(){var e,t,a,r,s,i,o,l,n,c,d,u,m,v,p,h,b,y,g,f,w,_,R,P=this,D=P._self._c;return D("div",{staticClass:"exemption-review"},[D("div",{staticClass:"filter-section"},[D("el-form",{ref:"queryForm",attrs:{inline:!0,model:P.queryParams}},[D("el-form-item",{attrs:{label:"申请类型"}},[D("el-select",{attrs:{placeholder:"选择申请类型",clearable:""},model:{value:P.queryParams.type,callback:function(e){P.$set(P.queryParams,"type",e)},expression:"queryParams.type"}},[D("el-option",{attrs:{label:"免测申请",value:"EXEMPTION"}}),D("el-option",{attrs:{label:"重测申请",value:"RETEST"}})],1)],1),D("el-form-item",{attrs:{label:"状态"}},[D("el-select",{attrs:{placeholder:"选择状态",clearable:""},model:{value:P.queryParams.status,callback:function(e){P.$set(P.queryParams,"status",e)},expression:"queryParams.status"}},[D("el-option",{attrs:{label:"待审核",value:"PENDING"}}),D("el-option",{attrs:{label:"已通过",value:"APPROVED"}}),D("el-option",{attrs:{label:"已驳回",value:"REJECTED"}})],1)],1),D("el-form-item",{attrs:{label:"班级"}},[D("el-select",{attrs:{placeholder:"选择班级",clearable:""},model:{value:P.queryParams.className,callback:function(e){P.$set(P.queryParams,"className",e)},expression:"queryParams.className"}},P._l(P.classList,(function(e){return D("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),D("el-form-item",{attrs:{label:"关键字"}},[D("el-input",{attrs:{placeholder:"学生姓名/学号",clearable:""},model:{value:P.queryParams.keyword,callback:function(e){P.$set(P.queryParams,"keyword",e)},expression:"queryParams.keyword"}})],1),D("el-form-item",[D("el-button",{attrs:{type:"primary"},on:{click:P.handleQuery}},[P._v("查询")]),D("el-button",{on:{click:P.resetQuery}},[P._v("重置")]),D("el-button",{attrs:{type:"success"},on:{click:P.handleExport}},[P._v("导出")])],1)],1)],1),D("el-table",{directives:[{name:"loading",rawName:"v-loading",value:P.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:P.tableData,border:"",stripe:""}},[D("el-table-column",{attrs:{type:"index",label:"序号",width:"60",align:"center"}}),D("el-table-column",{attrs:{label:"学生姓名",prop:"studentName","min-width":"100",align:"center"}}),D("el-table-column",{attrs:{label:"学号",prop:"studentNumber","min-width":"120",align:"center"}}),D("el-table-column",{attrs:{label:"班级",prop:"className","min-width":"100",align:"center"}}),D("el-table-column",{attrs:{label:"测试项目",prop:"sportsItem.name","min-width":"120",align:"center"}}),D("el-table-column",{attrs:{label:"申请类型","min-width":"100",align:"center"},scopedSlots:P._u([{key:"default",fn:function(e){return[P._v(" "+P._s("EXEMPTION"===e.row.type?"免测":"重测")+" ")]}}])}),D("el-table-column",{attrs:{label:"申请原因",prop:"reason","min-width":"200","show-overflow-tooltip":""}}),D("el-table-column",{attrs:{label:"状态","min-width":"100",align:"center"},scopedSlots:P._u([{key:"default",fn:function(e){return[D("el-tag",{attrs:{type:P.getStatusType(e.row.status)}},[P._v(" "+P._s(P.getStatusText(e.row.status))+" ")])]}}])}),D("el-table-column",{attrs:{label:"操作",align:"center",width:"250"},scopedSlots:P._u([{key:"default",fn:function(e){return[P.canReview(e.row)?D("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return P.handleReview(e.row)}}},[P._v("审核")]):P._e(),P.canModify(e.row)?D("el-button",{attrs:{size:"mini",type:"warning"},on:{click:function(t){return P.handleModify(e.row)}}},[P._v("修改")]):P._e(),D("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(t){return P.handleDetail(e.row)}}},[P._v("查看")])]}}])})],1),D("div",{staticClass:"pagination-container"},[D("el-pagination",{attrs:{"current-page":P.queryParams.pageNum,"page-sizes":[10,20,50,100],"page-size":P.queryParams.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:P.total},on:{"size-change":P.handleSizeChange,"current-change":P.handleCurrentChange}})],1),D("el-dialog",{attrs:{title:"申请审核",visible:P.reviewDialog.visible,width:"500px"},on:{"update:visible":function(e){return P.$set(P.reviewDialog,"visible",e)}}},[D("div",{staticClass:"review-info"},[D("p",[P._v("学生："+P._s(null===(e=P.currentRecord)||void 0===e||null===(e=e.student)||void 0===e?void 0:e.realName)+" ("+P._s(null===(t=P.currentRecord)||void 0===t?void 0:t.studentNumber)+")")]),D("p",[P._v("班级："+P._s(null===(a=P.currentRecord)||void 0===a?void 0:a.className))]),D("p",[P._v("项目："+P._s(null===(r=P.currentRecord)||void 0===r||null===(r=r.sportsItem)||void 0===r?void 0:r.name))]),D("p",[P._v("类型："+P._s("EXEMPTION"===(null===(s=P.currentRecord)||void 0===s?void 0:s.type)?"免测":"重测"))]),D("p",[P._v("原因："+P._s(null===(i=P.currentRecord)||void 0===i?void 0:i.reason))])]),D("el-form",{ref:"reviewForm",attrs:{model:P.reviewForm,rules:P.reviewRules,"label-width":"80px"}},[D("el-form-item",{attrs:{label:"审核结果",prop:"status"}},[D("el-radio-group",{model:{value:P.reviewForm.status,callback:function(e){P.$set(P.reviewForm,"status",e)},expression:"reviewForm.status"}},[D("el-radio",{attrs:{label:"APPROVED"}},[P._v("通过")]),D("el-radio",{attrs:{label:"REJECTED"}},[P._v("驳回")])],1)],1),D("el-form-item",{attrs:{label:"审核意见",prop:"comment"}},[D("el-input",{attrs:{type:"textarea",rows:3,placeholder:"请输入审核意见"},model:{value:P.reviewForm.comment,callback:function(e){P.$set(P.reviewForm,"comment",e)},expression:"reviewForm.comment"}})],1)],1),D("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[D("el-button",{on:{click:function(e){P.reviewDialog.visible=!1}}},[P._v("取 消")]),D("el-button",{attrs:{type:"primary"},on:{click:P.submitReview}},[P._v("确 定")])],1)],1),D("el-dialog",{attrs:{title:"申请详情",visible:P.detailDialog.visible,width:"500px"},on:{"update:visible":function(e){return P.$set(P.detailDialog,"visible",e)}}},[D("el-descriptions",{attrs:{column:1,border:""}},[D("el-descriptions-item",{attrs:{label:"学生姓名"}},[P._v(P._s(null===(o=P.currentRecord)||void 0===o||null===(o=o.student)||void 0===o?void 0:o.realName))]),D("el-descriptions-item",{attrs:{label:"学号"}},[P._v(P._s(null===(l=P.currentRecord)||void 0===l?void 0:l.studentNumber))]),D("el-descriptions-item",{attrs:{label:"班级"}},[P._v(P._s(null===(n=P.currentRecord)||void 0===n?void 0:n.className))]),D("el-descriptions-item",{attrs:{label:"测试项目"}},[P._v(P._s(null===(c=P.currentRecord)||void 0===c||null===(c=c.sportsItem)||void 0===c?void 0:c.name))]),D("el-descriptions-item",{attrs:{label:"申请类型"}},[P._v(P._s("EXEMPTION"===(null===(d=P.currentRecord)||void 0===d?void 0:d.type)?"免测":"重测"))]),D("el-descriptions-item",{attrs:{label:"申请原因"}},[P._v(P._s(null===(u=P.currentRecord)||void 0===u?void 0:u.reason))]),D("el-descriptions-item",{attrs:{label:"审核结果"}},[D("el-tag",{attrs:{type:P.getStatusType(null===(m=P.currentRecord)||void 0===m?void 0:m.status)}},[P._v(" "+P._s(P.getStatusText(null===(v=P.currentRecord)||void 0===v?void 0:v.status))+" ")])],1),D("el-descriptions-item",{attrs:{label:"审核意见"}},[P._v(P._s(null===(p=P.currentRecord)||void 0===p?void 0:p.reviewComment))]),D("el-descriptions-item",{attrs:{label:"审核时间"}},[P._v(P._s(P.formatDateTime(null===(h=P.currentRecord)||void 0===h?void 0:h.reviewTime)))])],1),D("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[D("el-button",{on:{click:function(e){P.detailDialog.visible=!1}}},[P._v("关 闭")])],1)],1),D("el-dialog",{attrs:{title:"修改审核",visible:P.modifyDialog.visible,width:"500px"},on:{"update:visible":function(e){return P.$set(P.modifyDialog,"visible",e)}}},[D("div",{staticClass:"review-info"},[D("p",[P._v("学生："+P._s(null===(b=P.currentRecord)||void 0===b?void 0:b.studentName)+" ("+P._s(null===(y=P.currentRecord)||void 0===y?void 0:y.studentNumber)+")")]),D("p",[P._v("班级："+P._s(null===(g=P.currentRecord)||void 0===g?void 0:g.className))]),D("p",[P._v("申请类型："+P._s("EXEMPTION"===(null===(f=P.currentRecord)||void 0===f?void 0:f.type)?"免测申请":"重测申请"))]),D("p",[P._v("申请原因："+P._s(null===(w=P.currentRecord)||void 0===w?void 0:w.reason))]),D("p",[P._v("原审核意见："+P._s(null===(_=P.currentRecord)||void 0===_?void 0:_.teacherReviewComment))]),D("p",[P._v("原审核时间："+P._s(P.formatDateTime(null===(R=P.currentRecord)||void 0===R?void 0:R.teacherReviewTime)))])]),D("el-form",{ref:"modifyForm",attrs:{model:P.modifyForm,rules:P.reviewRules,"label-width":"100px"}},[D("el-form-item",{attrs:{label:"审核结果",prop:"status"}},[D("el-radio-group",{model:{value:P.modifyForm.status,callback:function(e){P.$set(P.modifyForm,"status",e)},expression:"modifyForm.status"}},[D("el-radio",{attrs:{label:"PENDING"}},[P._v("待审核")]),D("el-radio",{attrs:{label:"APPROVED"}},[P._v("通过")]),D("el-radio",{attrs:{label:"REJECTED"}},[P._v("驳回")])],1)],1),D("el-form-item",{attrs:{label:"审核意见",prop:"comment"}},[D("el-input",{attrs:{type:"textarea",rows:3,placeholder:"请输入新的审核意见"},model:{value:P.modifyForm.comment,callback:function(e){P.$set(P.modifyForm,"comment",e)},expression:"modifyForm.comment"}})],1)],1),D("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[D("el-button",{on:{click:function(e){P.modifyDialog.visible=!1}}},[P._v("取 消")]),D("el-button",{attrs:{type:"primary"},on:{click:P.submitModify}},[P._v("确 定")])],1)],1)],1)},s=[],i=(a("88a7"),a("271a"),a("5494"),{name:"ExemptionReview",data(){return{loading:!1,tableData:[],total:0,queryParams:{type:"",status:"",className:"",keyword:"",pageNum:1,pageSize:10},classList:[],reviewDialog:{visible:!1},detailDialog:{visible:!1},currentRecord:null,reviewForm:{status:"",comment:""},reviewRules:{status:[{required:!0,message:"请选择审核结果",trigger:"change"}],comment:[{required:!0,message:"请输入审核意见",trigger:"blur"}]},modifyDialog:{visible:!1},modifyForm:{id:null,status:"",comment:""}}},created(){this.init()},methods:{async init(){await Promise.all([this.getClassList(),this.getList()])},async getList(){try{this.loading=!0;const e=await this.$http.get("/api/teacher/exemptions",{params:this.queryParams});200===e.data.code&&(this.tableData=e.data.data.content,this.total=e.data.data.totalElements)}catch(e){console.error("获取列表失败:",e),this.$message.error("获取列表失败")}finally{this.loading=!1}},async getClassList(){try{const e=await this.$http.get("/api/teacher/classes");200===e.data.code&&(this.classList=e.data.data||[])}catch(e){console.error("获取班级列表失败:",e),this.$message.error("获取班级列表失败")}},handleQuery(){this.queryParams.pageNum=1,this.getList()},resetQuery(){this.$refs.queryForm.resetFields(),this.queryParams={pageNum:1,pageSize:10,type:"",status:"",className:"",keyword:""},this.getList()},handleReview(e){this.currentRecord=e,this.reviewForm={status:"",comment:""},this.reviewDialog.visible=!0},handleDetail(e){this.currentRecord=e,this.detailDialog.visible=!0},async submitReview(){this.$refs.reviewForm.validate(async e=>{if(e)try{const e=await this.$http.put(`/api/teacher/exemptions/${this.currentRecord.id}/review`,{status:this.reviewForm.status,comment:this.reviewForm.comment});200===e.data.code?(this.$message.success("审核成功"),this.reviewDialog.visible=!1,this.getList()):this.$message.error(e.data.message||"审核失败")}catch(t){console.error("审核失败:",t),this.$message.error("审核失败")}})},handleSizeChange(e){this.queryParams.pageSize=e,this.getList()},handleCurrentChange(e){this.queryParams.pageNum=e,this.getList()},getStatusType(e){const t={PENDING:"warning",APPROVED:"success",REJECTED:"danger"};return t[e]||"info"},getStatusText(e){const t={PENDING:"待审核",APPROVED:"已通过",REJECTED:"已驳回"};return t[e]||"未知"},formatDateTime(e){if(!e)return"-";const t=new Date(e);return t.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})},canReview(e){return"PENDING"===e.status},canModify(e){return"PENDING"!==e.status},handleModify(e){this.currentRecord=e,this.modifyForm={id:e.id,status:e.status||"",comment:e.teacherReviewComment||""},this.modifyDialog.visible=!0},async submitModify(){this.$refs.modifyForm.validate(async e=>{if(e)try{const e=await this.$http.put(`/api/teacher/exemptions/${this.currentRecord.id}/modify`,{status:this.modifyForm.status,teacherReviewComment:this.modifyForm.comment});200===e.data.code?(this.$message.success("修改成功"),this.modifyDialog.visible=!1,this.getList()):this.$message.error(e.data.message||"修改失败")}catch(t){console.error("修改失败:",t),this.$message.error("修改失败")}})},async handleExport(){try{this.$message.info("正在导出数据，请稍候...");const e=await this.$http.get("/api/teacher/exemptions/export",{params:{type:this.queryParams.type,status:this.queryParams.status,className:this.queryParams.className,keyword:this.queryParams.keyword},responseType:"blob"}),t=new Blob([e.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),a=document.createElement("a");a.href=window.URL.createObjectURL(t);const r=new Date,s=`免测重测申请记录_${r.getFullYear()}${(r.getMonth()+1).toString().padStart(2,"0")}${r.getDate().toString().padStart(2,"0")}.xlsx`;a.setAttribute("download",s),document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(a.href),this.$message.success("导出成功")}catch(e){console.error("导出失败:",e),this.$message.error("导出失败")}}}}),o=i,l=(a("aa7b"),a("2877")),n=Object(l["a"])(o,r,s,!1,null,"041c2c91",null);t["default"]=n.exports},aa7b:function(e,t,a){"use strict";a("c40f")},c40f:function(e,t,a){}}]);
//# sourceMappingURL=chunk-0c53401a.1dcc5d4c.js.map