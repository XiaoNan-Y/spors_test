(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a45ab8d4"],{"0179":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"test-records-container"},[t("el-card",[t("div",{staticClass:"card-header",attrs:{slot:"header"},slot:"header"},[t("span",[e._v("体测成绩记录")]),t("el-select",{attrs:{placeholder:"选择学期",size:"small"},on:{change:e.fetchRecords},model:{value:e.selectedSemester,callback:function(t){e.selectedSemester=t},expression:"selectedSemester"}},e._l(e.semesters,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.testRecords}},[t("el-table-column",{attrs:{prop:"itemName",label:"测试项目"}}),t("el-table-column",{attrs:{prop:"testDate",label:"测试日期",width:"180"}}),t("el-table-column",{attrs:{prop:"score",label:"成绩",width:"100"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("span",{class:{"score-pass":s.row.isPassed,"score-fail":!s.row.isPassed}},[e._v(" "+e._s(s.row.score)+" ")])]}}])}),t("el-table-column",{attrs:{prop:"standard",label:"达标要求",width:"150"}}),t("el-table-column",{attrs:{prop:"status",label:"状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-tag",{attrs:{type:s.row.isPassed?"success":"danger"}},[e._v(" "+e._s(s.row.isPassed?"达标":"未达标")+" ")])]}}])}),t("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.viewDetail(s.row)}}},[e._v("查看详情")]),s.row.hasAppeal?e._e():t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.submitAppeal(s.row)}}},[e._v(" 成绩申诉 ")])]}}])})],1)],1),t("el-dialog",{attrs:{title:"成绩详情",visible:e.detailDialogVisible,width:"40%"},on:{"update:visible":function(t){e.detailDialogVisible=t}}},[e.currentRecord?t("div",{staticClass:"detail-content"},[t("div",{staticClass:"detail-item"},[t("span",{staticClass:"label"},[e._v("测试项目：")]),t("span",[e._v(e._s(e.currentRecord.itemName))])]),t("div",{staticClass:"detail-item"},[t("span",{staticClass:"label"},[e._v("测试时间：")]),t("span",[e._v(e._s(e.currentRecord.testDate))])]),t("div",{staticClass:"detail-item"},[t("span",{staticClass:"label"},[e._v("测试地点：")]),t("span",[e._v(e._s(e.currentRecord.location))])]),t("div",{staticClass:"detail-item"},[t("span",{staticClass:"label"},[e._v("测试成绩：")]),t("span",{class:{"score-pass":e.currentRecord.isPassed,"score-fail":!e.currentRecord.isPassed}},[e._v(" "+e._s(e.currentRecord.score)+" ")])]),t("div",{staticClass:"detail-item"},[t("span",{staticClass:"label"},[e._v("评分标准：")]),t("span",[e._v(e._s(e.currentRecord.standard))])]),t("div",{staticClass:"detail-item"},[t("span",{staticClass:"label"},[e._v("评分说明：")]),t("p",[e._v(e._s(e.currentRecord.scoreDescription))])])]):e._e()]),t("el-dialog",{attrs:{title:"成绩申诉",visible:e.appealDialogVisible,width:"50%"},on:{"update:visible":function(t){e.appealDialogVisible=t}}},[t("el-form",{ref:"appealForm",attrs:{model:e.appealForm,rules:e.appealRules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"申诉理由",prop:"reason"}},[t("el-input",{attrs:{type:"textarea",rows:4,placeholder:"请详细说明申诉理由"},model:{value:e.appealForm.reason,callback:function(t){e.$set(e.appealForm,"reason",t)},expression:"appealForm.reason"}})],1),t("el-form-item",{attrs:{label:"证据材料",prop:"evidence"}},[t("el-upload",{staticClass:"upload-demo",attrs:{action:"/api/upload","on-success":e.handleUploadSuccess,"on-error":e.handleUploadError,"file-list":e.appealForm.evidenceFiles}},[t("el-button",{attrs:{size:"small",type:"primary"}},[e._v("上传文件")]),t("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("可上传图片、视频等证据材料")])],1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.appealDialogVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submitAppealForm}},[e._v("提交申诉")])],1)],1)],1)},l=[],r=(s("e9f5"),s("ab43"),{name:"TestRecords",data(){return{selectedSemester:"",semesters:[],testRecords:[],detailDialogVisible:!1,appealDialogVisible:!1,currentRecord:null,appealForm:{reason:"",evidenceFiles:[]},appealRules:{reason:[{required:!0,message:"请输入申诉理由",trigger:"blur"},{min:10,message:"申诉理由不能少于10个字",trigger:"blur"}]}}},created(){this.fetchSemesters(),this.fetchRecords()},methods:{async fetchSemesters(){try{const e=await this.$http.get("/api/student/semesters");this.semesters=e.data,this.semesters.length>0&&(this.selectedSemester=this.semesters[0].value)}catch(e){this.$message.error("获取学期信息失败")}},async fetchRecords(){try{const e=await this.$http.get("/api/student/test-records",{params:{semester:this.selectedSemester}});this.testRecords=e.data}catch(e){this.$message.error("获取成绩记录失败")}},viewDetail(e){this.currentRecord=e,this.detailDialogVisible=!0},submitAppeal(e){this.currentRecord=e,this.appealDialogVisible=!0,this.appealForm={reason:"",evidenceFiles:[]}},handleUploadSuccess(e,t,s){this.appealForm.evidenceFiles=s,this.$message.success("文件上传成功")},handleUploadError(){this.$message.error("文件上传失败")},async submitAppealForm(){try{await this.$refs.appealForm.validate(),await this.$http.post(`/api/student/test-records/${this.currentRecord.id}/appeal`,{reason:this.appealForm.reason,evidenceFiles:this.appealForm.evidenceFiles.map(e=>e.response.fileUrl)}),this.$message.success("申诉提交成功"),this.appealDialogVisible=!1,this.fetchRecords()}catch(e){e.message&&this.$message.error(e.message)}}}}),i=r,o=(s("0a4e"),s("2877")),c=Object(o["a"])(i,a,l,!1,null,"0b445f98",null);t["default"]=c.exports},"0a4e":function(e,t,s){"use strict";s("e007")},e007:function(e,t,s){}}]);
//# sourceMappingURL=chunk-a45ab8d4.9a0c14fb.js.map