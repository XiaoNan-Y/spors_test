(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-58f0b7c2"],{"1bd6":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"student-records"},[t("div",{staticClass:"filter-section"},[t("el-form",{ref:"queryForm",attrs:{inline:!0,model:e.queryParams}},[t("el-form-item",{attrs:{label:"班级"}},[t("el-select",{attrs:{placeholder:"选择班级",clearable:""},model:{value:e.queryParams.className,callback:function(t){e.$set(e.queryParams,"className",t)},expression:"queryParams.className"}},e._l(e.classNames,(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),t("el-form-item",{attrs:{label:"测试项目"}},[t("el-select",{attrs:{placeholder:"选择测试项目",clearable:""},model:{value:e.queryParams.sportsItemId,callback:function(t){e.$set(e.queryParams,"sportsItemId",t)},expression:"queryParams.sportsItemId"}},e._l(e.sportsItems,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"状态"}},[t("el-select",{attrs:{placeholder:"选择状态",clearable:""},model:{value:e.queryParams.status,callback:function(t){e.$set(e.queryParams,"status",t)},expression:"queryParams.status"}},[t("el-option",{attrs:{label:"待审核",value:"PENDING"}}),t("el-option",{attrs:{label:"已通过",value:"APPROVED"}}),t("el-option",{attrs:{label:"已驳回",value:"REJECTED"}})],1)],1),t("el-form-item",{attrs:{label:"学号"}},[t("el-input",{attrs:{placeholder:"请输入学号",clearable:""},model:{value:e.queryParams.studentNumber,callback:function(t){e.$set(e.queryParams,"studentNumber",t)},expression:"queryParams.studentNumber"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.handleQuery}},[e._v("查询")]),t("el-button",{on:{click:e.resetQuery}},[e._v("重置")])],1)],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,border:""}},[t("el-table-column",{attrs:{type:"index",label:"序号",width:"60"}}),t("el-table-column",{attrs:{prop:"studentInfo.realName",label:"学生姓名"}}),t("el-table-column",{attrs:{prop:"studentInfo.studentNumber",label:"学号"}}),t("el-table-column",{attrs:{prop:"studentInfo.className",label:"班级"}}),t("el-table-column",{attrs:{prop:"sportsItem.name",label:"测试项目"}}),t("el-table-column",{attrs:{prop:"score",label:"成绩"}}),t("el-table-column",{attrs:{label:"操作",width:"180",align:"center"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{attrs:{size:"mini",type:"primary",disabled:!e.canEdit(s.row)},on:{click:function(t){return e.handleEdit(s.row)}}},[e._v(" 修改 ")]),t("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(t){return e.handleDetail(s.row)}}},[e._v(" 详情 ")])]}}])})],1),t("div",{staticClass:"pagination-container"},[t("el-pagination",{attrs:{"current-page":e.queryParams.pageNum,"page-sizes":[10,20,50,100],"page-size":e.queryParams.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),t("el-dialog",{attrs:{title:"修改成绩",visible:e.editDialog.visible,width:"500px"},on:{"update:visible":function(t){return e.$set(e.editDialog,"visible",t)},closed:e.handleEditDialogClosed}},[t("el-form",{ref:"editForm",attrs:{model:e.editForm,rules:e.editRules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"学生姓名"}},[t("span",[e._v(e._s(e.editForm.studentName))])]),t("el-form-item",{attrs:{label:"测试项目"}},[t("span",[e._v(e._s(e.editForm.sportsItemName))])]),t("el-form-item",{attrs:{label:"成绩",prop:"score"}},[t("el-input",{attrs:{type:"number"},model:{value:e.editForm.score,callback:function(t){e.$set(e.editForm,"score",e._n(t))},expression:"editForm.score"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.editDialog.visible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submitEdit}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"成绩详情",visible:e.detailDialog.visible,width:"500px"},on:{"update:visible":function(t){return e.$set(e.detailDialog,"visible",t)}}},[t("el-descriptions",{attrs:{column:1,border:""}},[t("el-descriptions-item",{attrs:{label:"学生姓名"}},[e._v(e._s(e.detailForm.studentName))]),t("el-descriptions-item",{attrs:{label:"学号"}},[e._v(e._s(e.detailForm.studentNumber))]),t("el-descriptions-item",{attrs:{label:"班级"}},[e._v(e._s(e.detailForm.className))]),t("el-descriptions-item",{attrs:{label:"测试项目"}},[e._v(e._s(e.detailForm.sportsItemName))]),t("el-descriptions-item",{attrs:{label:"成绩"}},[e._v(e._s(e.detailForm.score))]),t("el-descriptions-item",{attrs:{label:"状态"}},[t("el-tag",{attrs:{type:e.getStatusType(e.detailForm.status)}},[e._v(" "+e._s(e.getStatusText(e.detailForm.status))+" ")])],1),t("el-descriptions-item",{attrs:{label:"创建时间"}},[e._v(e._s(e.detailForm.createdAt))]),t("el-descriptions-item",{attrs:{label:"更新时间"}},[e._v(e._s(e.detailForm.updatedAt))])],1)],1)],1)},r=[],l={name:"StudentRecords",data(){return{loading:!1,queryParams:{pageNum:1,pageSize:10,className:"",sportsItemId:void 0,status:"",studentNumber:""},classNames:[],sportsItems:[],tableData:[],total:0,editDialog:{visible:!1},editForm:{id:null,studentName:"",sportsItemName:"",score:null},editRules:{score:[{required:!0,message:"请输入成绩",trigger:"blur"},{type:"number",message:"成绩必须为数字",trigger:"blur"}]},detailDialog:{visible:!1},detailForm:{studentName:"",studentNumber:"",className:"",sportsItemName:"",score:null,status:"",createdAt:"",updatedAt:""}}},created(){this.init()},methods:{async init(){await Promise.all([this.getClassNames(),this.getSportsItems(),this.getList()])},async getList(){try{this.loading=!0;const e=await this.$axios.get("/api/teacher/student-records",{params:{page:this.queryParams.pageNum-1,size:this.queryParams.pageSize,className:this.queryParams.className,sportsItemId:this.queryParams.sportsItemId,status:this.queryParams.status,keyword:this.queryParams.studentNumber}});200===e.data.code&&(this.tableData=e.data.data.content,this.total=e.data.data.totalElements)}catch(e){console.error("获取列表失败:",e),this.$message.error("获取列表失败: "+e.message)}finally{this.loading=!1}},async getClassNames(){try{const e=await this.$axios.get("/api/teacher/classes");200===e.data.code&&(this.classNames=e.data.data)}catch(e){console.error("获取班级列表失败:",e)}},async getSportsItems(){try{const e=await this.$axios.get("/api/teacher/sports-items");200===e.data.code&&(this.sportsItems=e.data.data)}catch(e){console.error("获取体测项目列表失败:",e)}},handleQuery(){this.queryParams.pageNum=1,this.getList()},resetQuery(){this.$refs.queryForm.resetFields(),this.queryParams={pageNum:1,pageSize:10,className:"",sportsItemId:void 0,status:"",studentNumber:""},this.getList()},handleSizeChange(e){this.queryParams.pageSize=e,this.getList()},handleCurrentChange(e){this.queryParams.pageNum=e,this.getList()},getStatusType(e){const t={PENDING:"warning",APPROVED:"success",REJECTED:"danger"};return t[e]||"info"},getStatusText(e){const t={PENDING:"待审核",APPROVED:"已通过",REJECTED:"已驳回"};return t[e]||e},canEdit(e){return"PENDING"===e.status||"REJECTED"===e.status},handleEdit(e){this.editForm={id:e.id,studentName:e.studentInfo.realName,sportsItemName:e.sportsItem.name,score:e.score},this.editDialog.visible=!0},handleDetail(e){this.detailForm={studentName:e.studentInfo.realName,studentNumber:e.studentInfo.studentNumber,className:e.studentInfo.className,sportsItemName:e.sportsItem.name,score:e.score,status:e.status,createdAt:e.createdAt,updatedAt:e.updatedAt},this.detailDialog.visible=!0},submitEdit(){this.$refs.editForm.validate(async e=>{if(e)try{console.log("开始提交修改请求，表单数据：",this.editForm);const e=parseFloat(this.editForm.score);if(isNaN(e))return void this.$message.error("请输入有效的成绩");console.log("发送请求前的数据：",{id:this.editForm.id,score:e});const t=await this.$axios.put("/api/teacher/test-records/"+this.editForm.id,{score:e},{headers:{"Content-Type":"application/json"}});console.log("服务器响应：",t),200===t.data.code?(this.$message.success("修改成功"),this.editDialog.visible=!1,this.getList()):this.$message.error(t.data.message||"修改失败")}catch(t){console.error("修改失败，详细错误信息：",{error:t,response:t.response,message:t.message,stack:t.stack});let e="修改失败";t.response&&(console.log("服务器响应状态：",t.response.status),console.log("服务器响应数据：",t.response.data),e=t.response.data.message||e),this.$message.error(e)}else console.log("表单验证失败"),this.$message.warning("请正确填写表单")})},handleEditDialogClosed(){var e;null===(e=this.$refs.editForm)||void 0===e||e.resetFields(),this.editForm={id:null,studentName:"",sportsItemName:"",score:null}}}},i=l,o=(s("2243"),s("2877")),n=Object(o["a"])(i,a,r,!1,null,"2d8d0579",null);t["default"]=n.exports},2243:function(e,t,s){"use strict";s("9331")},9331:function(e,t,s){}}]);
//# sourceMappingURL=chunk-58f0b7c2.8e236fcc.js.map