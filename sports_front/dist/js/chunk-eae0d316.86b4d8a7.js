(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-eae0d316"],{"2b76":function(e,t,r){"use strict";r.r(t);var a=function(){var e,t,r,a,i,s,o,l,n,c,d,u,m,v,p,h=this,w=h._self._c;return w("div",{staticClass:"exemption-review"},[h._m(0),w("div",{staticClass:"filters"},[w("el-form",{staticClass:"filter-form",attrs:{inline:!0}},[w("el-form-item",{attrs:{label:"状态"}},[w("el-select",{attrs:{placeholder:"选择状态",clearable:""},model:{value:h.filters.status,callback:function(e){h.$set(h.filters,"status",e)},expression:"filters.status"}},[w("el-option",{attrs:{label:"全部",value:""}}),w("el-option",{attrs:{label:"待审核",value:"PENDING"}}),w("el-option",{attrs:{label:"已通过",value:"APPROVED"}}),w("el-option",{attrs:{label:"已驳回",value:"REJECTED"}})],1)],1),w("el-form-item",{attrs:{label:"关键字"}},[w("el-input",{attrs:{placeholder:"学号/姓名",clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&h._k(e.keyCode,"enter",13,e.key,"Enter")?null:h.handleSearch.apply(null,arguments)}},model:{value:h.filters.keyword,callback:function(e){h.$set(h.filters,"keyword",e)},expression:"filters.keyword"}})],1),w("el-form-item",[w("el-button",{attrs:{type:"primary"},on:{click:h.handleSearch}},[h._v("查询")]),w("el-button",{on:{click:h.resetFilters}},[h._v("重置")]),w("el-button",{attrs:{type:"success"},on:{click:h.handleExport}},[h._v("导出数据")])],1)],1)],1),w("el-table",{directives:[{name:"loading",rawName:"v-loading",value:h.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:h.records,border:""}},[w("el-table-column",{attrs:{label:"序号",type:"index",width:"50",align:"center"}}),w("el-table-column",{attrs:{prop:"studentNumber",label:"学号",width:"120"}}),w("el-table-column",{attrs:{prop:"studentName",label:"姓名",width:"120"}}),w("el-table-column",{attrs:{prop:"className",label:"班级",width:"120"}}),w("el-table-column",{attrs:{prop:"reason",label:"申请原因","show-overflow-tooltip":""}}),w("el-table-column",{attrs:{label:"证明材料",width:"120"},scopedSlots:h._u([{key:"default",fn:function(e){return[e.row.attachmentUrl?w("el-button",{attrs:{type:"text"},on:{click:function(t){return h.previewAttachment(e.row.attachmentUrl)}}},[h._v(" 查看附件 ")]):w("span",[h._v("无")])]}}])}),w("el-table-column",{attrs:{prop:"status",label:"状态",width:"120"},scopedSlots:h._u([{key:"default",fn:function(e){return[w("el-tag",{attrs:{type:h.getStatusType(e.row.status)}},[h._v(" "+h._s(h.getStatusText(e.row.status))+" ")])]}}])}),w("el-table-column",{attrs:{prop:"adminReviewComment",label:"审核意见","show-overflow-tooltip":""}}),w("el-table-column",{attrs:{prop:"applyTime",label:"申请时间",width:"180"},scopedSlots:h._u([{key:"default",fn:function(e){return[h._v(" "+h._s(h.formatDateTime(e.row.applyTime))+" ")]}}])}),w("el-table-column",{attrs:{label:"操作",width:"120",fixed:"right"},scopedSlots:h._u([{key:"default",fn:function(e){return["PENDING"===e.row.status?w("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return h.handleReview(e.row)}}},[h._v("审核")]):w("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(t){return h.handleDetail(e.row)}}},[h._v("查看")])]}}])})],1),w("div",{staticClass:"pagination-container"},[w("el-pagination",{attrs:{"current-page":h.currentPage,"page-sizes":[10,20,50,100],"page-size":h.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:h.total},on:{"size-change":h.handleSizeChange,"current-change":h.handleCurrentChange,"update:currentPage":function(e){h.currentPage=e},"update:current-page":function(e){h.currentPage=e}}})],1),w("el-dialog",{attrs:{title:"审核申请",visible:h.reviewDialog.visible,width:"500px"},on:{"update:visible":function(e){return h.$set(h.reviewDialog,"visible",e)}}},[w("div",{staticClass:"review-info"},[w("p",[w("strong",[h._v("学生信息：")]),h._v(h._s(null===(e=h.currentRecord)||void 0===e?void 0:e.studentName)+" ("+h._s(null===(t=h.currentRecord)||void 0===t?void 0:t.studentNumber)+")")]),w("p",[w("strong",[h._v("班级：")]),h._v(h._s(null===(r=h.currentRecord)||void 0===r?void 0:r.className))]),w("p",[w("strong",[h._v("申请原因：")]),h._v(h._s(null===(a=h.currentRecord)||void 0===a?void 0:a.reason))]),null!==(i=h.currentRecord)&&void 0!==i&&i.attachmentUrl?w("p",[w("strong",[h._v("证明材料：")]),w("el-button",{attrs:{type:"text"},on:{click:function(e){return h.previewAttachment(h.currentRecord.attachmentUrl)}}},[h._v(" 查看附件 ")])],1):h._e()]),w("el-form",{ref:"reviewForm",attrs:{model:h.reviewForm,"label-width":"100px"}},[w("el-form-item",{attrs:{label:"审核结果",prop:"status"}},[w("el-radio-group",{model:{value:h.reviewForm.status,callback:function(e){h.$set(h.reviewForm,"status",e)},expression:"reviewForm.status"}},[w("el-radio",{attrs:{label:"APPROVED"}},[h._v("通过")]),w("el-radio",{attrs:{label:"REJECTED"}},[h._v("驳回")])],1)],1),w("el-form-item",{attrs:{label:"审核意见",prop:"adminReviewComment"}},[w("el-input",{attrs:{type:"textarea",rows:4,placeholder:"请输入审核意见"},model:{value:h.reviewForm.adminReviewComment,callback:function(e){h.$set(h.reviewForm,"adminReviewComment",e)},expression:"reviewForm.adminReviewComment"}})],1)],1),w("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[w("el-button",{on:{click:function(e){h.reviewDialog.visible=!1}}},[h._v("取消")]),w("el-button",{attrs:{type:"primary"},on:{click:h.submitReview}},[h._v("确定")])],1)],1),w("el-dialog",{attrs:{title:"申请详情",visible:h.detailDialog.visible,width:"500px"},on:{"update:visible":function(e){return h.$set(h.detailDialog,"visible",e)}}},[w("div",{staticClass:"detail-info"},[w("el-descriptions",{attrs:{column:1,border:""}},[w("el-descriptions-item",{attrs:{label:"学生姓名"}},[h._v(h._s(null===(s=h.currentRecord)||void 0===s?void 0:s.studentName))]),w("el-descriptions-item",{attrs:{label:"学号"}},[h._v(h._s(null===(o=h.currentRecord)||void 0===o?void 0:o.studentNumber))]),w("el-descriptions-item",{attrs:{label:"班级"}},[h._v(h._s(null===(l=h.currentRecord)||void 0===l?void 0:l.className))]),w("el-descriptions-item",{attrs:{label:"申请原因"}},[h._v(h._s(null===(n=h.currentRecord)||void 0===n?void 0:n.reason))]),w("el-descriptions-item",{attrs:{label:"证明材料"}},[null!==(c=h.currentRecord)&&void 0!==c&&c.attachmentUrl?w("el-button",{attrs:{type:"text"},on:{click:function(e){return h.previewAttachment(h.currentRecord.attachmentUrl)}}},[h._v(" 查看附件 ")]):w("span",[h._v("无")])],1),w("el-descriptions-item",{attrs:{label:"申请时间"}},[h._v(h._s(h.formatDateTime(null===(d=h.currentRecord)||void 0===d?void 0:d.applyTime)))]),w("el-descriptions-item",{attrs:{label:"状态"}},[w("el-tag",{attrs:{type:h.getStatusType(null===(u=h.currentRecord)||void 0===u?void 0:u.status)}},[h._v(" "+h._s(h.getStatusText(null===(m=h.currentRecord)||void 0===m?void 0:m.status))+" ")])],1),w("el-descriptions-item",{attrs:{label:"审核意见"}},[h._v(h._s((null===(v=h.currentRecord)||void 0===v?void 0:v.adminReviewComment)||"-"))]),w("el-descriptions-item",{attrs:{label:"审核时间"}},[h._v(h._s(h.formatDateTime(null===(p=h.currentRecord)||void 0===p?void 0:p.adminReviewTime)||"-"))])],1)],1),w("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[w("el-button",{on:{click:function(e){h.detailDialog.visible=!1}}},[h._v("关闭")])],1)])],1)},i=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"header"},[t("h2",[e._v("免测申请审核")])])}],s=(r("d9e2"),r("88a7"),r("271a"),r("5494"),{name:"ExemptionReview",data(){return{loading:!1,records:[],total:0,currentPage:1,pageSize:10,filters:{status:"",keyword:""},reviewDialog:{visible:!1},detailDialog:{visible:!1},reviewForm:{status:"",adminReviewComment:""},currentRecord:null}},created(){this.fetchRecords()},methods:{async fetchRecords(){try{this.loading=!0;const e=await this.$http.get("/api/exemptions/admin/list",{params:{status:this.filters.status||"",keyword:this.filters.keyword||"",page:this.currentPage-1,size:this.pageSize}});console.log("API Response:",e.data),200===e.data.code?(this.records=e.data.data.content,this.total=e.data.data.totalElements,console.log("Loaded records:",this.records)):this.$message.error(e.data.message||"获取数据失败")}catch(e){console.error("获取记录失败:",e),this.$message.error("获取记录失败: "+e.message)}finally{this.loading=!1}},handleSearch(){this.currentPage=1,this.fetchRecords()},resetFilters(){this.filters={status:"",keyword:""},this.handleSearch()},getStatusType(e){const t={PENDING:"warning",APPROVED:"success",REJECTED:"danger"};return t[e]||"info"},getStatusText(e){const t={PENDING:"待审核",APPROVED:"已通过",REJECTED:"已驳回"};return t[e]||e},formatDateTime(e){return e?new Date(e).toLocaleString():"-"},handleSizeChange(e){this.pageSize=e,this.fetchRecords()},handleCurrentChange(e){this.currentPage=e,this.fetchRecords()},handleReview(e){this.currentRecord=e,this.reviewForm={status:"",adminReviewComment:""},this.reviewDialog.visible=!0},handleDetail(e){this.currentRecord=e,this.detailDialog.visible=!0},async submitReview(){if(this.reviewForm.status)try{const e=await this.$axios.post("/api/exemptions/admin/review/"+this.currentRecord.id,{status:this.reviewForm.status,comment:this.reviewForm.adminReviewComment,reviewerId:localStorage.getItem("userId")});200===e.data.code?(this.$message.success("审核成功"),this.reviewDialog.visible=!1,this.fetchRecords()):this.$message.error(e.data.message||"审核失败")}catch(e){console.error("审核失败:",e),this.$message.error("审核失败: "+e.message)}else this.$message.warning("请选择审核结果")},previewAttachment(e){e&&window.open(e,"_blank")},async handleExport(){try{const e=await fetch("/api/exemptions/admin/export",{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});if(!e.ok)throw new Error("导出失败");const t=e.headers.get("content-disposition");let r="免测申请数据.xlsx";if(t){const e=t.match(/filename="(.+)"/);e&&(r=decodeURIComponent(e[1]))}const a=await e.blob(),i=window.URL.createObjectURL(a),s=document.createElement("a");s.href=i,s.download=r,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(i),this.$message.success("导出成功")}catch(e){console.error("导出失败:",e),this.$message.error("导出失败: "+e.message)}}}}),o=s,l=(r("9620"),r("2877")),n=Object(l["a"])(o,a,i,!1,null,"9cc3338e",null);t["default"]=n.exports},9620:function(e,t,r){"use strict";r("c08a")},c08a:function(e,t,r){}}]);
//# sourceMappingURL=chunk-eae0d316.86b4d8a7.js.map