(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f091e6b2"],{"0144":function(e,t,a){},"074a":function(e,t,a){"use strict";a("0144")},"2b76":function(e,t,a){"use strict";a.r(t);var r=function(){var e,t,a,r,s,i,l=this,o=l._self._c;return o("div",{staticClass:"exemption-review"},[o("div",{staticClass:"filter-section"},[o("el-form",{ref:"queryForm",attrs:{inline:!0,model:l.queryParams}},[o("el-form-item",{attrs:{label:"申请类型"}},[o("el-select",{attrs:{placeholder:"选择申请类型",clearable:""},model:{value:l.queryParams.type,callback:function(e){l.$set(l.queryParams,"type",e)},expression:"queryParams.type"}},[o("el-option",{attrs:{label:"免测申请",value:"EXEMPTION"}}),o("el-option",{attrs:{label:"重测申请",value:"RETEST"}})],1)],1),o("el-form-item",{attrs:{label:"状态"}},[o("el-select",{attrs:{placeholder:"选择状态",clearable:""},model:{value:l.queryParams.status,callback:function(e){l.$set(l.queryParams,"status",e)},expression:"queryParams.status"}},[o("el-option",{attrs:{label:"待审核",value:"PENDING"}}),o("el-option",{attrs:{label:"已通过",value:"APPROVED"}}),o("el-option",{attrs:{label:"已驳回",value:"REJECTED"}})],1)],1),o("el-form-item",{attrs:{label:"班级"}},[o("el-select",{attrs:{placeholder:"选择班级",clearable:""},model:{value:l.queryParams.className,callback:function(e){l.$set(l.queryParams,"className",e)},expression:"queryParams.className"}},l._l(l.classList,(function(e){return o("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),o("el-form-item",{attrs:{label:"关键字"}},[o("el-input",{attrs:{placeholder:"学生姓名/学号",clearable:""},model:{value:l.queryParams.keyword,callback:function(e){l.$set(l.queryParams,"keyword",e)},expression:"queryParams.keyword"}})],1),o("el-form-item",[o("el-button",{attrs:{type:"primary"},on:{click:l.handleQuery}},[l._v("查询")]),o("el-button",{on:{click:l.resetQuery}},[l._v("重置")])],1)],1)],1),o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:l.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:l.tableData,border:"",stripe:""}},[o("el-table-column",{attrs:{type:"index",label:"序号",width:"60",align:"center"}}),o("el-table-column",{attrs:{label:"学生姓名",prop:"studentName","min-width":"100",align:"center"}}),o("el-table-column",{attrs:{label:"学号",prop:"studentNumber","min-width":"120",align:"center"}}),o("el-table-column",{attrs:{label:"班级",prop:"className","min-width":"100",align:"center"}}),o("el-table-column",{attrs:{label:"申请类型",prop:"type",align:"center",width:"100"},scopedSlots:l._u([{key:"default",fn:function(e){return[o("el-tag",{attrs:{type:"EXEMPTION"===e.row.type?"warning":"info"}},[l._v(" "+l._s("EXEMPTION"===e.row.type?"免测":"重测")+" ")])]}}])}),o("el-table-column",{attrs:{label:"申请原因",prop:"reason","min-width":"200",align:"center"},scopedSlots:l._u([{key:"default",fn:function(e){return[o("el-tooltip",{attrs:{content:e.row.reason,placement:"top"}},[o("span",{staticClass:"reason-text"},[l._v(l._s(e.row.reason))])])]}}])}),o("el-table-column",{attrs:{label:"状态",prop:"status",align:"center",width:"120"},scopedSlots:l._u([{key:"default",fn:function(e){return[o("el-tag",{attrs:{type:l.getStatusType(e.row.status)}},[l._v(" "+l._s(l.getStatusText(e.row.status))+" ")])]}}])}),o("el-table-column",{attrs:{label:"教师审核意见",prop:"teacherReviewComment","min-width":"200",align:"center","show-overflow-tooltip":""},scopedSlots:l._u([{key:"default",fn:function(e){return[e.row.teacherReviewComment?[o("el-tooltip",{attrs:{content:e.row.teacherReviewComment,placement:"top"}},[o("div",[l._v(" "+l._s(e.row.teacherReviewComment)+" "),o("div",{staticClass:"review-time"},[l._v(l._s(l.formatDateTime(e.row.teacherReviewTime)))])])])]:o("span",[l._v("-")])]}}])}),o("el-table-column",{attrs:{label:"管理员审核意见",prop:"adminReviewComment","min-width":"200",align:"center","show-overflow-tooltip":""},scopedSlots:l._u([{key:"default",fn:function(e){return[e.row.adminReviewComment?[o("el-tooltip",{attrs:{content:e.row.adminReviewComment,placement:"top"}},[o("div",[l._v(" "+l._s(e.row.adminReviewComment)+" "),o("div",{staticClass:"review-time"},[l._v(l._s(l.formatDateTime(e.row.adminReviewTime)))])])])]:o("span",[l._v("-")])]}}])}),o("el-table-column",{attrs:{label:"操作",align:"center",width:"200"},scopedSlots:l._u([{key:"default",fn:function(e){return[l.canReview(e.row)?o("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return l.handleReview(e.row)}}},[l._v("审核")]):l._e(),o("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(t){return l.handleDetail(e.row)}}},[l._v("查看")])]}}])})],1),o("div",{staticClass:"pagination-container"},[o("el-pagination",{attrs:{"current-page":l.queryParams.pageNum,"page-sizes":[10,20,50,100],"page-size":l.queryParams.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:l.total},on:{"size-change":l.handleSizeChange,"current-change":l.handleCurrentChange}})],1),o("el-dialog",{attrs:{title:l.reviewDialog.title,visible:l.reviewDialog.visible,width:"500px"},on:{"update:visible":function(e){return l.$set(l.reviewDialog,"visible",e)}}},[o("div",{staticClass:"review-info"},[o("p",[l._v("学生："+l._s(null===(e=l.currentRecord)||void 0===e?void 0:e.studentName)+" ("+l._s(null===(t=l.currentRecord)||void 0===t?void 0:t.studentNumber)+")")]),o("p",[l._v("班级："+l._s(null===(a=l.currentRecord)||void 0===a?void 0:a.className))]),o("p",[l._v("申请类型："+l._s("EXEMPTION"===(null===(r=l.currentRecord)||void 0===r?void 0:r.type)?"免测申请":"重测申请"))]),o("p",[l._v("申请原因："+l._s(null===(s=l.currentRecord)||void 0===s?void 0:s.reason))]),null!==(i=l.currentRecord)&&void 0!==i&&i.teacherReviewComment?[o("p",[l._v("教师审核意见："+l._s(l.currentRecord.teacherReviewComment))]),o("p",[l._v("教师审核时间："+l._s(l.formatDateTime(l.currentRecord.teacherReviewTime)))])]:l._e()],2),o("el-form",{ref:"reviewForm",attrs:{model:l.reviewForm,rules:l.reviewRules,"label-width":"100px"}},[o("el-form-item",{attrs:{label:"审核结果",prop:"status"}},[o("el-radio-group",{model:{value:l.reviewForm.status,callback:function(e){l.$set(l.reviewForm,"status",e)},expression:"reviewForm.status"}},[o("el-radio",{attrs:{label:"APPROVED"}},[l._v("通过")]),o("el-radio",{attrs:{label:"REJECTED"}},[l._v("驳回")])],1)],1),o("el-form-item",{attrs:{label:l.isTeacher?"教师意见":"管理员意见",prop:"comment"}},[o("el-input",{attrs:{type:"textarea",rows:3,placeholder:l.isTeacher?"请输入教师审核意见":"请输入管理员审核意见"},model:{value:l.reviewForm.comment,callback:function(e){l.$set(l.reviewForm,"comment",e)},expression:"reviewForm.comment"}})],1)],1),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(e){l.reviewDialog.visible=!1}}},[l._v("取 消")]),o("el-button",{attrs:{type:"primary"},on:{click:l.submitReview}},[l._v("确 定")])],1)],1),o("el-dialog",{attrs:{title:"申请详情",visible:l.detailDialog.visible,width:"600px"},on:{"update:visible":function(e){return l.$set(l.detailDialog,"visible",e)}}},[l.currentRecord?o("el-descriptions",{attrs:{column:2,border:""}},[o("el-descriptions-item",{attrs:{label:"申请类型"}},[l._v(" "+l._s("EXEMPTION"===l.currentRecord.type?"免测申请":"重测申请")+" ")]),o("el-descriptions-item",{attrs:{label:"当前状态"}},[l._v(" "+l._s(l.getStatusText(l.currentRecord.status))+" ")]),o("el-descriptions-item",{attrs:{label:"学生姓名"}},[l._v(" "+l._s(l.currentRecord.student?l.currentRecord.student.realName:"-")+" ")]),o("el-descriptions-item",{attrs:{label:"学号"}},[l._v(" "+l._s(l.currentRecord.studentNumber)+" ")]),o("el-descriptions-item",{attrs:{label:"申请时间",span:2}},[l._v(" "+l._s(l.formatDateTime(l.currentRecord.applyTime))+" ")]),o("el-descriptions-item",{attrs:{label:"申请原因",span:2}},[l._v(" "+l._s(l.currentRecord.reason)+" ")]),l.currentRecord.teacherReviewTime?o("el-descriptions-item",{attrs:{label:"教师审核时间",span:2}},[l._v(" "+l._s(l.formatDateTime(l.currentRecord.teacherReviewTime))+" ")]):l._e(),l.currentRecord.teacherReviewComment?o("el-descriptions-item",{attrs:{label:"教师审核意见",span:2}},[l._v(" "+l._s(l.currentRecord.teacherReviewComment)+" ")]):l._e(),l.currentRecord.adminReviewTime?o("el-descriptions-item",{attrs:{label:"管理员审核时间",span:2}},[l._v(" "+l._s(l.formatDateTime(l.currentRecord.adminReviewTime))+" ")]):l._e(),l.currentRecord.adminReviewComment?o("el-descriptions-item",{attrs:{label:"管理员审核意见",span:2}},[l._v(" "+l._s(l.currentRecord.adminReviewComment)+" ")]):l._e()],1):l._e()],1)],1)},s=[],i=a("b775");function l(e){return Object(i["a"])({url:"/api/teacher/exemptions/review",method:"put",data:e})}function o(e){return Object(i["a"])({url:"/api/admin/exemptions/review",method:"put",data:e})}var n={name:"ExemptionReview",data(){return{queryParams:{pageNum:1,pageSize:10,type:"",status:"",className:"",keyword:""},tableData:[],total:0,loading:!1,userType:localStorage.getItem("userType"),reviewDialog:{visible:!1,title:"申请审核"},reviewForm:{id:null,status:"",comment:""},reviewRules:{status:[{required:!0,message:"请选择审核结果",trigger:"change"}],comment:[{required:!0,message:"请输入审核意见",trigger:"blur"}]},detailDialog:{visible:!1},currentRecord:null,classList:[]}},computed:{isTeacher(){return"TEACHER"===this.userType}},created(){this.getList(),this.getClassList()},methods:{async getList(){try{this.loading=!0,console.log("开始获取数据，参数:",{pageNum:this.queryParams.pageNum,pageSize:this.queryParams.pageSize,type:this.queryParams.type,status:this.queryParams.status,className:this.queryParams.className,keyword:this.queryParams.keyword});const e=await this.$http.get("/api/exemptions",{params:{pageNum:this.queryParams.pageNum-1,pageSize:this.queryParams.pageSize,type:this.queryParams.type,status:this.queryParams.status,className:this.queryParams.className,keyword:this.queryParams.keyword}});console.log("接口响应数据完整内容:",e.data),200===e.data.code?(console.log("分页数据:",e.data.data),console.log("内容数据:",e.data.data.content),this.tableData=e.data.data.content||[],this.total=e.data.data.totalElements||0,console.log("设置后的表格数据:",this.tableData),console.log("数据总数:",this.total)):this.$message.error(e.data.message||"获取数据失败")}catch(e){console.error("获取列表失败:",e),this.$message.error("获取列表失败")}finally{this.loading=!1}},handleQuery(){this.queryParams.pageNum=1,this.getList()},resetQuery(){this.queryParams={type:"",status:"",className:"",keyword:"",pageNum:1,pageSize:10},this.getList()},handleSizeChange(e){this.queryParams.pageSize=e,this.getList()},handleCurrentChange(e){this.queryParams.pageNum=e,this.getList()},getStatusType(e){const t={PENDING:"warning",APPROVED:"success",REJECTED:"danger"};return t[e]||""},getStatusText(e){const t={PENDING:"待审核",APPROVED:"已通过",REJECTED:"已驳回"};return t[e]||e},canReview(e){return"PENDING"===e.status},handleReview(e){this.currentRecord=e,this.reviewForm={id:e.id,status:"",comment:""},this.reviewDialog.visible=!0},async submitReview(){this.$refs.reviewForm.validate(async e=>{if(e)try{const e=this.isTeacher?l:o,t=await e({id:this.currentRecord.id,status:this.reviewForm.status,comment:this.reviewForm.comment});200===t.data.code?(this.$message.success("审核成功"),this.reviewDialog.visible=!1,this.getList()):this.$message.error(t.data.msg||"审核失败")}catch(t){console.error("审核失败:",t),this.$message.error("审核失败")}})},handleDetail(e){this.currentRecord=e,this.detailDialog.visible=!0},formatDateTime(e){if(!e)return"-";const t=new Date(e);return t.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})},async getClassList(){try{const e=await this.$http.get("/api/exemptions/classes");200===e.data.code&&(this.classList=e.data.data||[])}catch(e){console.error("获取班级列表失败:",e),this.$message.error("获取班级列表失败")}}}},c=n,u=(a("074a"),a("2877")),m=Object(u["a"])(c,r,s,!1,null,"6eed1c24",null);t["default"]=m.exports}}]);
//# sourceMappingURL=chunk-f091e6b2.d4ac79dc.js.map