(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-61645b83"],{"2b76":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"exemption-review"},[t("div",{staticClass:"header"},[t("h2",[e._v("免测/重测申请审核")]),t("div",{staticClass:"actions"},[t("el-button",{attrs:{type:"warning"},on:{click:e.fixStudentNames}},[t("i",{staticClass:"el-icon-refresh"}),e._v(" 修复学生信息 ")])],1)]),t("div",{staticClass:"filters"},[t("el-form",{staticClass:"filter-form",attrs:{inline:!0}},[t("el-form-item",{attrs:{label:"申请类型"}},[t("el-select",{attrs:{placeholder:"选择申请类型",clearable:""},model:{value:e.filters.type,callback:function(t){e.$set(e.filters,"type",t)},expression:"filters.type"}},[t("el-option",{attrs:{label:"免测",value:"EXEMPTION"}}),t("el-option",{attrs:{label:"重测",value:"RETEST"}})],1)],1),t("el-form-item",{attrs:{label:"状态"}},[t("el-select",{attrs:{placeholder:"选择状态",clearable:""},model:{value:e.filters.status,callback:function(t){e.$set(e.filters,"status",t)},expression:"filters.status"}},[t("el-option",{attrs:{label:"待教师审核",value:"PENDING_TEACHER"}}),t("el-option",{attrs:{label:"待管理员审核",value:"PENDING_ADMIN"}}),t("el-option",{attrs:{label:"已通过",value:"APPROVED"}}),t("el-option",{attrs:{label:"教师已驳回",value:"REJECTED_TEACHER"}}),t("el-option",{attrs:{label:"已驳回",value:"REJECTED"}})],1)],1),t("el-form-item",{attrs:{label:"关键字"}},[t("el-input",{attrs:{placeholder:"学号/姓名",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}},model:{value:e.filters.keyword,callback:function(t){e.$set(e.filters,"keyword",t)},expression:"filters.keyword"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("查询")]),t("el-button",{on:{click:e.resetFilters}},[e._v("重置")])],1)],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.records,border:""}},[t("el-table-column",{attrs:{label:"序号",type:"index",width:"50",align:"center"}}),t("el-table-column",{attrs:{prop:"studentNumber",label:"学号",width:"120"}}),t("el-table-column",{attrs:{prop:"studentName",label:"姓名",width:"120"}}),t("el-table-column",{attrs:{prop:"className",label:"班级",width:"120"}}),t("el-table-column",{attrs:{prop:"type",label:"申请类型",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s("EXEMPTION"===t.row.type?"免测":"重测")+" ")]}}])}),t("el-table-column",{attrs:{prop:"reason",label:"申请原因","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"status",label:"状态",width:"120"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{type:e.getStatusType(a.row.status)}},[e._v(" "+e._s(e.getStatusText(a.row.status))+" ")])]}}])}),t("el-table-column",{attrs:{prop:"teacherReviewComment",label:"教师审核意见","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"adminReviewComment",label:"管理员审核意见","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"createdAt",label:"申请时间",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.formatDateTime(t.row.applyTime||t.row.createdAt))+" ")]}}])}),t("el-table-column",{attrs:{label:"操作",width:"200",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return["PENDING_ADMIN"===a.row.status?t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.handleReview(a.row)}}},[e._v("审核")]):e._e(),t("el-button",{attrs:{size:"mini",type:"warning"},on:{click:function(t){return e.handleModify(a.row)}}},[e._v("修改")])]}}])})],1),t("div",{staticClass:"pagination-container"},[t("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[10,20,50,100],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t}}})],1),t("el-dialog",{attrs:{title:"审核申请",visible:e.reviewDialog.visible,width:"500px"},on:{"update:visible":function(t){return e.$set(e.reviewDialog,"visible",t)}}},[t("el-form",{ref:"reviewForm",attrs:{model:e.reviewForm,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"审核结果",prop:"status"}},[t("el-radio-group",{model:{value:e.reviewForm.status,callback:function(t){e.$set(e.reviewForm,"status",t)},expression:"reviewForm.status"}},[t("el-radio",{attrs:{label:"APPROVED"}},[e._v("通过")]),t("el-radio",{attrs:{label:"REJECTED"}},[e._v("驳回")])],1)],1),t("el-form-item",{attrs:{label:"审核意见",prop:"adminReviewComment"}},[t("el-input",{attrs:{type:"textarea",rows:4,placeholder:"请输入审核意见"},model:{value:e.reviewForm.adminReviewComment,callback:function(t){e.$set(e.reviewForm,"adminReviewComment",t)},expression:"reviewForm.adminReviewComment"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.reviewDialog.visible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submitReview}},[e._v("确定")])],1)],1),t("el-dialog",{attrs:{title:"修改审核状态",visible:e.modifyDialog.visible,width:"500px"},on:{"update:visible":function(t){return e.$set(e.modifyDialog,"visible",t)}}},[t("el-form",{ref:"modifyForm",attrs:{model:e.modifyForm,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"审核状态",prop:"status"}},[t("el-select",{attrs:{placeholder:"选择状态"},model:{value:e.modifyForm.status,callback:function(t){e.$set(e.modifyForm,"status",t)},expression:"modifyForm.status"}},[t("el-option",{attrs:{label:"待教师审核",value:"PENDING_TEACHER"}}),t("el-option",{attrs:{label:"待管理员审核",value:"PENDING_ADMIN"}}),t("el-option",{attrs:{label:"已通过",value:"APPROVED"}}),t("el-option",{attrs:{label:"教师已驳回",value:"REJECTED_TEACHER"}}),t("el-option",{attrs:{label:"已驳回",value:"REJECTED"}})],1)],1),t("el-form-item",{attrs:{label:"审核意见",prop:"adminReviewComment"}},[t("el-input",{attrs:{type:"textarea",rows:4,placeholder:"请输入审核意见"},model:{value:e.modifyForm.adminReviewComment,callback:function(t){e.$set(e.modifyForm,"adminReviewComment",t)},expression:"modifyForm.adminReviewComment"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.modifyDialog.visible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submitModify}},[e._v("确定")])],1)],1)],1)},i=[],o={name:"ExemptionReview",data(){return{loading:!1,records:[],total:0,currentPage:1,pageSize:10,filters:{type:void 0,status:void 0,keyword:""},reviewDialog:{visible:!1},reviewForm:{status:"",adminReviewComment:""},currentRecord:null,modifyDialog:{visible:!1},modifyForm:{status:"",adminReviewComment:""}}},created(){this.fetchRecords()},methods:{async fetchRecords(){this.loading=!0;try{const e={type:this.filters.type,status:this.filters.status,keyword:this.filters.keyword,page:this.currentPage-1,size:this.pageSize};console.log("Request params:",e);const t=await this.$http.get("/api/exemptions",{params:e});if(console.log("API Response:",{status:t.status,statusText:t.statusText,headers:t.headers,data:t.data}),200===t.data.code){const{content:e,totalElements:a}=t.data.data||{};this.records=e||[],this.total=a||0,console.log("Loaded records:",this.records),console.log("Total elements:",this.total)}else this.$message.error(t.data.msg||"获取数据失败"),console.error("API error:",t.data)}catch(e){console.error("获取记录失败:",e),this.$message.error("获取记录失败")}finally{this.loading=!1}},handleSearch(){this.currentPage=1,this.fetchRecords()},resetFilters(){this.filters={type:void 0,status:void 0,keyword:""},this.handleSearch()},getStatusType(e){const t={PENDING_TEACHER:"warning",PENDING_ADMIN:"warning",APPROVED:"success",REJECTED:"danger",REJECTED_TEACHER:"danger"};return t[e]||"info"},getStatusText(e){const t={PENDING_TEACHER:"待教师审核",PENDING_ADMIN:"待管理员审核",APPROVED:"已通过",REJECTED:"已驳回",REJECTED_TEACHER:"教师已驳回"};return t[e]||e},formatDateTime(e){return e?new Date(e).toLocaleString():""},handleSizeChange(e){this.pageSize=e,this.fetchRecords()},handleCurrentChange(e){this.currentPage=e,this.fetchRecords()},handleReview(e){this.currentRecord=e,this.reviewForm={status:"",adminReviewComment:""},this.reviewDialog.visible=!0},async submitReview(){if(this.reviewForm.status)try{const e=await this.$http.put(`/api/exemptions/${this.currentRecord.id}/review`,{status:this.reviewForm.status,adminReviewComment:this.reviewForm.adminReviewComment,adminReviewTime:(new Date).toISOString()});200===e.data.code?(this.$message.success("审核成功"),this.reviewDialog.visible=!1,this.fetchRecords()):this.$message.error(e.data.msg||"审核失败")}catch(e){console.error("审核失败:",e),this.$message.error("审核失败")}else this.$message.warning("请选择审核结果")},async fixStudentNames(){try{const e=await this.$http.post("/api/data-fix/fix-exemption-names");200===e.data.code?(this.$message.success(e.data.data||"修复成功"),this.fetchRecords()):this.$message.error(e.data.msg||"修复失败")}catch(e){console.error("修复失败:",e),this.$message.error("修复失败")}},handleModify(e){this.currentRecord=e,this.modifyForm={status:e.status,adminReviewComment:e.adminReviewComment||""},this.modifyDialog.visible=!0},async submitModify(){try{const e=await this.$http.put(`/api/exemptions/${this.currentRecord.id}/modify`,{status:this.modifyForm.status,adminReviewComment:this.modifyForm.adminReviewComment});200===e.data.code?(this.$message.success("修改成功"),this.modifyDialog.visible=!1,this.fetchRecords()):this.$message.error(e.data.msg||"修改失败")}catch(e){console.error("修改失败:",e),this.$message.error("修改失败")}}}},r=o,l=(a("3859"),a("2877")),n=Object(l["a"])(r,s,i,!1,null,"385ea296",null);t["default"]=n.exports},3859:function(e,t,a){"use strict";a("cf2a")},cf2a:function(e,t,a){}}]);
//# sourceMappingURL=chunk-61645b83.adfb4cc6.js.map