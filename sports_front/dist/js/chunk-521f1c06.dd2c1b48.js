(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-521f1c06"],{"4a0c":function(e,t,a){"use strict";a("f66f")},a1d7:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"score-appeal"},[t("el-card",{staticClass:"info-card"},[t("div",{staticClass:"info-content"},[t("i",{staticClass:"el-icon-info"}),t("div",{staticClass:"info-text"},[t("h3",[e._v("体测成绩申诉")]),t("p",[e._v("如果您对体测成绩有异议，可以在此提交申诉。请详细说明申诉理由，我们会尽快处理。")])])])]),t("div",{staticClass:"operation-bar"},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialogVisible=!0}}},[e._v(" 提交申诉 ")])],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.appealList,border:""}},[t("el-table-column",{attrs:{prop:"createTime",label:"申诉时间",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.formatDateTime(t.row.createTime))+" ")]}}])}),t("el-table-column",{attrs:{prop:"sportsItemName",label:"测试项目"}}),t("el-table-column",{attrs:{prop:"originalScore",label:"原始成绩"}}),t("el-table-column",{attrs:{prop:"expectedScore",label:"期望成绩"}}),t("el-table-column",{attrs:{prop:"reason",label:"申诉理由","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"status",label:"状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{type:e.getStatusType(a.row.status)}},[e._v(" "+e._s(e.getStatusText(a.row.status))+" ")])]}}])}),t("el-table-column",{attrs:{prop:"reviewComment",label:"审核意见","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"reviewTime",label:"审核时间",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.formatDateTime(t.row.reviewTime))+" ")]}}])})],1),t("el-dialog",{attrs:{title:"提交申诉",visible:e.dialogVisible,width:"600px","destroy-on-close":!0,"close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-form",{ref:"appealForm",attrs:{model:e.appealForm,rules:e.rules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"测试记录",prop:"testRecordId"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择要申诉的测试记录"},on:{change:e.handleRecordChange},model:{value:e.appealForm.testRecordId,callback:function(t){e.$set(e.appealForm,"testRecordId",t)},expression:"appealForm.testRecordId"}},e._l(e.testRecords,(function(a){return t("el-option",{key:a.id,attrs:{label:`${a.sportsItemName} - ${a.score}分`,value:a.id}},[t("span",{staticStyle:{float:"left"}},[e._v(e._s(a.sportsItemName))]),t("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(a.score)+"分")])])})),1)],1),t("el-form-item",{attrs:{label:"期望成绩",prop:"expectedScore"}},[t("el-input-number",{staticStyle:{width:"200px"},attrs:{min:0,max:100,precision:1,step:.1,"controls-position":"right"},model:{value:e.appealForm.expectedScore,callback:function(t){e.$set(e.appealForm,"expectedScore",t)},expression:"appealForm.expectedScore"}})],1),t("el-form-item",{attrs:{label:"申诉理由",prop:"reason"}},[t("el-input",{attrs:{type:"textarea",rows:4,placeholder:"请详细说明申诉理由，例如：成绩记录错误、测试过程中的特殊情况等..."},model:{value:e.appealForm.reason,callback:function(t){e.$set(e.appealForm,"reason",t)},expression:"appealForm.reason"}})],1)],1),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",loading:e.submitting},on:{click:e.submitAppeal}},[e._v(" 提 交 ")])],1)],1)],1)},o=[],r=(a("e9f5"),a("f665"),{name:"ScoreAppeal",data(){return{loading:!1,submitting:!1,dialogVisible:!1,appealList:[],testRecords:[],currentRecord:null,appealForm:{testRecordId:"",expectedScore:void 0,reason:""},rules:{testRecordId:[{required:!0,message:"请选择要申诉的测试记录",trigger:"change"}],expectedScore:[{required:!0,message:"请输入期望成绩",trigger:"blur"}],reason:[{required:!0,message:"请输入申诉理由",trigger:"blur"},{min:10,max:500,message:"申诉理由长度应在10-500字之间",trigger:"blur"}]}}},created(){this.fetchAppealList(),this.fetchAppealableRecords()},methods:{async fetchAppealableRecords(){try{this.loading=!0;const e=localStorage.getItem("userId");console.log("正在获取可申诉记录，userId:",e);const t=await this.$axios.get("/api/student/test-records/appealable");console.log("获取可申诉记录响应:",t.data),200===t.data.code?(this.testRecords=t.data.data,console.log("设置可申诉记录:",this.testRecords),0===this.testRecords.length&&this.$message.info("暂无可申诉的测试记录")):this.$message.error(t.data.message||"获取可申诉记录失败")}catch(e){console.error("获取可申诉记录失败:",e),this.$message.error("获取可申诉记录失败")}finally{this.loading=!1}},async fetchAppealList(){try{this.loading=!0;const e=await this.$axios.get("/api/student/appeals");console.log("获取到的申诉列表:",e.data),200===e.data.code?this.appealList=Array.isArray(e.data.data)?e.data.data:e.data.data.content||[]:this.$message.error(e.data.message||"获取申诉列表失败")}catch(t){var e;console.error("获取申诉列表失败:",t),this.$message.error((null===(e=t.response)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.message)||"获取申诉列表失败")}finally{this.loading=!1}},handleRecordChange(e){this.currentRecord=this.testRecords.find(t=>t.id===e),this.currentRecord&&(this.appealForm.expectedScore=this.currentRecord.score)},submitAppeal(){this.$refs.appealForm.validate(async e=>{if(e)try{this.submitting=!0;const e={testRecordId:this.appealForm.testRecordId,expectedScore:parseFloat(this.appealForm.expectedScore),reason:this.appealForm.reason},t=await this.$axios.post("/api/student/appeals",e);200===t.data.code?(this.$message.success("申诉提交成功"),this.dialogVisible=!1,this.fetchAppealList(),this.$refs.appealForm.resetFields()):this.$message.error(t.data.message||"提交申诉失败")}catch(a){var t;console.error("提交申诉失败:",a),this.$message.error((null===(t=a.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.message)||"提交申诉失败")}finally{this.submitting=!1}})},getStatusType(e){const t={PENDING:"warning",APPROVED:"success",REJECTED:"danger"};return t[e]||"info"},getStatusText(e){const t={PENDING:"待审核",APPROVED:"已通过",REJECTED:"已驳回"};return t[e]||e},formatDateTime(e){return e?new Date(e).toLocaleString():""}}}),l=r,i=(a("4a0c"),a("2877")),c=Object(i["a"])(l,s,o,!1,null,"72cc5ecc",null);t["default"]=c.exports},f66f:function(e,t,a){}}]);
//# sourceMappingURL=chunk-521f1c06.dd2c1b48.js.map